<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìµëª… ê²Œì‹œíŒ</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #f5f7fa; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .header { text-align: center; padding: 20px; background: white; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .tab { flex: 1; padding: 12px; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; background: #f5f7fa; color: #7f8c8d; transition: all 0.3s; }
        .tab.active { background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%); color: white; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        input, textarea, select { width: 100%; padding: 12px; border: 2px solid #e8e8e8; border-radius: 8px; font-size: 1rem; margin-bottom: 10px; font-family: inherit; }
        textarea { min-height: 100px; resize: vertical; }
        .btn { width: 100%; padding: 14px; background: #4a90e2; color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .btn:hover { background: #357abd; transform: translateY(-2px); }
        .btn:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        .btn-small { width: auto; padding: 8px 15px; font-size: 0.9rem; }
        .post { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .post-header { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.9rem; color: #666; }
        .post-footer { display: flex; gap: 10px; margin-top: 15px; padding-top: 15px; border-top: 1px solid #f0f0f0; }
        .reaction { padding: 8px 12px; background: #f8f9fa; border: 1px solid #e8e8e8; border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; }
        .reaction:hover { background: #e8ecef; transform: scale(1.05); }
        .comments { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 15px; }
        .comment { background: white; padding: 12px; border-radius: 8px; margin-bottom: 10px; }
        .comment-header { font-size: 0.85rem; color: #666; margin-bottom: 5px; }
        .comment-input { display: flex; gap: 10px; margin-top: 10px; }
        .iframe-container { width: 100%; height: 80vh; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .iframe-container iframe { width: 100%; height: 100%; border: none; }
        .dcinside-info { background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #ffc107; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const firebaseConfig = {
            apiKey: "AIzaSyDh3FsyWVZqy8wGExv-IlAglJ0DERuW_T8",
            authDomain: "ccccc-74256.firebaseapp.com",
            databaseURL: "https://ccccc-74256-default-rtdb.firebaseio.com",
            projectId: "ccccc-74256"
        };
        
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        function App() {
            const [tab, setTab] = useState('board');
            const [posts, setPosts] = useState([]);
            const [nickname, setNickname] = useState('');
            const [content, setContent] = useState('');
            const [loading, setLoading] = useState(true);
            const [openComments, setOpenComments] = useState({});
            const [commentInputs, setCommentInputs] = useState({});
            const [commentNicknames, setCommentNicknames] = useState({});
            
            useEffect(() => {
                const ref = db.ref('posts');
                ref.on('value', (snap) => {
                    const data = snap.val();
                    if (data) {
                        const arr = Object.keys(data).map(k => ({id: k, ...data[k]})).sort((a,b) => b.timestamp - a.timestamp);
                        setPosts(arr);
                    }
                    setLoading(false);
                });
                return () => ref.off();
            }, []);
            
            const submit = () => {
                if (!content.trim()) return;
                db.ref('posts').push({ 
                    nickname: nickname.trim() || 'ìµëª…',
                    content: content.trim(), 
                    timestamp: Date.now(), 
                    reactions: {hug:0,cheer:0}, 
                    comments: {} 
                });
                setNickname('');
                setContent('');
            };
            
            const react = (id, type) => {
                const post = posts.find(p => p.id === id);
                db.ref(`posts/${id}/reactions/${type}`).set((post.reactions?.[type] || 0) + 1);
            };
            
            const toggleComments = (id) => {
                setOpenComments({...openComments, [id]: !openComments[id]});
            };
            
            const addComment = (postId) => {
                const text = commentInputs[postId];
                if (!text?.trim()) return;
                
                // localStorageì—ì„œ ì´ ê²Œì‹œê¸€ì— ëŒ€í•œ ë‚´ ìµëª… ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸°
                const myAnonymousIds = JSON.parse(localStorage.getItem('myAnonymousIds') || '{}');
                let myNumber = myAnonymousIds[postId];
                
                // ì´ ê²Œì‹œê¸€ì— ì²˜ìŒ ëŒ“ê¸€ ë‹¤ëŠ” ê²½ìš°
                if (!myNumber) {
                    // í˜„ì¬ ì´ ê²Œì‹œê¸€ì˜ ìµœëŒ€ ìµëª… ë²ˆí˜¸ ì°¾ê¸°
                    let maxNumber = 0;
                    if (posts.find(p => p.id === postId)?.nickname === 'ìµëª…') {
                        maxNumber = 1; // ê²Œì‹œê¸€ ì‘ì„±ìê°€ ìµëª…1
                    }
                    
                    // ê¸°ì¡´ ëŒ“ê¸€ë“¤ì—ì„œ ìµœëŒ€ ë²ˆí˜¸ ì°¾ê¸°
                    const post = posts.find(p => p.id === postId);
                    if (post?.comments) {
                        Object.values(post.comments).forEach(c => {
                            if (c.nickname?.startsWith('ìµëª…')) {
                                const num = parseInt(c.nickname.replace('ìµëª…', ''));
                                if (!isNaN(num) && num > maxNumber) {
                                    maxNumber = num;
                                }
                            }
                        });
                    }
                    
                    myNumber = maxNumber + 1;
                    myAnonymousIds[postId] = myNumber;
                    localStorage.setItem('myAnonymousIds', JSON.stringify(myAnonymousIds));
                }
                
                const nickname = commentNicknames[postId]?.trim() || `ìµëª…${myNumber}`;
                
                db.ref(`posts/${postId}/comments`).push({ 
                    nickname: nickname,
                    content: text.trim(), 
                    timestamp: Date.now() 
                });
                setCommentInputs({...commentInputs, [postId]: ''});
                setCommentNicknames({...commentNicknames, [postId]: ''});
            };
            
            return (
                <div className="container">
                    <div className="header">
                        <h1>ğŸ“‹ ìµëª… ê²Œì‹œíŒ</h1>
                    </div>
                    
                    <div className="tabs">
                        <button className={`tab ${tab==='board'?'active':''}`} onClick={()=>setTab('board')}>ğŸ“ ê²Œì‹œíŒ</button>
                        <button className={`tab ${tab==='single'?'active':''}`} onClick={()=>setTab('single')}>ğŸŒ ì‹±ê¸€ë²™ê¸€</button>
                        <button className={`tab ${tab==='inbang'?'active':''}`} onClick={()=>setTab('inbang')}>ğŸ’« ì¸ë°©ê°¤</button>
                        <button className={`tab ${tab==='ygosu'?'active':''}`} onClick={()=>setTab('ygosu')}>ğŸ® ì™€ê³ </button>
                    </div>
                    
                    {tab === 'board' ? (
                        <>
                            <div className="card">
                                <h3>âœï¸ ê¸€ ì‘ì„±</h3>
                                <input 
                                    type="text"
                                    value={nickname} 
                                    onChange={e=>setNickname(e.target.value)} 
                                    placeholder="ë‹‰ë„¤ì„ (ì„ íƒ, ë¹„ìš°ë©´ 'ìµëª…')" 
                                    maxLength={20}
                                    style={{marginBottom:'10px'}}
                                />
                                <textarea value={content} onChange={e=>setContent(e.target.value)} placeholder="ë‚´ìš© ì…ë ¥..." maxLength={500} />
                                <div style={{textAlign:'right',fontSize:'0.9rem',color:'#666',marginBottom:'10px'}}>{content.length}/500</div>
                                <button className="btn" onClick={submit} disabled={!content.trim()}>ê²Œì‹œí•˜ê¸°</button>
                            </div>
                            <h3 style={{marginBottom:'15px'}}>ğŸ“ ê²Œì‹œê¸€ ({posts.length})</h3>
                            {loading ? <div className="card">ë¡œë”©ì¤‘...</div> : posts.length === 0 ? <div className="card">ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div> : posts.map(p => {
                                const getAnonymousNumber = () => {
                                    if (p.nickname === 'ìµëª…') return 'ìµëª…1';
                                    return p.nickname || 'ìµëª…1';
                                };
                                
                                return (
                                <div key={p.id} className="post">
                                    <div className="post-header">
                                        <strong>{getAnonymousNumber()}</strong>
                                        <span>{new Date(p.timestamp).toLocaleString('ko-KR')}</span>
                                    </div>
                                    <div style={{lineHeight:'1.6'}}>{p.content}</div>
                                    <div className="post-footer">
                                        <span className="reaction" onClick={()=>react(p.id,'hug')}>ğŸ¤— {p.reactions?.hug || 0}</span>
                                        <span className="reaction" onClick={()=>react(p.id,'cheer')}>ğŸ’ª {p.reactions?.cheer || 0}</span>
                                        <span className="reaction" onClick={()=>toggleComments(p.id)}>ğŸ’¬ ëŒ“ê¸€ {p.comments ? Object.keys(p.comments).length : 0}</span>
                                    </div>
                                    {openComments[p.id] && (
                                        <div className="comments">
                                            {p.comments && (() => {
                                                const anonymousCounter = { count: p.nickname === 'ìµëª…' ? 2 : 1 };
                                                
                                                return Object.keys(p.comments).map(cid => {
                                                    const c = p.comments[cid];
                                                    const isAuthor = c.nickname === p.nickname && c.nickname !== 'ìµëª…';
                                                    
                                                    let displayName = c.nickname || 'ìµëª…';
                                                    let showAuthorBadge = false;
                                                    
                                                    if (displayName === 'ìµëª…') {
                                                        if (p.nickname === 'ìµëª…') {
                                                            displayName = `ìµëª…${anonymousCounter.count}`;
                                                            anonymousCounter.count++;
                                                        } else {
                                                            displayName = `ìµëª…${anonymousCounter.count}`;
                                                            anonymousCounter.count++;
                                                        }
                                                    } else {
                                                        showAuthorBadge = isAuthor;
                                                    }
                                                    
                                                    return (
                                                        <div key={cid} className="comment">
                                                            <div className="comment-header">
                                                                <strong>{displayName}</strong>
                                                                {showAuthorBadge && (
                                                                    <span style={{
                                                                        marginLeft: '6px',
                                                                        padding: '2px 8px',
                                                                        background: 'linear-gradient(135deg, #4a90e2 0%, #357abd 100%)',
                                                                        color: 'white',
                                                                        borderRadius: '4px',
                                                                        fontSize: '0.75rem',
                                                                        fontWeight: 'bold'
                                                                    }}>
                                                                        ê¸€ì“´ì´
                                                                    </span>
                                                                )}
                                                                {' Â· '}{new Date(c.timestamp).toLocaleString('ko-KR')}
                                                            </div>
                                                            <div>{c.content}</div>
                                                        </div>
                                                    );
                                                });
                                            })()}
                                            <div style={{marginTop:'10px'}}>
                                                <input 
                                                    value={commentNicknames[p.id] || (() => {
                                                        const myIds = JSON.parse(localStorage.getItem('myAnonymousIds') || '{}');
                                                        return myIds[p.id] ? `ìµëª…${myIds[p.id]}` : '';
                                                    })()}
                                                    readOnly
                                                    placeholder={(() => {
                                                        const myIds = JSON.parse(localStorage.getItem('myAnonymousIds') || '{}');
                                                        return myIds[p.id] ? `ìµëª…${myIds[p.id]} (ìë™ë°°ì •)` : 'ìµëª… ë²ˆí˜¸ ìë™ë°°ì •';
                                                    })()}
                                                    maxLength={20}
                                                    style={{
                                                        marginBottom:'8px',
                                                        background: '#f8f9fa',
                                                        cursor: 'not-allowed',
                                                        color: '#495057'
                                                    }}
                                                />
                                                <div className="comment-input">
                                                    <input 
                                                        value={commentInputs[p.id] || ''} 
                                                        onChange={e=>setCommentInputs({...commentInputs, [p.id]: e.target.value})}
                                                        onKeyPress={e=>e.key==='Enter'&&addComment(p.id)}
                                                        placeholder="ëŒ“ê¸€ ì…ë ¥..."
                                                        style={{flex:1}}
                                                    />
                                                    <button className="btn btn-small" onClick={()=>addComment(p.id)}>ì‘ì„±</button>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                                );
                            })}
                        </>
                    ) : tab === 'single' ? (
                        <div>
                            <div className="dcinside-info">
                                <h3 style={{marginBottom:'10px'}}>ğŸŒ ì‹±ê¸€ë²™ê¸€ ì§€êµ¬ì´Œ ê°œë…ê¸€</h3>
                                <p style={{fontSize:'0.9rem',lineHeight:'1.6',color:'#856404'}}>
                                    âš ï¸ ë³´ì•ˆ ì •ì±…ìœ¼ë¡œ ì¸í•´ ì§ì ‘ embedê°€ ë¶ˆê°€ëŠ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>
                                    iframeì´ í‘œì‹œë˜ì§€ ì•Šìœ¼ë©´ ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ìƒˆ ì°½ì—ì„œ ì—´ì–´ì£¼ì„¸ìš”!
                                </p>
                            </div>
                            
                            <div className="card" style={{textAlign:'center',padding:'20px'}}>
                                <button 
                                    className="btn" 
                                    onClick={()=>window.open('https://gall.dcinside.com/mgallery/board/lists/?id=singlebungle1472&exception_mode=recommend', '_blank')}
                                    style={{maxWidth:'400px',margin:'0 auto 20px'}}
                                >
                                    ğŸ”— ìƒˆ ì°½ì—ì„œ ì‹±ê¸€ë²™ê¸€ ê°œë…ê¸€ ë³´ê¸°
                                </button>
                            </div>
                            
                            <div className="iframe-container">
                                <iframe 
                                    src="https://gall.dcinside.com/mgallery/board/lists/?id=singlebungle1472&exception_mode=recommend"
                                    title="ë””ì‹œì¸ì‚¬ì´ë“œ ì‹±ê¸€ë²™ê¸€ ê°œë…ê¸€"
                                    sandbox="allow-same-origin allow-scripts allow-popups allow-forms allow-modals allow-popups-to-escape-sandbox allow-top-navigation"
                                    allow="autoplay; fullscreen; picture-in-picture"
                                />
                            </div>
                        </div>
                    ) : tab === 'inbang' ? (
                        <div>
                            <div className="dcinside-info">
                                <h3 style={{marginBottom:'10px'}}>ğŸ’« ì¸í„°ë„·ë°©ì†¡ ê°œë…ê¸€</h3>
                                <p style={{fontSize:'0.9rem',lineHeight:'1.6',color:'#856404'}}>
                                    âš ï¸ ë³´ì•ˆ ì •ì±…ìœ¼ë¡œ ì¸í•´ ì§ì ‘ embedê°€ ë¶ˆê°€ëŠ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>
                                    iframeì´ í‘œì‹œë˜ì§€ ì•Šìœ¼ë©´ ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ìƒˆ ì°½ì—ì„œ ì—´ì–´ì£¼ì„¸ìš”!
                                </p>
                            </div>
                            
                            <div className="card" style={{textAlign:'center',padding:'20px'}}>
                                <button 
                                    className="btn" 
                                    onClick={()=>window.open('https://gall.dcinside.com/mini/board/lists/?id=soopsosopbj&exception_mode=recommend', '_blank')}
                                    style={{maxWidth:'400px',margin:'0 auto 20px'}}
                                >
                                    ğŸ”— ìƒˆ ì°½ì—ì„œ ì¸ë°©ê°¤ ê°œë…ê¸€ ë³´ê¸°
                                </button>
                            </div>
                            
                            <div className="iframe-container">
                                <iframe 
                                    src="https://gall.dcinside.com/mini/board/lists/?id=soopsosopbj&exception_mode=recommend"
                                    title="ë””ì‹œì¸ì‚¬ì´ë“œ ì¸ë°©ê°¤ ê°œë…ê¸€"
                                    sandbox="allow-same-origin allow-scripts allow-popups allow-forms allow-modals allow-popups-to-escape-sandbox allow-top-navigation"
                                    allow="autoplay; fullscreen; picture-in-picture"
                                />
                            </div>
                        </div>
                    ) : tab === 'ygosu' ? (
                        <div>
                            <div className="dcinside-info">
                                <h3 style={{marginBottom:'10px'}}>ğŸ® ì™€ê³  ìí¥ ê²Œì‹œíŒ</h3>
                                <p style={{fontSize:'0.9rem',lineHeight:'1.6',color:'#856404'}}>
                                    âš ï¸ ë³´ì•ˆ ì •ì±…ìœ¼ë¡œ ì¸í•´ ì§ì ‘ embedê°€ ë¶ˆê°€ëŠ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>
                                    iframeì´ í‘œì‹œë˜ì§€ ì•Šìœ¼ë©´ ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ìƒˆ ì°½ì—ì„œ ì—´ì–´ì£¼ì„¸ìš”!
                                </p>
                            </div>
                            
                            <div className="card" style={{textAlign:'center',padding:'20px'}}>
                                <button 
                                    className="btn" 
                                    onClick={()=>window.open('https://ygosu.com/all_search/?type=&add_search_log=Y&keyword=%E3%85%87%E3%85%8E', '_blank')}
                                    style={{maxWidth:'400px',margin:'0 auto 20px'}}
                                >
                                    ğŸ”— ìƒˆ ì°½ì—ì„œ ì™€ê³  ìí¥ ë³´ê¸°
                                </button>
                            </div>
                            
                            <div className="iframe-container">
                                <iframe 
                                    src="https://ygosu.com/all_search/?type=&add_search_log=Y&keyword=%E3%85%87%E3%85%8E"
                                    title="ì™€ê³  ìí¥ ê²Œì‹œíŒ"
                                    sandbox="allow-same-origin allow-scripts allow-popups allow-forms allow-modals allow-popups-to-escape-sandbox allow-top-navigation"
                                    allow="autoplay; fullscreen; picture-in-picture"
                                />
                            </div>
                        </div>
                    ) : null}
                </div>
            );
        }
        
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
