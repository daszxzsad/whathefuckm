<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìµëª… ê²Œì‹œíŒ</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #f5f7fa; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; padding: 20px; background: white; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); flex-wrap: wrap; }
        .tab { flex: 1; min-width: 80px; padding: 12px; border: none; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; background: #f5f7fa; color: #7f8c8d; transition: all 0.3s; }
        .tab.active { background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%); color: white; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        input, textarea, select { width: 100%; padding: 12px; border: 2px solid #e8e8e8; border-radius: 8px; font-size: 1rem; margin-bottom: 10px; font-family: inherit; }
        textarea { min-height: 100px; resize: vertical; }
        .btn { width: 100%; padding: 14px; background: #4a90e2; color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .btn:hover { background: #357abd; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .btn-small { width: auto; padding: 8px 15px; font-size: 0.9rem; }
        .post { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .post-header { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.9rem; color: #666; }
        .post-footer { display: flex; gap: 10px; margin-top: 15px; padding-top: 15px; border-top: 1px solid #f0f0f0; }
        .reaction { padding: 8px 12px; background: #f8f9fa; border: 1px solid #e8e8e8; border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; }
        .reaction:hover { background: #e8ecef; }
        .comments { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 15px; }
        .comment { background: white; padding: 12px; border-radius: 8px; margin-bottom: 10px; }
        .comment-header { font-size: 0.85rem; color: #666; margin-bottom: 5px; }
        .comment-input { display: flex; gap: 10px; margin-top: 10px; }
        .chat-container { height: 500px; overflow-y: auto; background: #f8f9fa; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .chat-message { background: white; padding: 12px; border-radius: 8px; margin-bottom: 10px; }
        .chat-header { font-weight: bold; color: #4a90e2; margin-bottom: 5px; font-size: 0.9rem; }
        .detector-result { padding: 30px; border-radius: 12px; margin: 20px 0; text-align: center; animation: fadeIn 0.5s; }
        .detector-result.true { background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%); color: white; }
        .detector-result.false { background: linear-gradient(135deg, #f44336 0%, #ef5350 100%); color: white; }
        .pvp-result { padding: 30px; border-radius: 12px; text-align: center; margin-bottom: 20px; color: white; animation: fadeIn 0.5s; }
        .pvp-result.win { background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%); }
        .pvp-result.lose { background: linear-gradient(135deg, #f44336 0%, #ef5350 100%); }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyDh3FsyWVZqy8wGExv-IlAglJ0DERuW_T8",
            authDomain: "ccccc-74256.firebaseapp.com",
            databaseURL: "https://ccccc-74256-default-rtdb.firebaseio.com",
            projectId: "ccccc-74256",
            storageBucket: "ccccc-74256.firebasestorage.app",
            messagingSenderId: "1086870817114",
            appId: "1:1086870817114:web:8fb533c96f3402bfe78b63"
        };
        
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();

        function App() {
            const [tab, setTab] = useState('board');
            
            // ê²Œì‹œíŒ
            const [posts, setPosts] = useState([]);
            const [postTitle, setPostTitle] = useState('');
            const [postContent, setPostContent] = useState('');
            const [postAuthor, setPostAuthor] = useState('');
            const [myAnonymousId, setMyAnonymousId] = useState('');
            const [commentInputs, setCommentInputs] = useState({});
            
            // ì±„íŒ…
            const [messages, setMessages] = useState([]);
            const [chatMsg, setChatMsg] = useState('');
            const [chatNick, setChatNick] = useState('');
            const chatRef = useRef(null);
            
            // ê±°ì§“ë§íƒì§€ê¸°
            const [detectorQuestion, setDetectorQuestion] = useState('');
            const [detectorResult, setDetectorResult] = useState(null);
            const [detectorLoading, setDetectorLoading] = useState(false);
            
            // íˆ¬í‘œ
            const [polls, setPolls] = useState([]);
            const [pollQuestion, setPollQuestion] = useState('');
            const [pollOptions, setPollOptions] = useState(['', '']);
            const [myVotes, setMyVotes] = useState({});
            
            // ë†ì¥
            const [farmUser, setFarmUser] = useState(null);
            const [farmNick, setFarmNick] = useState('');
            const [farmPass, setFarmPass] = useState('');
            const [isLogin, setIsLogin] = useState(true);
            const [allUsers, setAllUsers] = useState([]);
            const [timer, setTimer] = useState('');
            const [pvpTarget, setPvpTarget] = useState('');
            const [pvpAmount, setPvpAmount] = useState('');
            const [pvpReqs, setPvpReqs] = useState([]);
            const [pvpResult, setPvpResult] = useState(null);
            const [showRules, setShowRules] = useState(false);

            // ìµëª… ID ìƒì„±
            useEffect(() => {
                let id = localStorage.getItem('anonymousId');
                if (!id) {
                    id = 'anon_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('anonymousId', id);
                }
                setMyAnonymousId(id);
            }, []);

            // ê²Œì‹œíŒ ë¡œë“œ
            useEffect(() => {
                db.ref('posts').limitToLast(50).on('value', snap => {
                    const data = snap.val();
                    if (data) {
                        const arr = Object.keys(data).map(k => ({id: k, ...data[k]})).sort((a,b) => b.timestamp - a.timestamp);
                        setPosts(arr);
                    } else {
                        setPosts([]);
                    }
                });
            }, []);

            // ì±„íŒ… ë¡œë“œ
            useEffect(() => {
                db.ref('chatMessages').limitToLast(100).on('value', snap => {
                    const data = snap.val();
                    if (data) {
                        const arr = Object.keys(data).map(k => ({id: k, ...data[k]})).sort((a,b) => a.timestamp - b.timestamp);
                        setMessages(arr);
                        setTimeout(() => {
                            if (chatRef.current) {
                                chatRef.current.scrollTop = chatRef.current.scrollHeight;
                            }
                        }, 100);
                    }
                });
            }, []);

            // ì±„íŒ… ë‹‰ë„¤ì„
            useEffect(() => {
                let nick = localStorage.getItem('chatRandomNickname');
                if (!nick) {
                    const names = ['ì„ì›…', 'ëª…ì§„', 'ë¯¼ìˆ˜', 'ì¶©ì—°', 'ë¯¼ê¸°', 'ë¯¼í˜¸', 'ì‹ ìš°', 'ëŒ€ì›…'];
                    nick = names[Math.floor(Math.random() * names.length)];
                    localStorage.setItem('chatRandomNickname', nick);
                }
                setChatNick(nick);
            }, []);

            // íˆ¬í‘œ ë¡œë“œ
            useEffect(() => {
                db.ref('polls').on('value', snap => {
                    const data = snap.val();
                    if (data) {
                        const arr = Object.keys(data).map(k => ({id: k, ...data[k]})).sort((a,b) => b.timestamp - a.timestamp);
                        setPolls(arr);
                    } else {
                        setPolls([]);
                    }
                });
                
                const saved = localStorage.getItem('myVotes');
                if (saved) {
                    try {
                        setMyVotes(JSON.parse(saved));
                    } catch (e) {}
                }
            }, []);

            // ë†ì¥ ìœ ì € ë¡œë“œ
            useEffect(() => {
                db.ref('farmUsers').on('value', snap => {
                    const data = snap.val();
                    if (data) {
                        const arr = Object.keys(data).map(k => ({id: k, ...data[k]})).sort((a,b) => b.length - a.length);
                        setAllUsers(arr);
                        
                        const token = localStorage.getItem('farmToken');
                        if (token) {
                            const me = arr.find(u => u.id === token);
                            if (me) setFarmUser(me);
                        }
                    }
                });
            }, []);

            // PVP ìš”ì²­ ë¡œë“œ
            useEffect(() => {
                db.ref('pvpRequests').on('value', snap => {
                    const data = snap.val();
                    const token = localStorage.getItem('farmToken');
                    if (data && token) {
                        const arr = Object.keys(data).map(k => ({id: k, ...data[k]}))
                            .filter(r => r.status === 'pending' && (r.toId === token || r.fromId === token));
                        setPvpReqs(arr);
                    } else {
                        setPvpReqs([]);
                    }
                });
            }, []);

            // íƒ€ì´ë¨¸
            useEffect(() => {
                const update = () => {
                    if (!farmUser || !farmUser.lastCheckIn) {
                        setTimer('ì¶œì„ ê°€ëŠ¥!');
                        return;
                    }
                    const now = Date.now();
                    const diff = now - farmUser.lastCheckIn;
                    const cooldown = 24 * 60 * 60 * 1000;
                    if (diff >= cooldown) {
                        setTimer('ì¶œì„ ê°€ëŠ¥!');
                    } else {
                        const left = cooldown - diff;
                        const h = Math.floor(left / 3600000);
                        const m = Math.floor((left % 3600000) / 60000);
                        const s = Math.floor((left % 60000) / 1000);
                        setTimer(`${h}ì‹œê°„ ${m}ë¶„ ${s}ì´ˆ`);
                    }
                };
                update();
                const iv = setInterval(update, 1000);
                return () => clearInterval(iv);
            }, [farmUser]);

            // ê²Œì‹œê¸€ ì‘ì„±
            const writePost = () => {
                if (!postTitle.trim() || !postContent.trim() || !postAuthor.trim()) {
                    alert('ì œëª©, ë‚´ìš©, ì‘ì„±ìë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”!');
                    return;
                }
                const postId = Date.now().toString();
                db.ref(`posts/${postId}`).set({
                    title: postTitle.trim(),
                    content: postContent.trim(),
                    author: postAuthor.trim(),
                    timestamp: Date.now(),
                    reactions: {},
                    comments: {}
                });
                setPostTitle('');
                setPostContent('');
                setPostAuthor('');
            };

            // ë°˜ì‘ ì¶”ê°€
            const addReaction = (postId, emoji) => {
                const path = `posts/${postId}/reactions/${myAnonymousId}`;
                db.ref(path).once('value', snap => {
                    if (snap.val() === emoji) {
                        db.ref(path).remove();
                    } else {
                        db.ref(path).set(emoji);
                    }
                });
            };

            // ëŒ“ê¸€ ì‘ì„±
            const writeComment = (postId) => {
                const content = commentInputs[postId];
                if (!content || !content.trim()) return;
                const commentId = Date.now().toString();
                db.ref(`posts/${postId}/comments/${commentId}`).set({
                    authorId: myAnonymousId,
                    content: content.trim(),
                    timestamp: Date.now()
                });
                setCommentInputs({...commentInputs, [postId]: ''});
            };

            // ëŒ“ê¸€ ì‘ì„±ìì˜ ìµëª… ë²ˆí˜¸ ê³„ì‚°
            const getCommentAuthorNumber = (post, authorId) => {
                if (!post.comments) return 1;
                
                const allCommentAuthors = new Set();
                Object.values(post.comments).forEach(c => allCommentAuthors.add(c.authorId));
                
                const sorted = Array.from(allCommentAuthors).sort();
                const index = sorted.indexOf(authorId);
                return index + 1;
            };

            // ì±„íŒ… ì „ì†¡
            const sendChat = () => {
                if (!chatMsg.trim()) return;
                db.ref('chatMessages').push({
                    nickname: chatNick,
                    message: chatMsg.trim(),
                    timestamp: Date.now()
                });
                setChatMsg('');
            };

            // ê±°ì§“ë§ íƒì§€
            const detectLie = () => {
                if (!detectorQuestion.trim()) return;
                setDetectorLoading(true);
                setDetectorResult(null);
                
                setTimeout(() => {
                    const isTrue = Math.random() > 0.5;
                    const trueReasons = [
                        'í†µê³„ì ìœ¼ë¡œ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤',
                        'ë…¼ë¦¬ì  ì¼ê´€ì„±ì´ ìˆìŠµë‹ˆë‹¤',
                        'ì‚¬ì‹¤ íŒ¨í„´ê³¼ ì¼ì¹˜í•©ë‹ˆë‹¤',
                        'ê²€ì¦ ê°€ëŠ¥í•œ ì •ë³´ì…ë‹ˆë‹¤',
                        'ì‹ ë¢°ë„ê°€ ë†’ìŠµë‹ˆë‹¤',
                        'ê°ê´€ì  ì¦ê±°ê°€ ìˆìŠµë‹ˆë‹¤',
                        'íƒ€ë‹¹ì„±ì´ ì¸ì •ë©ë‹ˆë‹¤',
                        'ê³¼í•™ì  ê·¼ê±°ê°€ ìˆìŠµë‹ˆë‹¤',
                        'ì—­ì‚¬ì  ì‚¬ì‹¤ê³¼ ë¶€í•©í•©ë‹ˆë‹¤',
                        'ì¼ë°˜ì ìœ¼ë¡œ ë°›ì•„ë“¤ì—¬ì§€ëŠ” ì‚¬ì‹¤ì…ë‹ˆë‹¤'
                    ];
                    const falseReasons = [
                        'ë…¼ë¦¬ì  ëª¨ìˆœì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤',
                        'í†µê³„ì ìœ¼ë¡œ ê°€ëŠ¥ì„±ì´ ë‚®ìŠµë‹ˆë‹¤',
                        'ì‚¬ì‹¤ íŒ¨í„´ê³¼ ë¶ˆì¼ì¹˜í•©ë‹ˆë‹¤',
                        'ê²€ì¦ ë¶ˆê°€ëŠ¥í•œ ì •ë³´ì…ë‹ˆë‹¤',
                        'ì‹ ë¢°ë„ê°€ ë‚®ìŠµë‹ˆë‹¤',
                        'ê°ê´€ì  ì¦ê±°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤',
                        'íƒ€ë‹¹ì„±ì´ ì˜ì‹¬ë©ë‹ˆë‹¤',
                        'ê³¼í•™ì  ê·¼ê±°ê°€ ì—†ìŠµë‹ˆë‹¤',
                        'ì—­ì‚¬ì  ì‚¬ì‹¤ê³¼ ë‹¤ë¦…ë‹ˆë‹¤',
                        'ì¼ë°˜ì ìœ¼ë¡œ í—ˆìœ„ë¡œ ì•Œë ¤ì ¸ ìˆìŠµë‹ˆë‹¤',
                        'ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ì§„ìˆ ì…ë‹ˆë‹¤',
                        'í™•ì¸ë˜ì§€ ì•Šì€ ì •ë³´ì…ë‹ˆë‹¤',
                        'ë¹„ë…¼ë¦¬ì  ì£¼ì¥ì…ë‹ˆë‹¤',
                        'ì‚¬ì‹¤ ê´€ê³„ê°€ ë¶ˆë¶„ëª…í•©ë‹ˆë‹¤',
                        'ì‹ ë¹™ì„±ì´ ë–¨ì–´ì§‘ë‹ˆë‹¤'
                    ];
                    
                    const reasons = isTrue ? trueReasons : falseReasons;
                    const reason = reasons[Math.floor(Math.random() * reasons.length)];
                    
                    setDetectorResult({
                        isTrue: isTrue,
                        reason: reason
                    });
                    setDetectorLoading(false);
                }, 2000);
            };

            // íˆ¬í‘œ ìƒì„±
            const createPoll = () => {
                if (!pollQuestion.trim()) return;
                const validOptions = pollOptions.filter(o => o.trim());
                if (validOptions.length < 2) {
                    alert('ìµœì†Œ 2ê°œ ì„ íƒì§€ í•„ìš”!');
                    return;
                }
                
                const pollId = Date.now().toString();
                db.ref(`polls/${pollId}`).set({
                    question: pollQuestion.trim(),
                    options: validOptions.map(o => o.trim()),
                    votes: {},
                    timestamp: Date.now()
                });
                
                setPollQuestion('');
                setPollOptions(['', '']);
            };

            // íˆ¬í‘œí•˜ê¸°
            const vote = (pollId, optionIndex) => {
                const fingerprint = localStorage.getItem('browserFingerprint') || 
                    'fp_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('browserFingerprint', fingerprint);
                
                db.ref(`polls/${pollId}/votes/${fingerprint}`).set(optionIndex);
                
                const newVotes = {...myVotes, [pollId]: optionIndex};
                setMyVotes(newVotes);
                localStorage.setItem('myVotes', JSON.stringify(newVotes));
            };

            // ë†ì¥ íšŒì›ê°€ì…
            const register = () => {
                if (!farmNick.trim() || !farmPass.trim()) {
                    alert('ë‹‰ë„¤ì„ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
                    return;
                }
                if (farmPass.length < 4) {
                    alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒ!');
                    return;
                }
                const exists = allUsers.find(u => u.nickname === farmNick.trim());
                if (exists) {
                    alert('ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„!');
                    return;
                }
                
                const uid = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                db.ref(`farmUsers/${uid}`).set({
                    nickname: farmNick.trim(),
                    password: btoa(farmPass),
                    length: 10,
                    lastCheckIn: 0,
                    createdAt: Date.now()
                }).then(() => {
                    localStorage.setItem('farmToken', uid);
                    setFarmUser({
                        id: uid,
                        nickname: farmNick.trim(),
                        length: 10,
                        lastCheckIn: 0
                    });
                    setFarmNick('');
                    setFarmPass('');
                    alert('íšŒì›ê°€ì… ì™„ë£Œ! ğŸ‰');
                });
            };

            // ë†ì¥ ë¡œê·¸ì¸
            const login = () => {
                if (!farmNick.trim() || !farmPass.trim()) {
                    alert('ë‹‰ë„¤ì„ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
                    return;
                }
                const user = allUsers.find(u => u.nickname === farmNick.trim());
                if (!user) {
                    alert('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê³„ì •!');
                    return;
                }
                if (user.password !== btoa(farmPass)) {
                    alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤!');
                    return;
                }
                localStorage.setItem('farmToken', user.id);
                setFarmUser(user);
                setFarmNick('');
                setFarmPass('');
                alert('ë¡œê·¸ì¸ ì„±ê³µ! ğŸŒ¶ï¸');
            };

            // ë¡œê·¸ì•„ì›ƒ
            const logout = () => {
                localStorage.removeItem('farmToken');
                setFarmUser(null);
            };

            // ì¶œì„ì²´í¬
            const checkIn = () => {
                if (!farmUser) return;
                const now = Date.now();
                if (farmUser.lastCheckIn && (now - farmUser.lastCheckIn) < 24 * 60 * 60 * 1000) {
                    alert('ì•„ì§ ì¶œì„ ë¶ˆê°€!');
                    return;
                }
                const growth = Math.floor(Math.random() * 100) + 1;
                const newLen = (farmUser.length || 10) + growth;
                db.ref(`farmUsers/${farmUser.id}`).update({
                    length: newLen,
                    lastCheckIn: now
                });
                db.ref('chatMessages').push({
                    nickname: 'ğŸŒ¶ï¸ ë†ì¥ ì‹œìŠ¤í…œ',
                    message: `${farmUser.nickname}ë‹˜ì´ ì¶œì„ì²´í¬ë¡œ ${growth}cm ì„±ì¥! (í˜„ì¬: ${newLen}cm)`,
                    timestamp: Date.now()
                });
                alert(`ğŸŒ¶ï¸ ${growth}cm ì„±ì¥! (í˜„ì¬: ${newLen}cm)`);
            };

            // PVP ì‹ ì²­
            const sendPvp = () => {
                if (!pvpTarget.trim() || !pvpAmount) return;
                if (!farmUser) return;
                const target = allUsers.find(u => u.nickname === pvpTarget.trim());
                if (!target) {
                    alert('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‚¬ìš©ì!');
                    return;
                }
                if (target.id === farmUser.id) {
                    alert('ìì‹ ì—ê²ŒëŠ” ë¶ˆê°€!');
                    return;
                }
                const amt = parseInt(pvpAmount);
                if (amt <= 0 || isNaN(amt)) {
                    alert('ì˜¬ë°”ë¥¸ ìˆ«ì!');
                    return;
                }
                if (farmUser.length < amt) {
                    alert('ë³´ìœ  ê¸¸ì´ ë¶€ì¡±!');
                    return;
                }
                if (target.length < amt) {
                    alert('ìƒëŒ€ë°© ê¸¸ì´ ë¶€ì¡±!');
                    return;
                }
                
                db.ref('pvpRequests').push({
                    fromId: farmUser.id,
                    fromName: farmUser.nickname,
                    toId: target.id,
                    toName: target.nickname,
                    amount: amt,
                    status: 'pending',
                    timestamp: Date.now()
                });
                
                // ì±„íŒ…ì— PVP ì‹ ì²­ ë°œí‘œ
                db.ref('chatMessages').push({
                    nickname: 'âš”ï¸ PVP ì‹œìŠ¤í…œ',
                    message: `${farmUser.nickname}ë‹˜ì´ ${target.nickname}ë‹˜ì—ê²Œ ${amt}cmë¥¼ ê±¸ê³  ë„ì „ ì‹ ì²­í–ˆìŠµë‹ˆë‹¤!`,
                    timestamp: Date.now()
                });
                
                setPvpTarget('');
                setPvpAmount('');
                alert('PVP ì‹ ì²­ ì™„ë£Œ!');
            };

            // PVP ìˆ˜ë½
            const acceptPvp = (req) => {
                if (!farmUser) return;
                
                // ì±„íŒ…ì— ìˆ˜ë½ ë°œí‘œ
                db.ref('chatMessages').push({
                    nickname: 'âš”ï¸ PVP ì‹œìŠ¤í…œ',
                    message: `${req.toName}ë‹˜ì´ ${req.fromName}ë‹˜ì˜ ë„ì „ì„ ìˆ˜ë½í–ˆìŠµë‹ˆë‹¤! ë°°í‹€ ì‹œì‘!`,
                    timestamp: Date.now()
                });
                
                const win = Math.random() > 0.5;
                const winnerId = win ? farmUser.id : req.fromId;
                const loserId = win ? req.fromId : farmUser.id;
                const winner = allUsers.find(u => u.id === winnerId);
                const loser = allUsers.find(u => u.id === loserId);
                if (!winner || !loser) return;
                
                const updates = {};
                updates[`farmUsers/${winnerId}/length`] = winner.length + req.amount;
                updates[`farmUsers/${loserId}/length`] = Math.max(0, loser.length - req.amount);
                updates[`pvpRequests/${req.id}/status`] = 'completed';
                db.ref().update(updates);
                
                // ë°°í‹€ ê²°ê³¼ ë°œí‘œ
                db.ref('chatMessages').push({
                    nickname: 'âš”ï¸ PVP ì‹œìŠ¤í…œ',
                    message: `${winner.nickname}ë‹˜ì´ ${loser.nickname}ë‹˜ì„ ì´ê¹€! ${req.amount}cm íšë“!`,
                    timestamp: Date.now()
                });
                
                setPvpResult({
                    winner: winner.nickname,
                    loser: loser.nickname,
                    amount: req.amount,
                    isWin: winnerId === farmUser.id
                });
                setTimeout(() => setPvpResult(null), 5000);
            };

            // PVP ê±°ì ˆ
            const rejectPvp = (reqId) => {
                const req = pvpReqs.find(r => r.id === reqId);
                if (req) {
                    db.ref(`pvpRequests/${reqId}`).update({ status: 'rejected' });
                    
                    // ì±„íŒ…ì— ê±°ì ˆ ë°œí‘œ
                    db.ref('chatMessages').push({
                        nickname: 'âš”ï¸ PVP ì‹œìŠ¤í…œ',
                        message: `${req.toName}ë‹˜ì´ ${req.fromName}ë‹˜ì˜ ë„ì „ì„ ê±°ì ˆí–ˆìŠµë‹ˆë‹¤.`,
                        timestamp: Date.now()
                    });
                }
            };

            return (
                <div className="container">
                    <div className="header">
                        <h1>ğŸŒ¶ï¸ ì»¤ë®¤ë‹ˆí‹° ì‚¬ì´íŠ¸</h1>
                    </div>
                    
                    <div className="tabs">
                        <button className={`tab ${tab==='board'?'active':''}`} onClick={()=>setTab('board')}>ğŸ“ ê²Œì‹œíŒ</button>
                        <button className={`tab ${tab==='chat'?'active':''}`} onClick={()=>setTab('chat')}>ğŸ’¬ ì±„íŒ…</button>
                        <button className={`tab ${tab==='detector'?'active':''}`} onClick={()=>setTab('detector')}>ğŸ” ê±°ì§“ë§íƒì§€ê¸°</button>
                        <button className={`tab ${tab==='poll'?'active':''}`} onClick={()=>setTab('poll')}>ğŸ—³ï¸ íˆ¬í‘œ</button>
                        <button className={`tab ${tab==='farm'?'active':''}`} onClick={()=>setTab('farm')}>ğŸŒ¶ï¸ ê³ ì¶”ë†ì¥</button>
                    </div>
                    
                    {/* ê²Œì‹œíŒ */}
                    {tab === 'board' && (
                        <div>
                            <div className="card">
                                <h3 style={{marginBottom: '15px'}}>ê²Œì‹œê¸€ ì‘ì„±</h3>
                                <input type="text" placeholder="ì‘ì„±ì ì´ë¦„" value={postAuthor} onChange={e=>setPostAuthor(e.target.value)} />
                                <input type="text" placeholder="ì œëª©" value={postTitle} onChange={e=>setPostTitle(e.target.value)} />
                                <textarea placeholder="ë‚´ìš©" value={postContent} onChange={e=>setPostContent(e.target.value)} />
                                <button className="btn" onClick={writePost}>ğŸ“ ì‘ì„±í•˜ê¸°</button>
                            </div>
                            
                            {posts.map(post => (
                                <div key={post.id} className="post">
                                    <div className="post-header">
                                        <span>{post.author || 'ìµëª…'}</span>
                                        <span>{new Date(post.timestamp).toLocaleString('ko-KR')}</span>
                                    </div>
                                    <h3 style={{marginBottom: '10px', fontSize: '1.3rem'}}>{post.title}</h3>
                                    <p style={{whiteSpace: 'pre-wrap', lineHeight: '1.6'}}>{post.content}</p>
                                    
                                    <div className="post-footer">
                                        {['ğŸ‘', 'â¤ï¸', 'ğŸ˜‚', 'ğŸ˜®', 'ğŸ˜¢', 'ğŸ˜¡'].map(emoji => {
                                            const count = post.reactions ? Object.values(post.reactions).filter(r => r === emoji).length : 0;
                                            const myReaction = post.reactions && post.reactions[myAnonymousId] === emoji;
                                            return (
                                                <button 
                                                    key={emoji}
                                                    className="reaction"
                                                    onClick={() => addReaction(post.id, emoji)}
                                                    style={{
                                                        background: myReaction ? '#e3f2fd' : '#f8f9fa',
                                                        border: myReaction ? '2px solid #2196f3' : '1px solid #e8e8e8'
                                                    }}
                                                >
                                                    {emoji} {count > 0 && count}
                                                </button>
                                            );
                                        })}
                                    </div>
                                    
                                    {post.comments && Object.keys(post.comments).length > 0 && (
                                        <div className="comments">
                                            <h4 style={{marginBottom: '10px', fontSize: '1rem'}}>
                                                ğŸ’¬ ëŒ“ê¸€ {Object.keys(post.comments).length}ê°œ
                                            </h4>
                                            {Object.entries(post.comments).sort((a,b) => a[1].timestamp - b[1].timestamp).map(([cid, comment]) => (
                                                <div key={cid} className="comment">
                                                    <div className="comment-header">
                                                        ìµëª…{getCommentAuthorNumber(post, comment.authorId)} Â· {new Date(comment.timestamp).toLocaleString('ko-KR')}
                                                    </div>
                                                    <div>{comment.content}</div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                    
                                    <div className="comment-input">
                                        <input 
                                            type="text"
                                            placeholder="ëŒ“ê¸€ ì‘ì„±..."
                                            value={commentInputs[post.id] || ''}
                                            onChange={e => setCommentInputs({...commentInputs, [post.id]: e.target.value})}
                                            onKeyPress={e => e.key === 'Enter' && writeComment(post.id)}
                                            style={{marginBottom: 0}}
                                        />
                                        <button className="btn btn-small" onClick={() => writeComment(post.id)}>ì‘ì„±</button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                    
                    {/* ì±„íŒ… */}
                    {tab === 'chat' && (
                        <div>
                            <div className="card" style={{background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', color: 'white'}}>
                                <h3>ğŸ’¬ ì‹¤ì‹œê°„ ì±„íŒ…</h3>
                                <p style={{fontSize: '1.1rem', marginTop: '10px'}}>ë‹¹ì‹ ì˜ ë‹‰ë„¤ì„: <strong>{chatNick} ğŸ²</strong></p>
                            </div>
                            <div className="chat-container" ref={chatRef}>
                                {messages.map(msg => (
                                    <div key={msg.id} className="chat-message">
                                        <div className="chat-header">{msg.nickname} Â· {new Date(msg.timestamp).toLocaleTimeString('ko-KR')}</div>
                                        <div>{msg.message}</div>
                                    </div>
                                ))}
                            </div>
                            <div style={{display: 'flex', gap: '10px'}}>
                                <input type="text" placeholder="ë©”ì‹œì§€ ì…ë ¥" value={chatMsg} onChange={e=>setChatMsg(e.target.value)} onKeyPress={e=>e.key==='Enter'&&sendChat()} style={{marginBottom: 0}} />
                                <button className="btn" onClick={sendChat} style={{width: 'auto', padding: '12px 30px'}}>ì „ì†¡</button>
                            </div>
                        </div>
                    )}
                    
                    {/* ê±°ì§“ë§íƒì§€ê¸° */}
                    {tab === 'detector' && (
                        <div>
                            <div className="card">
                                <h3 style={{marginBottom: '15px'}}>ğŸ” AI ê±°ì§“ë§ íƒì§€ê¸°</h3>
                                <p style={{color: '#666', marginBottom: '15px'}}>ì§ˆë¬¸ì„ ì…ë ¥í•˜ë©´ AIê°€ ì§„ì‹¤/ê±°ì§“ì„ íŒë‹¨í•©ë‹ˆë‹¤</p>
                                <input 
                                    type="text"
                                    placeholder="íŒë‹¨í•  ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”..."
                                    value={detectorQuestion}
                                    onChange={e=>setDetectorQuestion(e.target.value)}
                                    onKeyPress={e=>e.key==='Enter'&&!detectorLoading&&detectLie()}
                                />
                                <button className="btn" onClick={detectLie} disabled={detectorLoading || !detectorQuestion.trim()}>
                                    {detectorLoading ? 'â³ ë¶„ì„ ì¤‘...' : 'ğŸ” ì§„ì‹¤ ì—¬ë¶€ íŒë‹¨'}
                                </button>
                            </div>
                            
                            {detectorResult && (
                                <div className={`detector-result ${detectorResult.isTrue ? 'true' : 'false'}`}>
                                    <h2 style={{fontSize: '3rem', marginBottom: '20px'}}>
                                        {detectorResult.isTrue ? 'âœ… ì§„ì‹¤' : 'âŒ ê±°ì§“'}
                                    </h2>
                                    <p style={{fontSize: '1.3rem', fontWeight: 'bold', marginBottom: '10px'}}>
                                        {detectorQuestion}
                                    </p>
                                    <p style={{fontSize: '1.1rem', opacity: 0.9}}>
                                        ì´ìœ : {detectorResult.reason}
                                    </p>
                                </div>
                            )}
                        </div>
                    )}
                    
                    {/* íˆ¬í‘œ */}
                    {tab === 'poll' && (
                        <div>
                            <div className="card">
                                <h3 style={{marginBottom: '15px'}}>íˆ¬í‘œ ë§Œë“¤ê¸°</h3>
                                <input type="text" placeholder="ì§ˆë¬¸" value={pollQuestion} onChange={e=>setPollQuestion(e.target.value)} />
                                {pollOptions.map((opt, idx) => (
                                    <input 
                                        key={idx}
                                        type="text" 
                                        placeholder={`ì„ íƒì§€ ${idx+1}`}
                                        value={opt}
                                        onChange={e => {
                                            const newOpts = [...pollOptions];
                                            newOpts[idx] = e.target.value;
                                            setPollOptions(newOpts);
                                        }}
                                    />
                                ))}
                                <button className="btn" onClick={()=>setPollOptions([...pollOptions, ''])} style={{marginBottom: '10px'}}>+ ì„ íƒì§€ ì¶”ê°€</button>
                                <button className="btn" onClick={createPoll}>ğŸ“ íˆ¬í‘œ ìƒì„±</button>
                            </div>
                            
                            {polls.map(poll => {
                                const totalVotes = poll.votes ? Object.keys(poll.votes).length : 0;
                                const voteCounts = {};
                                if (poll.votes) {
                                    Object.values(poll.votes).forEach(v => {
                                        voteCounts[v] = (voteCounts[v] || 0) + 1;
                                    });
                                }
                                const myVote = myVotes[poll.id];
                                
                                return (
                                    <div key={poll.id} className="card">
                                        <h3 style={{marginBottom: '15px'}}>{poll.question}</h3>
                                        <p style={{color: '#666', fontSize: '0.9rem', marginBottom: '15px'}}>
                                            ì´ {totalVotes}í‘œ Â· {new Date(poll.timestamp).toLocaleString('ko-KR')}
                                        </p>
                                        {poll.options.map((opt, idx) => {
                                            const count = voteCounts[idx] || 0;
                                            const percent = totalVotes > 0 ? Math.round((count / totalVotes) * 100) : 0;
                                            const isMyVote = myVote === idx;
                                            
                                            return (
                                                <div 
                                                    key={idx}
                                                    style={{
                                                        padding: '15px',
                                                        background: isMyVote ? '#e3f2fd' : '#f8f9fa',
                                                        borderRadius: '8px',
                                                        marginBottom: '10px',
                                                        cursor: 'pointer',
                                                        border: isMyVote ? '2px solid #2196f3' : 'none',
                                                        position: 'relative',
                                                        overflow: 'hidden'
                                                    }}
                                                    onClick={() => vote(poll.id, idx)}
                                                >
                                                    <div style={{
                                                        position: 'absolute',
                                                        left: 0,
                                                        top: 0,
                                                        bottom: 0,
                                                        width: `${percent}%`,
                                                        background: 'rgba(33, 150, 243, 0.1)',
                                                        transition: 'width 0.3s'
                                                    }} />
                                                    <div style={{position: 'relative', display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                                                        <span style={{fontWeight: isMyVote ? 'bold' : 'normal'}}>
                                                            {isMyVote && 'âœ… '}{opt}
                                                        </span>
                                                        <span style={{fontWeight: 'bold', color: '#2196f3'}}>
                                                            {count}í‘œ ({percent}%)
                                                        </span>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                );
                            })}
                        </div>
                    )}
                    
                    {/* ê³ ì¶”ë†ì¥ */}
                    {tab === 'farm' && (
                        <div>
                            {/* ê²Œì„ ë£° ì„¤ëª… - ì ‘ê¸°/í¼ì¹˜ê¸° */}
                            <div className="card" style={{background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', color: 'white', cursor: 'pointer'}} onClick={()=>setShowRules(!showRules)}>
                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                                    <h2 style={{fontSize: '1.5rem'}}>ğŸŒ¶ï¸ ê³ ì¶”ë†ì¥ ê²Œì„ ê°€ì´ë“œ</h2>
                                    <span style={{fontSize: '1.5rem', fontWeight: 'bold'}}>
                                        {showRules ? 'â–²' : 'â–¼'}
                                    </span>
                                </div>
                                <p style={{fontSize: '0.9rem', opacity: 0.9, marginTop: '5px'}}>
                                    {showRules ? 'í´ë¦­í•˜ì—¬ ì ‘ê¸°' : 'í´ë¦­í•˜ì—¬ ê²Œì„ ë°©ë²• ë³´ê¸°'}
                                </p>
                                
                                {showRules && (
                                    <div style={{marginTop: '20px'}} onClick={e=>e.stopPropagation()}>
                                        <div style={{background: 'rgba(255,255,255,0.1)', padding: '20px', borderRadius: '12px', marginBottom: '15px'}}>
                                            <h3 style={{marginBottom: '10px', fontSize: '1.3rem'}}>ğŸ® ê²Œì„ ëª©í‘œ</h3>
                                            <p style={{lineHeight: '1.6', fontSize: '1.05rem'}}>
                                                ê³ ì¶”ë¥¼ í‚¤ì›Œì„œ <strong>1ë“±</strong>ì„ ì°¨ì§€í•˜ì„¸ìš”!<br/>
                                                ì¶œì„ì²´í¬ì™€ PVP ë°°í‹€ë¡œ ì„±ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                            </p>
                                        </div>
                                        
                                        <div style={{background: 'rgba(255,255,255,0.1)', padding: '20px', borderRadius: '12px', marginBottom: '15px'}}>
                                            <h3 style={{marginBottom: '10px', fontSize: '1.3rem'}}>ğŸŒ± ì‹œì‘</h3>
                                            <p style={{lineHeight: '1.6', fontSize: '1.05rem'}}>
                                                â€¢ íšŒì›ê°€ì… ì‹œ <strong>10cm</strong>ë¡œ ì‹œì‘<br/>
                                                â€¢ ë‹‰ë„¤ì„ì€ ì¤‘ë³µ ë¶ˆê°€<br/>
                                                â€¢ ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒ
                                            </p>
                                        </div>
                                        
                                        <div style={{background: 'rgba(255,255,255,0.1)', padding: '20px', borderRadius: '12px', marginBottom: '15px'}}>
                                            <h3 style={{marginBottom: '10px', fontSize: '1.3rem'}}>â­ ì¶œì„ì²´í¬</h3>
                                            <p style={{lineHeight: '1.6', fontSize: '1.05rem'}}>
                                                â€¢ <strong>24ì‹œê°„ë§ˆë‹¤</strong> 1íšŒ ê°€ëŠ¥<br/>
                                                â€¢ <strong>1~100cm</strong> ëœë¤ ì„±ì¥! ğŸ²<br/>
                                                â€¢ ìš´ì´ ì¢‹ìœ¼ë©´ 100cm ëŒ€ë°•!<br/>
                                                â€¢ íƒ€ì´ë¨¸ë¡œ ë‚¨ì€ ì‹œê°„ í™•ì¸ ê°€ëŠ¥<br/>
                                                â€¢ ì±„íŒ…ì— ìë™ìœ¼ë¡œ ë°œí‘œë¨
                                            </p>
                                        </div>
                                        
                                        <div style={{background: 'rgba(255,255,255,0.1)', padding: '20px', borderRadius: '12px', marginBottom: '15px'}}>
                                            <h3 style={{marginBottom: '10px', fontSize: '1.3rem'}}>âš”ï¸ PVP ë°°í‹€</h3>
                                            <p style={{lineHeight: '1.6', fontSize: '1.05rem'}}>
                                                â€¢ ë‹¤ë¥¸ ìœ ì €ì—ê²Œ <strong>ë„ì „ ì‹ ì²­</strong><br/>
                                                â€¢ ìƒëŒ€ë°©ì´ <strong>ìˆ˜ë½/ê±°ì ˆ</strong> ì„ íƒ<br/>
                                                â€¢ ìŠ¹ë¥ ì€ <strong>50%</strong> (ì™„ì „ ëœë¤!)<br/>
                                                â€¢ ì´ê¸°ë©´ ê±¸ì—ˆë˜ cmë¥¼ íšë“<br/>
                                                â€¢ ì§€ë©´ ê±¸ì—ˆë˜ cmë¥¼ ìƒìŒ<br/>
                                                â€¢ ë³¸ì¸ê³¼ ìƒëŒ€ë°© ëª¨ë‘ ì¶©ë¶„í•œ ê¸¸ì´ í•„ìš”<br/>
                                                â€¢ ë°°í‹€ ê²°ê³¼ëŠ” ì±„íŒ…ì— ìë™ ë°œí‘œ
                                            </p>
                                        </div>
                                        
                                        <div style={{background: 'rgba(255,255,255,0.1)', padding: '20px', borderRadius: '12px', marginBottom: '15px'}}>
                                            <h3 style={{marginBottom: '10px', fontSize: '1.3rem'}}>ğŸ† ë­í‚¹ ì‹œìŠ¤í…œ</h3>
                                            <p style={{lineHeight: '1.6', fontSize: '1.05rem'}}>
                                                â€¢ ì‹¤ì‹œê°„ ìˆœìœ„ í‘œì‹œ<br/>
                                                â€¢ 1ìœ„ ğŸ¥‡ / 2ìœ„ ğŸ¥ˆ / 3ìœ„ ğŸ¥‰<br/>
                                                â€¢ ë‚´ ìˆœìœ„ëŠ” íŒŒë€ìƒ‰ìœ¼ë¡œ í‘œì‹œ<br/>
                                                â€¢ ê¸¸ì´ ìˆœìœ¼ë¡œ ìë™ ì •ë ¬
                                            </p>
                                        </div>
                                        
                                        <div style={{background: 'rgba(255,255,255,0.1)', padding: '20px', borderRadius: '12px'}}>
                                            <h3 style={{marginBottom: '10px', fontSize: '1.3rem'}}>ğŸ’¡ íŒ</h3>
                                            <p style={{lineHeight: '1.6', fontSize: '1.05rem'}}>
                                                â€¢ ë§¤ì¼ ì¶œì„ì²´í¬í•˜ë©´ ê¾¸ì¤€íˆ ì„±ì¥!<br/>
                                                â€¢ PVPëŠ” ì‹ ì¤‘í•˜ê²Œ! ì˜ëª»í•˜ë©´ ê¸¸ì´ ê°ì†Œ<br/>
                                                â€¢ ì±„íŒ… íƒ­ì—ì„œ ë‹¤ë¥¸ ìœ ì € ì„±ì¥ í™•ì¸ ê°€ëŠ¥<br/>
                                                â€¢ ê¸¸ì´ê°€ ì¶©ë¶„í•˜ë©´ í° ê¸ˆì•¡ìœ¼ë¡œ ë„ì „!
                                            </p>
                                        </div>
                                    </div>
                                )}
                            </div>
                            
                            {!farmUser ? (
                                <div className="card" style={{maxWidth: '500px', margin: '0 auto'}}>
                                    <h2 style={{textAlign: 'center', marginBottom: '20px'}}>ğŸŒ¶ï¸ ê³ ì¶”ë†ì¥ {isLogin ? 'ë¡œê·¸ì¸' : 'íšŒì›ê°€ì…'}</h2>
                                    <input type="text" placeholder="ë‹‰ë„¤ì„" value={farmNick} onChange={e=>setFarmNick(e.target.value)} />
                                    <input type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ (4ì ì´ìƒ)" value={farmPass} onChange={e=>setFarmPass(e.target.value)} onKeyPress={e=>e.key==='Enter'&&(isLogin?login():register())} />
                                    <button className="btn" onClick={isLogin ? login : register} disabled={!farmNick.trim() || !farmPass.trim()}>
                                        {isLogin ? 'ğŸšª ë¡œê·¸ì¸' : 'ğŸŒ± íšŒì›ê°€ì…'}
                                    </button>
                                    <div style={{textAlign: 'center', marginTop: '15px'}}>
                                        <button onClick={()=>setIsLogin(!isLogin)} style={{background: 'none', border: 'none', color: '#4a90e2', cursor: 'pointer', textDecoration: 'underline'}}>
                                            {isLogin ? 'íšŒì›ê°€ì…í•˜ê¸°' : 'ë¡œê·¸ì¸í•˜ê¸°'}
                                        </button>
                                    </div>
                                </div>
                            ) : (
                                <div>
                                    {pvpResult && (
                                        <div className={`pvp-result ${pvpResult.isWin ? 'win' : 'lose'}`}>
                                            <h2 style={{fontSize: '2.5rem', marginBottom: '15px'}}>
                                                {pvpResult.isWin ? 'ğŸ‰ ìŠ¹ë¦¬!' : 'ğŸ˜¢ íŒ¨ë°°...'}
                                            </h2>
                                            <p style={{fontSize: '1.3rem', fontWeight: 'bold'}}>
                                                {pvpResult.winner} vs {pvpResult.loser}
                                            </p>
                                            <p style={{fontSize: '1.1rem', marginTop: '10px'}}>
                                                {pvpResult.amount}cm ì´ë™!
                                            </p>
                                        </div>
                                    )}
                                    
                                    <div className="card" style={{background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', color: 'white'}}>
                                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px'}}>
                                            <h2>{farmUser.nickname}ë‹˜ì˜ ë†ì¥</h2>
                                            <button onClick={logout} style={{background: 'rgba(255,255,255,0.2)', border: '1px solid white', color: 'white', padding: '8px 20px', borderRadius: '20px', cursor: 'pointer'}}>ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
                                        </div>
                                        <div style={{fontSize: '4rem', textAlign: 'center', margin: '20px 0'}}>ğŸŒ¶ï¸</div>
                                        <div style={{fontSize: '3rem', fontWeight: 'bold', textAlign: 'center', marginBottom: '20px'}}>{farmUser.length}cm</div>
                                        <div style={{background: 'rgba(255,255,255,0.2)', padding: '20px', borderRadius: '12px', textAlign: 'center', marginBottom: '20px'}}>
                                            <div style={{fontSize: '1.5rem', fontWeight: 'bold'}}>â° {timer}</div>
                                        </div>
                                        <button className="btn" onClick={checkIn} disabled={timer !== 'ì¶œì„ ê°€ëŠ¥!'} style={{background: timer === 'ì¶œì„ ê°€ëŠ¥!' ? 'white' : 'rgba(255,255,255,0.3)', color: timer === 'ì¶œì„ ê°€ëŠ¥!' ? '#667eea' : 'rgba(255,255,255,0.7)'}}>
                                            â­ ì¶œì„ì²´í¬ (1~100cm)
                                        </button>
                                    </div>
                                    
                                    {pvpReqs.length > 0 && (
                                        <div className="card">
                                            <h3 style={{marginBottom: '15px'}}>âš”ï¸ PVP ìš”ì²­</h3>
                                            {pvpReqs.map(req => {
                                                const isReceived = req.toId === farmUser.id;
                                                return (
                                                    <div key={req.id} style={{padding: '15px', background: '#f8f9fa', borderRadius: '8px', marginBottom: '10px'}}>
                                                        {isReceived ? (
                                                            <>
                                                                <div style={{marginBottom: '10px', fontWeight: 'bold'}}>
                                                                    {req.fromName}ë‹˜ì´ {req.amount}cmë¥¼ ê±¸ê³  ë„ì „!
                                                                </div>
                                                                <div style={{display: 'flex', gap: '10px'}}>
                                                                    <button className="btn" onClick={()=>acceptPvp(req)} style={{flex: 1, background: 'linear-gradient(135deg, #4caf50 0%, #66bb6a 100%)'}}>âœ… ìˆ˜ë½</button>
                                                                    <button className="btn" onClick={()=>rejectPvp(req.id)} style={{flex: 1, background: 'linear-gradient(135deg, #f44336 0%, #ef5350 100%)'}}>âŒ ê±°ì ˆ</button>
                                                                </div>
                                                            </>
                                                        ) : (
                                                            <div style={{color: '#666'}}>
                                                                {req.toName}ë‹˜ì—ê²Œ {req.amount}cm ë„ì „ ëŒ€ê¸° ì¤‘...
                                                            </div>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    )}
                                    
                                    <div className="card">
                                        <h3 style={{marginBottom: '15px'}}>âš”ï¸ PVP ë„ì „í•˜ê¸°</h3>
                                        <input type="text" placeholder="ìƒëŒ€ë°© ë‹‰ë„¤ì„" value={pvpTarget} onChange={e=>setPvpTarget(e.target.value)} />
                                        <input type="number" placeholder="ê±¸ cm (ìˆ«ì)" value={pvpAmount} onChange={e=>setPvpAmount(e.target.value)} min="1" />
                                        <button className="btn" onClick={sendPvp} disabled={!pvpTarget.trim() || !pvpAmount}>âš”ï¸ PVP ì‹ ì²­</button>
                                    </div>
                                    
                                    <div className="card">
                                        <h3 style={{marginBottom: '15px'}}>ğŸ† ë­í‚¹</h3>
                                        {allUsers.map((user, idx) => (
                                            <div key={user.id} style={{padding: '15px', background: user.id === farmUser.id ? '#e3f2fd' : '#f8f9fa', borderRadius: '8px', marginBottom: '10px', display: 'flex', justifyContent: 'space-between', border: user.id === farmUser.id ? '2px solid #2196f3' : 'none'}}>
                                                <div style={{display: 'flex', alignItems: 'center', gap: '10px'}}>
                                                    <span style={{fontSize: '1.5rem', fontWeight: 'bold', color: idx === 0 ? '#ffd700' : idx === 1 ? '#c0c0c0' : idx === 2 ? '#cd7f32' : '#999'}}>{idx + 1}</span>
                                                    <span style={{fontWeight: 'bold'}}>{user.nickname}</span>
                                                    {user.id === farmUser.id && <span style={{background: '#2196f3', color: 'white', padding: '2px 10px', borderRadius: '12px', fontSize: '0.8rem'}}>ë‚˜</span>}
                                                </div>
                                                <div style={{fontSize: '1.3rem', fontWeight: 'bold', color: '#4caf50'}}>ğŸŒ¶ï¸ {user.length}cm</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
