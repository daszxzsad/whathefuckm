<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìµëª… ê²Œì‹œíŒ</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #f5f7fa; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; padding: 20px; background: white; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); flex-wrap: wrap; }
        .tab { flex: 1; min-width: 80px; padding: 12px; border: none; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; background: #f5f7fa; color: #7f8c8d; transition: all 0.3s; }
        .tab.active { background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%); color: white; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        input, textarea, select { width: 100%; padding: 12px; border: 2px solid #e8e8e8; border-radius: 8px; font-size: 1rem; margin-bottom: 10px; font-family: inherit; }
        textarea { min-height: 100px; resize: vertical; }
        .btn { width: 100%; padding: 14px; background: #4a90e2; color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .btn:hover { background: #357abd; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .btn-small { width: auto; padding: 8px 15px; font-size: 0.9rem; }
        .post { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .post-header { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.9rem; color: #666; }
        .post-footer { display: flex; gap: 10px; margin-top: 15px; padding-top: 15px; border-top: 1px solid #f0f0f0; }
        .reaction { padding: 8px 12px; background: #f8f9fa; border: 1px solid #e8e8e8; border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; }
        .reaction:hover { background: #e8ecef; }
        .comments { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 15px; }
        .comment { background: white; padding: 12px; border-radius: 8px; margin-bottom: 10px; }
        .comment-header { font-size: 0.85rem; color: #666; margin-bottom: 5px; }
        .comment-input { display: flex; gap: 10px; margin-top: 10px; }
        .chat-container { height: 500px; overflow-y: auto; background: #f8f9fa; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .chat-message { background: white; padding: 12px; border-radius: 8px; margin-bottom: 10px; }
        .chat-header { font-weight: bold; color: #4a90e2; margin-bottom: 5px; font-size: 0.9rem; }
        .detector-result { padding: 30px; border-radius: 12px; margin: 20px 0; text-align: center; animation: fadeIn 0.5s; }
        .detector-result.true { background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%); color: white; }
        .detector-result.false { background: linear-gradient(135deg, #f44336 0%, #ef5350 100%); color: white; }
        .pvp-result { padding: 30px; border-radius: 12px; text-align: center; margin-bottom: 20px; color: white; animation: fadeIn 0.5s; }
        .pvp-result.win { background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%); }
        .pvp-result.lose { background: linear-gradient(135deg, #f44336 0%, #ef5350 100%); }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyDh3FsyWVZqy8wGExv-IlAglJ0DERuW_T8",
            authDomain: "ccccc-74256.firebaseapp.com",
            databaseURL: "https://ccccc-74256-default-rtdb.firebaseio.com",
            projectId: "ccccc-74256",
            storageBucket: "ccccc-74256.firebasestorage.app",
            messagingSenderId: "1086870817114",
            appId: "1:1086870817114:web:8fb533c96f3402bfe78b63"
        };
        
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();

        function App() {
            const [tab, setTab] = useState('board');
            
            // ê²Œì‹œíŒ
            const [posts, setPosts] = useState([]);
            const [postTitle, setPostTitle] = useState('');
            const [postContent, setPostContent] = useState('');
            const [postAuthor, setPostAuthor] = useState('');
            const [myAnonymousId, setMyAnonymousId] = useState('');
            const [commentInputs, setCommentInputs] = useState({});
            
            // ì±„íŒ…
            const [messages, setMessages] = useState([]);
            const [chatMsg, setChatMsg] = useState('');
            const [chatNick, setChatNick] = useState('');
            const chatRef = useRef(null);
            
            // ê±°ì§“ë§íƒì§€ê¸°
            const [detectorQuestion, setDetectorQuestion] = useState('');
            const [detectorResult, setDetectorResult] = useState(null);
            const [detectorLoading, setDetectorLoading] = useState(false);
            
            // íˆ¬í‘œ
            const [polls, setPolls] = useState([]);
            const [pollQuestion, setPollQuestion] = useState('');
            const [pollOptions, setPollOptions] = useState(['', '']);
            const [myVotes, setMyVotes] = useState({});
            
            // ë†ì¥
            const [farmUser, setFarmUser] = useState(null);
            const [farmNick, setFarmNick] = useState('');
            const [farmPass, setFarmPass] = useState('');
            const [isLogin, setIsLogin] = useState(true);
            const [allUsers, setAllUsers] = useState([]);
            const [timer, setTimer] = useState('');
            const [pvpTarget, setPvpTarget] = useState('');
            const [pvpAmount, setPvpAmount] = useState('');
            const [pvpReqs, setPvpReqs] = useState([]);
            const [pvpResult, setPvpResult] = useState(null);
            const [showRules, setShowRules] = useState(false);
            
            // ê°•í™”
            const [forgeResult, setForgeResult] = useState(null);
            const [forging, setForging] = useState(false);

            // ìµëª… ID ìƒì„±
            useEffect(() => {
                let id = localStorage.getItem('anonymousId');
                if (!id) {
                    id = 'anon_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('anonymousId', id);
                }
                setMyAnonymousId(id);
            }, []);

            // ê²Œì‹œíŒ ë¡œë“œ
            useEffect(() => {
                db.ref('posts').limitToLast(50).on('value', snap => {
                    const data = snap.val();
                    if (data) {
                        const arr = Object.keys(data).map(k => ({id: k, ...data[k]})).sort((a,b) => b.timestamp - a.timestamp);
                        setPosts(arr);
                    } else {
                        setPosts([]);
                    }
                });
            }, []);

            // ì±„íŒ… ë¡œë“œ
            useEffect(() => {
                db.ref('chatMessages').limitToLast(100).on('value', snap => {
                    const data = snap.val();
                    if (data) {
                        const arr = Object.keys(data).map(k => ({id: k, ...data[k]})).sort((a,b) => a.timestamp - b.timestamp);
                        setMessages(arr);
                    }
                });
            }, []);
            
            // ì±„íŒ… ìë™ ìŠ¤í¬ë¡¤
            useEffect(() => {
                if (chatRef.current && messages.length > 0) {
                    chatRef.current.scrollTop = chatRef.current.scrollHeight;
                }
            }, [messages]);
            
            // íƒ­ ë³€ê²½ ì‹œ ì±„íŒ… ìŠ¤í¬ë¡¤
            useEffect(() => {
                if (tab === 'chat' && chatRef.current) {
                    setTimeout(() => {
                        if (chatRef.current) {
                            chatRef.current.scrollTop = chatRef.current.scrollHeight;
                        }
                    }, 100);
                }
            }, [tab]);

            // ì±„íŒ… ë‹‰ë„¤ì„
            useEffect(() => {
                let nick = localStorage.getItem('chatRandomNickname');
                if (!nick) {
                    const names = ['ì„ì›…', 'ëª…ì§„', 'ë¯¼ìˆ˜', 'ì¶©ì—°', 'ë¯¼ê¸°', 'ë¯¼í˜¸', 'ì‹ ìš°', 'ëŒ€ì›…'];
                    nick = names[Math.floor(Math.random() * names.length)];
                    localStorage.setItem('chatRandomNickname', nick);
                }
                setChatNick(nick);
            }, []);

            // íˆ¬í‘œ ë¡œë“œ
            useEffect(() => {
                db.ref('polls').on('value', snap => {
                    const data = snap.val();
                    if (data) {
                        const arr = Object.keys(data).map(k => ({id: k, ...data[k]})).sort((a,b) => b.timestamp - a.timestamp);
                        setPolls(arr);
                    } else {
                        setPolls([]);
                    }
                });
                
                const saved = localStorage.getItem('myVotes');
                if (saved) {
                    try {
                        setMyVotes(JSON.parse(saved));
                    } catch (e) {}
                }
            }, []);

            // ë†ì¥ ìœ ì € ë¡œë“œ
            useEffect(() => {
                db.ref('farmUsers').on('value', snap => {
                    const data = snap.val();
                    if (data) {
                        const arr = Object.keys(data).map(k => ({id: k, ...data[k]})).sort((a,b) => b.length - a.length);
                        setAllUsers(arr);
                        
                        const token = localStorage.getItem('farmToken');
                        if (token) {
                            const me = arr.find(u => u.id === token);
                            if (me) setFarmUser(me);
                        }
                    }
                });
            }, []);

            // PVP ìš”ì²­ ë¡œë“œ
            useEffect(() => {
                db.ref('pvpRequests').on('value', snap => {
                    const data = snap.val();
                    const token = localStorage.getItem('farmToken');
                    if (data && token) {
                        const arr = Object.keys(data).map(k => ({id: k, ...data[k]}))
                            .filter(r => r.status === 'pending')
                            .sort((a,b) => b.timestamp - a.timestamp);
                        setPvpReqs(arr);
                    } else {
                        setPvpReqs([]);
                    }
                });
            }, []);

            // íƒ€ì´ë¨¸
            useEffect(() => {
                const update = () => {
                    if (!farmUser || !farmUser.lastCheckIn) {
                        setTimer('ì¶œì„ ê°€ëŠ¥!');
                        return;
                    }
                    const now = Date.now();
                    const diff = now - farmUser.lastCheckIn;
                    const cooldown = 24 * 60 * 60 * 1000;
                    if (diff >= cooldown) {
                        setTimer('ì¶œì„ ê°€ëŠ¥!');
                    } else {
                        const left = cooldown - diff;
                        const h = Math.floor(left / 3600000);
                        const m = Math.floor((left % 3600000) / 60000);
                        const s = Math.floor((left % 60000) / 1000);
                        setTimer(`${h}ì‹œê°„ ${m}ë¶„ ${s}ì´ˆ`);
                    }
                };
                update();
                const iv = setInterval(update, 1000);
                return () => clearInterval(iv);
            }, [farmUser]);

            // ê²Œì‹œê¸€ ì‘ì„±
            const writePost = () => {
                if (!postTitle.trim() || !postContent.trim() || !postAuthor.trim()) {
                    alert('ì œëª©, ë‚´ìš©, ì‘ì„±ìë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”!');
                    return;
                }
                const postId = Date.now().toString();
                db.ref(`posts/${postId}`).set({
                    title: postTitle.trim(),
                    content: postContent.trim(),
                    author: postAuthor.trim(),
                    timestamp: Date.now(),
                    reactions: {},
                    comments: {}
                });
                setPostTitle('');
                setPostContent('');
                setPostAuthor('');
            };

            // ë°˜ì‘ ì¶”ê°€
            const addReaction = (postId, emoji) => {
                const path = `posts/${postId}/reactions/${myAnonymousId}`;
                db.ref(path).once('value', snap => {
                    if (snap.val() === emoji) {
                        db.ref(path).remove();
                    } else {
                        db.ref(path).set(emoji);
                    }
                });
            };

            // ëŒ“ê¸€ ì‘ì„±
            const writeComment = (postId) => {
                const content = commentInputs[postId];
                if (!content || !content.trim()) return;
                const commentId = Date.now().toString();
                db.ref(`posts/${postId}/comments/${commentId}`).set({
                    authorId: myAnonymousId,
                    content: content.trim(),
                    timestamp: Date.now()
                });
                setCommentInputs({...commentInputs, [postId]: ''});
            };

            // ëŒ“ê¸€ ì‘ì„±ìì˜ ìµëª… ë²ˆí˜¸ ê³„ì‚°
            const getCommentAuthorNumber = (post, authorId) => {
                if (!post.comments) return 1;
                
                const allCommentAuthors = new Set();
                Object.values(post.comments).forEach(c => allCommentAuthors.add(c.authorId));
                
                const sorted = Array.from(allCommentAuthors).sort();
                const index = sorted.indexOf(authorId);
                return index + 1;
            };

            // ì±„íŒ… ì „ì†¡
            const sendChat = () => {
                if (!chatMsg.trim()) return;
                db.ref('chatMessages').push({
                    nickname: chatNick,
                    message: chatMsg.trim(),
                    timestamp: Date.now()
                });
                setChatMsg('');
            };

            // ê±°ì§“ë§ íƒì§€
            const detectLie = () => {
                if (!detectorQuestion.trim()) return;
                setDetectorLoading(true);
                setDetectorResult(null);
                
                setTimeout(() => {
                    const isTrue = Math.random() > 0.5;
                    const trueReasons = [
                        'í†µê³„ì ìœ¼ë¡œ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤',
                        'ë…¼ë¦¬ì  ì¼ê´€ì„±ì´ ìˆìŠµë‹ˆë‹¤',
                        'ì‚¬ì‹¤ íŒ¨í„´ê³¼ ì¼ì¹˜í•©ë‹ˆë‹¤',
                        'ê²€ì¦ ê°€ëŠ¥í•œ ì •ë³´ì…ë‹ˆë‹¤',
                        'ì‹ ë¢°ë„ê°€ ë†’ìŠµë‹ˆë‹¤',
                        'ê°ê´€ì  ì¦ê±°ê°€ ìˆìŠµë‹ˆë‹¤',
                        'íƒ€ë‹¹ì„±ì´ ì¸ì •ë©ë‹ˆë‹¤',
                        'ê³¼í•™ì  ê·¼ê±°ê°€ ìˆìŠµë‹ˆë‹¤',
                        'ì—­ì‚¬ì  ì‚¬ì‹¤ê³¼ ë¶€í•©í•©ë‹ˆë‹¤',
                        'ì¼ë°˜ì ìœ¼ë¡œ ë°›ì•„ë“¤ì—¬ì§€ëŠ” ì‚¬ì‹¤ì…ë‹ˆë‹¤'
                    ];
                    const falseReasons = [
                        'ë…¼ë¦¬ì  ëª¨ìˆœì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤',
                        'í†µê³„ì ìœ¼ë¡œ ê°€ëŠ¥ì„±ì´ ë‚®ìŠµë‹ˆë‹¤',
                        'ì‚¬ì‹¤ íŒ¨í„´ê³¼ ë¶ˆì¼ì¹˜í•©ë‹ˆë‹¤',
                        'ê²€ì¦ ë¶ˆê°€ëŠ¥í•œ ì •ë³´ì…ë‹ˆë‹¤',
                        'ì‹ ë¢°ë„ê°€ ë‚®ìŠµë‹ˆë‹¤',
                        'ê°ê´€ì  ì¦ê±°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤',
                        'íƒ€ë‹¹ì„±ì´ ì˜ì‹¬ë©ë‹ˆë‹¤',
                        'ê³¼í•™ì  ê·¼ê±°ê°€ ì—†ìŠµë‹ˆë‹¤',
                        'ì—­ì‚¬ì  ì‚¬ì‹¤ê³¼ ë‹¤ë¦…ë‹ˆë‹¤',
                        'ì¼ë°˜ì ìœ¼ë¡œ í—ˆìœ„ë¡œ ì•Œë ¤ì ¸ ìˆìŠµë‹ˆë‹¤',
                        'ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ì§„ìˆ ì…ë‹ˆë‹¤',
                        'í™•ì¸ë˜ì§€ ì•Šì€ ì •ë³´ì…ë‹ˆë‹¤',
                        'ë¹„ë…¼ë¦¬ì  ì£¼ì¥ì…ë‹ˆë‹¤',
                        'ì‚¬ì‹¤ ê´€ê³„ê°€ ë¶ˆë¶„ëª…í•©ë‹ˆë‹¤',
                        'ì‹ ë¹™ì„±ì´ ë–¨ì–´ì§‘ë‹ˆë‹¤'
                    ];
                    
                    const reasons = isTrue ? trueReasons : falseReasons;
                    const reason = reasons[Math.floor(Math.random() * reasons.length)];
                    
                    setDetectorResult({
                        isTrue: isTrue,
                        reason: reason
                    });
                    setDetectorLoading(false);
                }, 2000);
            };

            // íˆ¬í‘œ ìƒì„±
            const createPoll = () => {
                if (!pollQuestion.trim()) return;
                const validOptions = pollOptions.filter(o => o.trim());
                if (validOptions.length < 2) {
                    alert('ìµœì†Œ 2ê°œ ì„ íƒì§€ í•„ìš”!');
                    return;
                }
                
                const pollId = Date.now().toString();
                db.ref(`polls/${pollId}`).set({
                    question: pollQuestion.trim(),
                    options: validOptions.map(o => o.trim()),
                    votes: {},
                    timestamp: Date.now()
                });
                
                setPollQuestion('');
                setPollOptions(['', '']);
            };

            // íˆ¬í‘œí•˜ê¸°
            const vote = (pollId, optionIndex) => {
                const fingerprint = localStorage.getItem('browserFingerprint') || 
                    'fp_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('browserFingerprint', fingerprint);
                
                db.ref(`polls/${pollId}/votes/${fingerprint}`).set(optionIndex);
                
                const newVotes = {...myVotes, [pollId]: optionIndex};
                setMyVotes(newVotes);
                localStorage.setItem('myVotes', JSON.stringify(newVotes));
            };

            // ë†ì¥ íšŒì›ê°€ì…
            const register = () => {
                if (!farmNick.trim() || !farmPass.trim()) {
                    alert('ë‹‰ë„¤ì„ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
                    return;
                }
                if (farmPass.length < 4) {
                    alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒ!');
                    return;
                }
                const exists = allUsers.find(u => u.nickname === farmNick.trim());
                if (exists) {
                    alert('ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„!');
                    return;
                }
                
                const uid = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                db.ref(`farmUsers/${uid}`).set({
                    nickname: farmNick.trim(),
                    password: btoa(farmPass),
                    length: 10,
                    lastCheckIn: 0,
                    createdAt: Date.now()
                }).then(() => {
                    localStorage.setItem('farmToken', uid);
                    setFarmUser({
                        id: uid,
                        nickname: farmNick.trim(),
                        length: 10,
                        lastCheckIn: 0
                    });
                    setFarmNick('');
                    setFarmPass('');
                    alert('íšŒì›ê°€ì… ì™„ë£Œ! ğŸ‰');
                });
            };

            // ë†ì¥ ë¡œê·¸ì¸
            const login = () => {
                if (!farmNick.trim() || !farmPass.trim()) {
                    alert('ë‹‰ë„¤ì„ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
                    return;
                }
                const user = allUsers.find(u => u.nickname === farmNick.trim());
                if (!user) {
                    alert('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê³„ì •!');
                    return;
                }
                if (user.password !== btoa(farmPass)) {
                    alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤!');
                    return;
                }
                localStorage.setItem('farmToken', user.id);
                setFarmUser(user);
                setFarmNick('');
                setFarmPass('');
                alert('ë¡œê·¸ì¸ ì„±ê³µ! ğŸŒ¶ï¸');
            };

            // ë¡œê·¸ì•„ì›ƒ
            const logout = () => {
                localStorage.removeItem('farmToken');
                setFarmUser(null);
            };
            
            // ê³ ì¶” ë“±ê¸‰ ê³„ì‚° (20ë‹¨ê³„)
            const getGrade = (length) => {
                if (length >= 2501) return { name: 'ğŸŒŸ ì‹ ì˜ ì˜ì—­ì— ë„ë‹¬í•œ ê³ ì¶”', color: '#000', emoji: 'ğŸ‘ï¸' };
                if (length >= 2001) return { name: 'ğŸŒ€ ì°¨ì›ì„ ì´ˆì›”í•œ ê³ ì¶”', color: '#4a148c', emoji: 'ğŸ”®' };
                if (length >= 1601) return { name: 'ğŸŒŒ ìš°ì£¼ë¥¼ í’ˆì€ ê³ ì¶”', color: '#6a1b9a', emoji: 'âœ¨' };
                if (length >= 1301) return { name: 'ğŸ‘ï¸ ì ˆëŒ€ìì˜ ê³ ì¶”', color: '#7b1fa2', emoji: 'âš¡' };
                if (length >= 1001) return { name: 'ğŸ”± ì‹ ì„±í•œ ê³ ì¶”', color: '#8e24aa', emoji: 'ğŸ’«' };
                if (length >= 801) return { name: 'â˜€ï¸ ì²œìƒì˜ ê³ ì¶”', color: '#9c27b0', emoji: 'ğŸŒŸ' };
                if (length >= 651) return { name: 'â­ ì´ˆì›”ì˜ ê³ ì¶”', color: '#ab47bc', emoji: 'ğŸ’ ' };
                if (length >= 501) return { name: 'ğŸ’« ë¶ˆë©¸ì˜ ê³ ì¶”', color: '#ba68c8', emoji: 'ğŸ†' };
                if (length >= 401) return { name: 'ğŸ‘‘ ì‹ í™”ì˜ ê³ ì¶”', color: '#e91e63', emoji: 'ğŸ’' };
                if (length >= 301) return { name: 'ğŸ† ì „ì„¤ì˜ ê³ ì¶”', color: '#f44336', emoji: 'ğŸ”¥' };
                if (length >= 251) return { name: 'ğŸ’ ì°¬ë€í•œ ê³ ì¶”', color: '#ff5722', emoji: 'âœ¨' };
                if (length >= 201) return { name: 'ğŸ’  ì˜ë¡±í•œ ê³ ì¶”', color: '#ff6f00', emoji: 'ğŸ”·' };
                if (length >= 161) return { name: 'âš¡ ë‹¹ë‹¹í•œ ê³ ì¶”', color: '#ff9800', emoji: 'â­' };
                if (length >= 131) return { name: 'ğŸ”· ìœ„ì—„ìˆëŠ” ê³ ì¶”', color: '#ffc107', emoji: 'ğŸŒŸ' };
                if (length >= 101) return { name: 'âœ¨ ìœ¤ê¸°ë‚˜ëŠ” ê³ ì¶”', color: '#ffeb3b', emoji: 'ğŸ’§' };
                if (length >= 81) return { name: 'ğŸŒŸ íƒìŠ¤ëŸ¬ìš´ ê³ ì¶”', color: '#8bc34a', emoji: 'ğŸ€' };
                if (length >= 61) return { name: 'ğŸ€ ì”¨ì•Œì´ êµµì€ ê³ ì¶”', color: '#4caf50', emoji: 'ğŸŒ¿' };
                if (length >= 41) return { name: 'ğŸŒ¿ íƒ±íƒ±í•œ ê³ ì¶”', color: '#00bcd4', emoji: 'ğŸ’š' };
                if (length >= 21) return { name: 'ğŸŒ¾ ë§ë‘ë§ë‘ ê³ ì¶”', color: '#03a9f4', emoji: 'ğŸŒ±' };
                return { name: 'ğŸŒ± ì­ˆê¸€ì­ˆê¸€ ê³ ì¶”', color: '#999', emoji: 'ğŸ˜¢' };
            };
            
            // ê°•í™” ì„±ê³µ í™•ë¥  ê³„ì‚° (ëŒ€í­ ë‚®ì¶¤)
            const getSuccessRate = (length) => {
                if (length >= 2501) return 1;   // ì‹ ì˜ ì˜ì—­
                if (length >= 2001) return 2;   // ì°¨ì›ì„ ì´ˆì›”í•œ
                if (length >= 1601) return 3;   // ìš°ì£¼ ìµœê°•
                if (length >= 1301) return 4;   // ì ˆëŒ€ì
                if (length >= 1001) return 5;   // ì‹ ì„±í•œ
                if (length >= 801) return 7;    // ì²œìƒì˜
                if (length >= 651) return 9;    // ì´ˆì›”ì˜
                if (length >= 501) return 12;   // ë¶ˆë©¸ì˜
                if (length >= 401) return 15;   // ì‹ í™”ì˜
                if (length >= 301) return 20;   // ì „ì„¤ì˜
                if (length >= 251) return 25;   // ì°¬ë€í•œ
                if (length >= 201) return 30;   // ì˜ë¡±í•œ
                if (length >= 161) return 35;   // ë‹¹ë‹¹í•œ
                if (length >= 131) return 40;   // ìœ„ì—„ìˆëŠ”
                if (length >= 101) return 45;   // ìœ¤ê¸°ë‚˜ëŠ”
                if (length >= 81) return 50;    // íƒìŠ¤ëŸ¬ìš´
                if (length >= 61) return 55;    // ì”¨ì•Œì´ êµµì€
                if (length >= 41) return 60;    // íƒ±íƒ±í•œ
                if (length >= 21) return 65;    // ë§ë‘ë§ë‘
                return 70;                      // ì­ˆê¸€ì­ˆê¸€
            };
            
            // ë“±ê¸‰ë³„ ê°•í™” ë¹„ìš© ê³„ì‚°
            const getForgeCost = (length) => {
                if (length >= 2501) return 200;  // ì‹ ì˜ ì˜ì—­
                if (length >= 2001) return 150;  // ì°¨ì›ì„ ì´ˆì›”í•œ
                if (length >= 1601) return 120;  // ìš°ì£¼ë¥¼ í’ˆì€
                if (length >= 1301) return 100;  // ì ˆëŒ€ì
                if (length >= 1001) return 80;   // ì‹ ì„±í•œ
                if (length >= 801) return 70;    // ì²œìƒì˜
                if (length >= 651) return 60;    // ì´ˆì›”ì˜
                if (length >= 501) return 50;    // ë¶ˆë©¸ì˜
                if (length >= 401) return 40;    // ì‹ í™”ì˜
                if (length >= 301) return 35;    // ì „ì„¤ì˜
                if (length >= 251) return 30;    // ì°¬ë€í•œ
                if (length >= 201) return 25;    // ì˜ë¡±í•œ
                if (length >= 161) return 22;    // ë‹¹ë‹¹í•œ
                if (length >= 131) return 20;    // ìœ„ì—„ìˆëŠ”
                if (length >= 101) return 18;    // ìœ¤ê¸°ë‚˜ëŠ”
                if (length >= 81) return 15;     // íƒìŠ¤ëŸ¬ìš´
                if (length >= 61) return 13;     // ì”¨ì•Œì´ êµµì€
                if (length >= 41) return 11;     // íƒ±íƒ±í•œ
                if (length >= 21) return 10;     // ë§ë‘ë§ë‘
                return 10;                       // ì­ˆê¸€ì­ˆê¸€
            };
            
            // ë“±ê¸‰ë³„ ì„±ê³µ ë³´ë„ˆìŠ¤ ê³„ì‚°
            const getForgeBonus = (length) => {
                if (length >= 2501) return { min: 150, max: 300 };  // ì‹ ì˜ ì˜ì—­
                if (length >= 2001) return { min: 120, max: 250 };  // ì°¨ì›ì„ ì´ˆì›”í•œ
                if (length >= 1601) return { min: 100, max: 200 };  // ìš°ì£¼ë¥¼ í’ˆì€
                if (length >= 1301) return { min: 90, max: 180 };   // ì ˆëŒ€ì
                if (length >= 1001) return { min: 80, max: 150 };   // ì‹ ì„±í•œ
                if (length >= 801) return { min: 70, max: 130 };    // ì²œìƒì˜
                if (length >= 651) return { min: 60, max: 120 };    // ì´ˆì›”ì˜
                if (length >= 501) return { min: 50, max: 100 };    // ë¶ˆë©¸ì˜
                if (length >= 401) return { min: 45, max: 90 };     // ì‹ í™”ì˜
                if (length >= 301) return { min: 40, max: 80 };     // ì „ì„¤ì˜
                if (length >= 251) return { min: 35, max: 70 };     // ì°¬ë€í•œ
                if (length >= 201) return { min: 30, max: 60 };     // ì˜ë¡±í•œ
                if (length >= 161) return { min: 28, max: 55 };     // ë‹¹ë‹¹í•œ
                if (length >= 131) return { min: 25, max: 50 };     // ìœ„ì—„ìˆëŠ”
                if (length >= 101) return { min: 23, max: 45 };     // ìœ¤ê¸°ë‚˜ëŠ”
                if (length >= 81) return { min: 20, max: 40 };      // íƒìŠ¤ëŸ¬ìš´
                if (length >= 61) return { min: 18, max: 35 };      // ì”¨ì•Œì´ êµµì€
                if (length >= 41) return { min: 15, max: 30 };      // íƒ±íƒ±í•œ
                if (length >= 21) return { min: 12, max: 25 };      // ë§ë‘ë§ë‘
                return { min: 10, max: 20 };                        // ì­ˆê¸€ì­ˆê¸€
            };
            
            // ë“±ê¸‰ë³„ ì‹¤íŒ¨ ì†ì‹¤ ê³„ì‚°
            const getForgeLoss = (length) => {
                if (length >= 2501) return { small: 80, big: 150 };  // ì‹ ì˜ ì˜ì—­
                if (length >= 2001) return { small: 70, big: 130 };  // ì°¨ì›ì„ ì´ˆì›”í•œ
                if (length >= 1601) return { small: 60, big: 110 };  // ìš°ì£¼ë¥¼ í’ˆì€
                if (length >= 1301) return { small: 55, big: 100 };  // ì ˆëŒ€ì
                if (length >= 1001) return { small: 50, big: 90 };   // ì‹ ì„±í•œ
                if (length >= 801) return { small: 45, big: 80 };    // ì²œìƒì˜
                if (length >= 651) return { small: 40, big: 70 };    // ì´ˆì›”ì˜
                if (length >= 501) return { small: 35, big: 60 };    // ë¶ˆë©¸ì˜
                if (length >= 401) return { small: 30, big: 55 };    // ì‹ í™”ì˜
                if (length >= 301) return { small: 28, big: 50 };    // ì „ì„¤ì˜
                if (length >= 251) return { small: 25, big: 45 };    // ì°¬ë€í•œ
                if (length >= 201) return { small: 22, big: 40 };    // ì˜ë¡±í•œ
                if (length >= 161) return { small: 20, big: 38 };    // ë‹¹ë‹¹í•œ
                if (length >= 131) return { small: 18, big: 35 };    // ìœ„ì—„ìˆëŠ”
                if (length >= 101) return { small: 16, big: 32 };    // ìœ¤ê¸°ë‚˜ëŠ”
                if (length >= 81) return { small: 15, big: 30 };     // íƒìŠ¤ëŸ¬ìš´
                if (length >= 61) return { small: 13, big: 28 };     // ì”¨ì•Œì´ êµµì€
                if (length >= 41) return { small: 11, big: 25 };     // íƒ±íƒ±í•œ
                if (length >= 21) return { small: 10, big: 22 };     // ë§ë‘ë§ë‘
                return { small: 8, big: 20 };                        // ì­ˆê¸€ì­ˆê¸€
            };
            
            // ê°•í™” ì‹œë„
            const tryForge = () => {
                if (!farmUser) return;
                if (forging) return;
                
                const cost = getForgeCost(farmUser.length);
                
                if (farmUser.length < cost) {
                    alert(`ê°•í™” ë¹„ìš©ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! (í•„ìš”: ${cost}cm, í˜„ì¬: ${farmUser.length}cm)`);
                    return;
                }
                
                setForging(true);
                
                const currentGrade = getGrade(farmUser.length);
                const successRate = getSuccessRate(farmUser.length);
                const isSuccess = Math.random() * 100 < successRate;
                
                setTimeout(() => {
                    if (isSuccess) {
                        // ê°•í™” ì„±ê³µ - ë“±ê¸‰ë³„ ë³´ë„ˆìŠ¤
                        const bonusRange = getForgeBonus(farmUser.length);
                        const bonus = Math.floor(Math.random() * (bonusRange.max - bonusRange.min + 1)) + bonusRange.min;
                        const newLength = farmUser.length - cost + bonus;
                        const newGrade = getGrade(newLength);
                        
                        db.ref(`farmUsers/${farmUser.id}`).update({
                            length: newLength
                        });
                        
                        db.ref('chatMessages').push({
                            nickname: 'ğŸ”¨ ëŒ€ì¥ê°„ ì‹œìŠ¤í…œ',
                            message: `${farmUser.nickname}ë‹˜ì´ ê°•í™”ì— ì„±ê³µ! ${bonus}cm íšë“! (ë¹„ìš©: ${cost}cm) ${currentGrade.emoji}${currentGrade.name} â†’ ${newGrade.emoji}${newGrade.name} (í˜„ì¬: ${newLength}cm)`,
                            timestamp: Date.now()
                        });
                        
                        setForgeResult({
                            success: true,
                            oldLength: farmUser.length,
                            newLength: newLength,
                            oldGrade: currentGrade,
                            newGrade: newGrade,
                            change: bonus,
                            cost: cost
                        });
                    } else {
                        // ê°•í™” ì‹¤íŒ¨ - ë“±ê¸‰ë³„ ì†ì‹¤
                        const rand = Math.random() * 100;
                        const lossRange = getForgeLoss(farmUser.length);
                        let newLength;
                        let message;
                        
                        if (rand < 20) {
                            // 20% í™•ë¥ ë¡œ ì¦‰ì‹œ íŒŒê´´ (0cm)
                            newLength = 0;
                            message = `${farmUser.nickname}ë‹˜ì˜ ê°•í™” ì‹¤íŒ¨... ê³ ì¶”ê°€ ì™„ì „íˆ íŒŒê´´ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ’¥ (0cm)`;
                        } else if (rand < 50) {
                            // 30% í™•ë¥ ë¡œ í° ì†ì‹¤
                            const catastrophicRoll = Math.random() * 100;
                            
                            if (catastrophicRoll < 10) {
                                // í° ì†ì‹¤ ì¤‘ 10% (ì „ì²´ì˜ 3%) í™•ë¥ ë¡œ ëŒ€íŒŒê´´!
                                newLength = 0;
                                message = `${farmUser.nickname}ë‹˜ì˜ ê°•í™” ëŒ€ì‹¤íŒ¨... ì¹˜ëª…ì  ì†ìƒìœ¼ë¡œ ê³ ì¶”ê°€ ì™„ì „íˆ ì†Œë©¸í–ˆìŠµë‹ˆë‹¤! ğŸ’€ğŸ’¥ (0cm)`;
                            } else {
                                // í° ì†ì‹¤ ì¤‘ 90% í™•ë¥ ë¡œ ì¼ë°˜ í° ì†ì‹¤
                                const loss = lossRange.big;
                                newLength = Math.max(0, farmUser.length - cost - loss);
                                message = `${farmUser.nickname}ë‹˜ì˜ ê°•í™” ì‹¤íŒ¨... ${loss}cm í° ì†ì‹¤! (ë¹„ìš©: ${cost}cm) (í˜„ì¬: ${newLength}cm)`;
                            }
                        } else {
                            // 50% í™•ë¥ ë¡œ ì‘ì€ ì†ì‹¤
                            const loss = lossRange.small;
                            newLength = Math.max(0, farmUser.length - cost - loss);
                            message = `${farmUser.nickname}ë‹˜ì˜ ê°•í™” ì‹¤íŒ¨... ${loss}cm ì†ì‹¤! (ë¹„ìš©: ${cost}cm) (í˜„ì¬: ${newLength}cm)`;
                        }
                        
                        const newGrade = getGrade(newLength);
                        
                        db.ref(`farmUsers/${farmUser.id}`).update({
                            length: newLength
                        });
                        
                        db.ref('chatMessages').push({
                            nickname: 'ğŸ”¨ ëŒ€ì¥ê°„ ì‹œìŠ¤í…œ',
                            message: message,
                            timestamp: Date.now()
                        });
                        
                        setForgeResult({
                            success: false,
                            oldLength: farmUser.length,
                            newLength: newLength,
                            oldGrade: currentGrade,
                            newGrade: newGrade,
                            change: newLength - farmUser.length + cost,
                            cost: cost
                        });
                    }
                    
                    setForging(false);
                    setTimeout(() => setForgeResult(null), 5000);
                }, 2000);
            };

            // ì¶œì„ì²´í¬
            const checkIn = () => {
                if (!farmUser) return;
                const now = Date.now();
                if (farmUser.lastCheckIn && (now - farmUser.lastCheckIn) < 24 * 60 * 60 * 1000) {
                    alert('ì•„ì§ ì¶œì„ ë¶ˆê°€!');
                    return;
                }
                const growth = Math.floor(Math.random() * 100) + 1;
                const newLen = (farmUser.length || 10) + growth;
                db.ref(`farmUsers/${farmUser.id}`).update({
                    length: newLen,
                    lastCheckIn: now
                });
                db.ref('chatMessages').push({
                    nickname: 'ğŸŒ¶ï¸ ë†ì¥ ì‹œìŠ¤í…œ',
                    message: `${farmUser.nickname}ë‹˜ì´ ì¶œì„ì²´í¬ë¡œ ${growth}cm ì„±ì¥! (í˜„ì¬: ${newLen}cm)`,
                    timestamp: Date.now()
                });
                alert(`ğŸŒ¶ï¸ ${growth}cm ì„±ì¥! (í˜„ì¬: ${newLen}cm)`);
            };

            // PVP ì‹ ì²­ (ì˜¤í”ˆ ë°°í‹€)
            const sendPvp = () => {
                if (!pvpAmount) return;
                if (!farmUser) return;
                
                const amt = parseInt(pvpAmount);
                if (amt <= 0 || isNaN(amt)) {
                    alert('ì˜¬ë°”ë¥¸ ìˆ«ì!');
                    return;
                }
                
                if (farmUser.length < amt) {
                    alert(`ê¸¸ì´ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤! (í•„ìš”: ${amt}cm, í˜„ì¬: ${farmUser.length}cm)`);
                    return;
                }
                
                db.ref('pvpRequests').push({
                    fromId: farmUser.id,
                    fromName: farmUser.nickname,
                    amount: amt,
                    status: 'pending',
                    timestamp: Date.now()
                });
                
                // ì±„íŒ…ì— ì˜¤í”ˆ ë°°í‹€ ë°œí‘œ
                db.ref('chatMessages').push({
                    nickname: 'âš”ï¸ PVP ì‹œìŠ¤í…œ',
                    message: `${farmUser.nickname}ë‹˜ì´ ${amt}cm ì˜¤í”ˆ ë°°í‹€ì„ ì‹ ì²­í–ˆìŠµë‹ˆë‹¤! (ëˆ„êµ¬ë‚˜ ìˆ˜ë½ ê°€ëŠ¥)`,
                    timestamp: Date.now()
                });
                
                setPvpAmount('');
                alert('ì˜¤í”ˆ ë°°í‹€ ì‹ ì²­ ì™„ë£Œ! ëˆ„êµ°ê°€ ìˆ˜ë½í•  ë•Œê¹Œì§€ ëŒ€ê¸°í•©ë‹ˆë‹¤.');
            };

            // PVP ìˆ˜ë½ (ì˜¤í”ˆ ë°°í‹€)
            const acceptPvp = (req) => {
                if (!farmUser) return;
                
                // ìê¸° ìì‹ ì˜ ë°°í‹€ì€ ìˆ˜ë½ ë¶ˆê°€
                if (req.fromId === farmUser.id) {
                    alert('ìì‹ ì˜ ë°°í‹€ì€ ìˆ˜ë½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                    return;
                }
                
                // ìµœì‹  ìœ ì € ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const challenger = allUsers.find(u => u.id === req.fromId);
                const accepter = farmUser;
                
                if (!challenger) {
                    alert('ë„ì „ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                    db.ref(`pvpRequests/${req.id}`).update({ status: 'cancelled' });
                    return;
                }
                
                // ì–‘ìª½ ê¸¸ì´ ì²´í¬
                if (challenger.length < req.amount) {
                    alert(`ë„ì „ì(${challenger.nickname})ì˜ ê¸¸ì´ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤! ë°°í‹€ì´ ìë™ ì·¨ì†Œë©ë‹ˆë‹¤.`);
                    db.ref(`pvpRequests/${req.id}`).update({ status: 'cancelled' });
                    db.ref('chatMessages').push({
                        nickname: 'âš”ï¸ PVP ì‹œìŠ¤í…œ',
                        message: `${challenger.nickname}ë‹˜ì˜ ë°°í‹€ì´ ìë™ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤. (ê¸¸ì´ ë¶€ì¡±)`,
                        timestamp: Date.now()
                    });
                    return;
                }
                
                if (accepter.length < req.amount) {
                    alert('ë‹¹ì‹ ì˜ ê¸¸ì´ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤! ë°°í‹€ì´ ìë™ ì·¨ì†Œë©ë‹ˆë‹¤.');
                    db.ref(`pvpRequests/${req.id}`).update({ status: 'cancelled' });
                    db.ref('chatMessages').push({
                        nickname: 'âš”ï¸ PVP ì‹œìŠ¤í…œ',
                        message: `${accepter.nickname}ë‹˜ì˜ ê¸¸ì´ ë¶€ì¡±ìœ¼ë¡œ ë°°í‹€ì´ ìë™ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.`,
                        timestamp: Date.now()
                    });
                    return;
                }
                
                // ì±„íŒ…ì— ìˆ˜ë½ ë°œí‘œ
                db.ref('chatMessages').push({
                    nickname: 'âš”ï¸ PVP ì‹œìŠ¤í…œ',
                    message: `${accepter.nickname}ë‹˜ì´ ${challenger.nickname}ë‹˜ì˜ ${req.amount}cm ë°°í‹€ì„ ìˆ˜ë½í–ˆìŠµë‹ˆë‹¤! ë°°í‹€ ì‹œì‘!`,
                    timestamp: Date.now()
                });
                
                // ìŠ¹ë¶€ (50%)
                const win = Math.random() > 0.5;
                const winnerId = win ? accepter.id : challenger.id;
                const loserId = win ? challenger.id : accepter.id;
                const winner = win ? accepter : challenger;
                const loser = win ? challenger : accepter;
                
                const updates = {};
                updates[`farmUsers/${winnerId}/length`] = winner.length + req.amount;
                updates[`farmUsers/${loserId}/length`] = Math.max(0, loser.length - req.amount);
                updates[`pvpRequests/${req.id}/status`] = 'completed';
                updates[`pvpRequests/${req.id}/accepterId`] = accepter.id;
                updates[`pvpRequests/${req.id}/accepterName`] = accepter.nickname;
                db.ref().update(updates);
                
                // ë°°í‹€ ê²°ê³¼ ë°œí‘œ
                db.ref('chatMessages').push({
                    nickname: 'âš”ï¸ PVP ì‹œìŠ¤í…œ',
                    message: `${winner.nickname}ë‹˜ì´ ${loser.nickname}ë‹˜ì„ ì´ê¹€! ${req.amount}cm íšë“! (ìŠ¹ì: ${winner.length + req.amount}cm, íŒ¨ì: ${Math.max(0, loser.length - req.amount)}cm)`,
                    timestamp: Date.now()
                });
                
                setPvpResult({
                    winner: winner.nickname,
                    loser: loser.nickname,
                    amount: req.amount,
                    isWin: winnerId === farmUser.id
                });
                setTimeout(() => setPvpResult(null), 5000);
            };

            // PVP ì·¨ì†Œ (ì‹ ì²­ì ë³¸ì¸ë§Œ)
            const cancelPvp = (reqId) => {
                const req = pvpReqs.find(r => r.id === reqId);
                if (req) {
                    if (req.fromId !== farmUser.id) {
                        alert('ë³¸ì¸ì´ ì‹ ì²­í•œ ë°°í‹€ë§Œ ì·¨ì†Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!');
                        return;
                    }
                    
                    db.ref(`pvpRequests/${reqId}`).update({ status: 'cancelled' });
                    
                    // ì±„íŒ…ì— ì·¨ì†Œ ë°œí‘œ
                    db.ref('chatMessages').push({
                        nickname: 'âš”ï¸ PVP ì‹œìŠ¤í…œ',
                        message: `${req.fromName}ë‹˜ì´ ${req.amount}cm ë°°í‹€ì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.`,
                        timestamp: Date.now()
                    });
                }
            };

            return (
                <div className="container">
                    <div className="header">
                        <h1>ğŸŒ¶ï¸ ì»¤ë®¤ë‹ˆí‹° ì‚¬ì´íŠ¸</h1>
                    </div>
                    
                    <div className="tabs">
                        <button className={`tab ${tab==='board'?'active':''}`} onClick={()=>setTab('board')}>ğŸ“ ê²Œì‹œíŒ</button>
                        <button className={`tab ${tab==='chat'?'active':''}`} onClick={()=>setTab('chat')}>ğŸ’¬ ì±„íŒ…</button>
                        <button className={`tab ${tab==='detector'?'active':''}`} onClick={()=>setTab('detector')}>ğŸ” ê±°ì§“ë§íƒì§€ê¸°</button>
                        <button className={`tab ${tab==='poll'?'active':''}`} onClick={()=>setTab('poll')}>ğŸ—³ï¸ íˆ¬í‘œ</button>
                        <button className={`tab ${tab==='farm'?'active':''}`} onClick={()=>setTab('farm')}>ğŸŒ¶ï¸ ê³ ì¶”ë†ì¥</button>
                        <button className={`tab ${tab==='forge'?'active':''}`} onClick={()=>setTab('forge')}>ğŸ”¨ ê³ ì¶”ëŒ€ì¥ê°„</button>
                    </div>
                    
                    {/* ê²Œì‹œíŒ */}
                    {tab === 'board' && (
                        <div>
                            <div className="card">
                                <h3 style={{marginBottom: '15px'}}>ê²Œì‹œê¸€ ì‘ì„±</h3>
                                <input type="text" placeholder="ì‘ì„±ì ì´ë¦„" value={postAuthor} onChange={e=>setPostAuthor(e.target.value)} />
                                <input type="text" placeholder="ì œëª©" value={postTitle} onChange={e=>setPostTitle(e.target.value)} />
                                <textarea placeholder="ë‚´ìš©" value={postContent} onChange={e=>setPostContent(e.target.value)} />
                                <button className="btn" onClick={writePost}>ğŸ“ ì‘ì„±í•˜ê¸°</button>
                            </div>
                            
                            {posts.map(post => (
                                <div key={post.id} className="post">
                                    <div className="post-header">
                                        <span>{post.author || 'ìµëª…'}</span>
                                        <span>{new Date(post.timestamp).toLocaleString('ko-KR')}</span>
                                    </div>
                                    <h3 style={{marginBottom: '10px', fontSize: '1.3rem'}}>{post.title}</h3>
                                    <p style={{whiteSpace: 'pre-wrap', lineHeight: '1.6'}}>{post.content}</p>
                                    
                                    <div className="post-footer">
                                        {['ğŸ‘', 'â¤ï¸', 'ğŸ˜‚', 'ğŸ˜®', 'ğŸ˜¢', 'ğŸ˜¡'].map(emoji => {
                                            const count = post.reactions ? Object.values(post.reactions).filter(r => r === emoji).length : 0;
                                            const myReaction = post.reactions && post.reactions[myAnonymousId] === emoji;
                                            return (
                                                <button 
                                                    key={emoji}
                                                    className="reaction"
                                                    onClick={() => addReaction(post.id, emoji)}
                                                    style={{
                                                        background: myReaction ? '#e3f2fd' : '#f8f9fa',
                                                        border: myReaction ? '2px solid #2196f3' : '1px solid #e8e8e8'
                                                    }}
                                                >
                                                    {emoji} {count > 0 && count}
                                                </button>
                                            );
                                        })}
                                    </div>
                                    
                                    {post.comments && Object.keys(post.comments).length > 0 && (
                                        <div className="comments">
                                            <h4 style={{marginBottom: '10px', fontSize: '1rem'}}>
                                                ğŸ’¬ ëŒ“ê¸€ {Object.keys(post.comments).length}ê°œ
                                            </h4>
                                            {Object.entries(post.comments).sort((a,b) => a[1].timestamp - b[1].timestamp).map(([cid, comment]) => (
                                                <div key={cid} className="comment">
                                                    <div className="comment-header">
                                                        ìµëª…{getCommentAuthorNumber(post, comment.authorId)} Â· {new Date(comment.timestamp).toLocaleString('ko-KR')}
                                                    </div>
                                                    <div>{comment.content}</div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                    
                                    <div className="comment-input">
                                        <input 
                                            type="text"
                                            placeholder="ëŒ“ê¸€ ì‘ì„±..."
                                            value={commentInputs[post.id] || ''}
                                            onChange={e => setCommentInputs({...commentInputs, [post.id]: e.target.value})}
                                            onKeyPress={e => e.key === 'Enter' && writeComment(post.id)}
                                            style={{marginBottom: 0}}
                                        />
                                        <button className="btn btn-small" onClick={() => writeComment(post.id)}>ì‘ì„±</button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                    
                    {/* ì±„íŒ… */}
                    {tab === 'chat' && (
                        <div>
                            <div className="card" style={{background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', color: 'white'}}>
                                <h3>ğŸ’¬ ì‹¤ì‹œê°„ ì±„íŒ…</h3>
                                <p style={{fontSize: '1.1rem', marginTop: '10px'}}>ë‹¹ì‹ ì˜ ë‹‰ë„¤ì„: <strong>{chatNick} ğŸ²</strong></p>
                            </div>
                            <div className="chat-container" ref={chatRef}>
                                {messages.map(msg => (
                                    <div key={msg.id} className="chat-message">
                                        <div className="chat-header">{msg.nickname} Â· {new Date(msg.timestamp).toLocaleTimeString('ko-KR')}</div>
                                        <div>{msg.message}</div>
                                    </div>
                                ))}
                            </div>
                            <div style={{display: 'flex', gap: '10px'}}>
                                <input type="text" placeholder="ë©”ì‹œì§€ ì…ë ¥" value={chatMsg} onChange={e=>setChatMsg(e.target.value)} onKeyPress={e=>e.key==='Enter'&&sendChat()} style={{marginBottom: 0}} />
                                <button className="btn" onClick={sendChat} style={{width: 'auto', padding: '12px 30px'}}>ì „ì†¡</button>
                            </div>
                        </div>
                    )}
                    
                    {/* ê±°ì§“ë§íƒì§€ê¸° */}
                    {tab === 'detector' && (
                        <div>
                            <div className="card">
                                <h3 style={{marginBottom: '15px'}}>ğŸ” AI ê±°ì§“ë§ íƒì§€ê¸°</h3>
                                <p style={{color: '#666', marginBottom: '15px'}}>ì§ˆë¬¸ì„ ì…ë ¥í•˜ë©´ AIê°€ ì§„ì‹¤/ê±°ì§“ì„ íŒë‹¨í•©ë‹ˆë‹¤</p>
                                <input 
                                    type="text"
                                    placeholder="íŒë‹¨í•  ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”..."
                                    value={detectorQuestion}
                                    onChange={e=>setDetectorQuestion(e.target.value)}
                                    onKeyPress={e=>e.key==='Enter'&&!detectorLoading&&detectLie()}
                                />
                                <button className="btn" onClick={detectLie} disabled={detectorLoading || !detectorQuestion.trim()}>
                                    {detectorLoading ? 'â³ ë¶„ì„ ì¤‘...' : 'ğŸ” ì§„ì‹¤ ì—¬ë¶€ íŒë‹¨'}
                                </button>
                            </div>
                            
                            {detectorResult && (
                                <div className={`detector-result ${detectorResult.isTrue ? 'true' : 'false'}`}>
                                    <h2 style={{fontSize: '3rem', marginBottom: '20px'}}>
                                        {detectorResult.isTrue ? 'âœ… ì§„ì‹¤' : 'âŒ ê±°ì§“'}
                                    </h2>
                                    <p style={{fontSize: '1.3rem', fontWeight: 'bold', marginBottom: '10px'}}>
                                        {detectorQuestion}
                                    </p>
                                    <p style={{fontSize: '1.1rem', opacity: 0.9}}>
                                        ì´ìœ : {detectorResult.reason}
                                    </p>
                                </div>
                            )}
                        </div>
                    )}
                    
                    {/* íˆ¬í‘œ */}
                    {tab === 'poll' && (
                        <div>
                            <div className="card">
                                <h3 style={{marginBottom: '15px'}}>íˆ¬í‘œ ë§Œë“¤ê¸°</h3>
                                <input type="text" placeholder="ì§ˆë¬¸" value={pollQuestion} onChange={e=>setPollQuestion(e.target.value)} />
                                {pollOptions.map((opt, idx) => (
                                    <input 
                                        key={idx}
                                        type="text" 
                                        placeholder={`ì„ íƒì§€ ${idx+1}`}
                                        value={opt}
                                        onChange={e => {
                                            const newOpts = [...pollOptions];
                                            newOpts[idx] = e.target.value;
                                            setPollOptions(newOpts);
                                        }}
                                    />
                                ))}
                                <button className="btn" onClick={()=>setPollOptions([...pollOptions, ''])} style={{marginBottom: '10px'}}>+ ì„ íƒì§€ ì¶”ê°€</button>
                                <button className="btn" onClick={createPoll}>ğŸ“ íˆ¬í‘œ ìƒì„±</button>
                            </div>
                            
                            {polls.map(poll => {
                                const totalVotes = poll.votes ? Object.keys(poll.votes).length : 0;
                                const voteCounts = {};
                                if (poll.votes) {
                                    Object.values(poll.votes).forEach(v => {
                                        voteCounts[v] = (voteCounts[v] || 0) + 1;
                                    });
                                }
                                const myVote = myVotes[poll.id];
                                
                                return (
                                    <div key={poll.id} className="card">
                                        <h3 style={{marginBottom: '15px'}}>{poll.question}</h3>
                                        <p style={{color: '#666', fontSize: '0.9rem', marginBottom: '15px'}}>
                                            ì´ {totalVotes}í‘œ Â· {new Date(poll.timestamp).toLocaleString('ko-KR')}
                                        </p>
                                        {poll.options.map((opt, idx) => {
                                            const count = voteCounts[idx] || 0;
                                            const percent = totalVotes > 0 ? Math.round((count / totalVotes) * 100) : 0;
                                            const isMyVote = myVote === idx;
                                            
                                            return (
                                                <div 
                                                    key={idx}
                                                    style={{
                                                        padding: '15px',
                                                        background: isMyVote ? '#e3f2fd' : '#f8f9fa',
                                                        borderRadius: '8px',
                                                        marginBottom: '10px',
                                                        cursor: 'pointer',
                                                        border: isMyVote ? '2px solid #2196f3' : 'none',
                                                        position: 'relative',
                                                        overflow: 'hidden'
                                                    }}
                                                    onClick={() => vote(poll.id, idx)}
                                                >
                                                    <div style={{
                                                        position: 'absolute',
                                                        left: 0,
                                                        top: 0,
                                                        bottom: 0,
                                                        width: `${percent}%`,
                                                        background: 'rgba(33, 150, 243, 0.1)',
                                                        transition: 'width 0.3s'
                                                    }} />
                                                    <div style={{position: 'relative', display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                                                        <span style={{fontWeight: isMyVote ? 'bold' : 'normal'}}>
                                                            {isMyVote && 'âœ… '}{opt}
                                                        </span>
                                                        <span style={{fontWeight: 'bold', color: '#2196f3'}}>
                                                            {count}í‘œ ({percent}%)
                                                        </span>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                );
                            })}
                        </div>
                    )}
                    
                    {/* ê³ ì¶”ë†ì¥ */}
                    {tab === 'farm' && (
                        <div>
                            {/* ê²Œì„ ë£° ì„¤ëª… - ì ‘ê¸°/í¼ì¹˜ê¸° */}
                            <div className="card" style={{background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', color: 'white', cursor: 'pointer'}} onClick={()=>setShowRules(!showRules)}>
                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                                    <h2 style={{fontSize: '1.5rem'}}>ğŸŒ¶ï¸ ê³ ì¶”ë†ì¥ ê²Œì„ ê°€ì´ë“œ</h2>
                                    <span style={{fontSize: '1.5rem', fontWeight: 'bold'}}>
                                        {showRules ? 'â–²' : 'â–¼'}
                                    </span>
                                </div>
                                <p style={{fontSize: '0.9rem', opacity: 0.9, marginTop: '5px'}}>
                                    {showRules ? 'í´ë¦­í•˜ì—¬ ì ‘ê¸°' : 'í´ë¦­í•˜ì—¬ ê²Œì„ ë°©ë²• ë³´ê¸°'}
                                </p>
                                
                                {showRules && (
                                    <div style={{marginTop: '20px'}} onClick={e=>e.stopPropagation()}>
                                        <div style={{background: 'rgba(255,255,255,0.1)', padding: '20px', borderRadius: '12px', marginBottom: '15px'}}>
                                            <h3 style={{marginBottom: '10px', fontSize: '1.3rem'}}>ğŸ® ê²Œì„ ëª©í‘œ</h3>
                                            <p style={{lineHeight: '1.6', fontSize: '1.05rem'}}>
                                                ê³ ì¶”ë¥¼ í‚¤ì›Œì„œ <strong>1ë“±</strong>ì„ ì°¨ì§€í•˜ì„¸ìš”!<br/>
                                                ì¶œì„ì²´í¬ì™€ PVP ë°°í‹€ë¡œ ì„±ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                            </p>
                                        </div>
                                        
                                        <div style={{background: 'rgba(255,255,255,0.1)', padding: '20px', borderRadius: '12px', marginBottom: '15px'}}>
                                            <h3 style={{marginBottom: '10px', fontSize: '1.3rem'}}>ğŸŒ± ì‹œì‘</h3>
                                            <p style={{lineHeight: '1.6', fontSize: '1.05rem'}}>
                                                â€¢ íšŒì›ê°€ì… ì‹œ <strong>10cm</strong>ë¡œ ì‹œì‘<br/>
                                                â€¢ ë‹‰ë„¤ì„ì€ ì¤‘ë³µ ë¶ˆê°€<br/>
                                                â€¢ ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒ
                                            </p>
                                        </div>
                                        
                                        <div style={{background: 'rgba(255,255,255,0.1)', padding: '20px', borderRadius: '12px', marginBottom: '15px'}}>
                                            <h3 style={{marginBottom: '10px', fontSize: '1.3rem'}}>â­ ì¶œì„ì²´í¬</h3>
                                            <p style={{lineHeight: '1.6', fontSize: '1.05rem'}}>
                                                â€¢ <strong>24ì‹œê°„ë§ˆë‹¤</strong> 1íšŒ ê°€ëŠ¥<br/>
                                                â€¢ <strong>1~100cm</strong> ëœë¤ ì„±ì¥! ğŸ²<br/>
                                                â€¢ ìš´ì´ ì¢‹ìœ¼ë©´ 100cm ëŒ€ë°•!<br/>
                                                â€¢ íƒ€ì´ë¨¸ë¡œ ë‚¨ì€ ì‹œê°„ í™•ì¸ ê°€ëŠ¥<br/>
                                                â€¢ ì±„íŒ…ì— ìë™ìœ¼ë¡œ ë°œí‘œë¨
                                            </p>
                                        </div>
                                        
                                        <div style={{background: 'rgba(255,255,255,0.1)', padding: '20px', borderRadius: '12px', marginBottom: '15px'}}>
                                            <h3 style={{marginBottom: '10px', fontSize: '1.3rem'}}>âš”ï¸ ì˜¤í”ˆ ë°°í‹€ ì‹œìŠ¤í…œ</h3>
                                            <p style={{lineHeight: '1.6', fontSize: '1.05rem'}}>
                                                â€¢ ë°°í‹€ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì—¬ <strong>ì˜¤í”ˆ ë°°í‹€ ì‹ ì²­</strong><br/>
                                                â€¢ <strong>ëˆ„êµ¬ë‚˜</strong> ë°°í‹€ì„ ìˆ˜ë½í•  ìˆ˜ ìˆìŒ (ì„ ì°©ìˆœ!)<br/>
                                                â€¢ ìˆ˜ë½í•˜ë ¤ë©´ ë°°í‹€ ê¸ˆì•¡ ì´ìƒì˜ ê¸¸ì´ í•„ìš”<br/>
                                                â€¢ ìŠ¹ë¥ ì€ <strong>50%</strong> (ì™„ì „ ëœë¤!)<br/>
                                                â€¢ ì´ê¸°ë©´ ë°°í‹€ ê¸ˆì•¡ì„ íšë“<br/>
                                                â€¢ ì§€ë©´ ë°°í‹€ ê¸ˆì•¡ì„ ìƒìŒ<br/>
                                                â€¢ ê¸¸ì´ê°€ ë¶€ì¡±í•˜ë©´ ìë™ ì·¨ì†Œë¨<br/>
                                                â€¢ ë°°í‹€ ê²°ê³¼ëŠ” ì±„íŒ…ì— ìë™ ë°œí‘œ<br/>
                                                â€¢ ë‚´ê°€ ì‹ ì²­í•œ ë°°í‹€ì€ ì§ì ‘ ì·¨ì†Œ ê°€ëŠ¥
                                            </p>
                                        </div>
                                        
                                        <div style={{background: 'rgba(255,255,255,0.1)', padding: '20px', borderRadius: '12px', marginBottom: '15px'}}>
                                            <h3 style={{marginBottom: '10px', fontSize: '1.3rem'}}>ğŸ† ë­í‚¹ ì‹œìŠ¤í…œ</h3>
                                            <p style={{lineHeight: '1.6', fontSize: '1.05rem'}}>
                                                â€¢ ì‹¤ì‹œê°„ ìˆœìœ„ í‘œì‹œ<br/>
                                                â€¢ 1ìœ„ ğŸ¥‡ / 2ìœ„ ğŸ¥ˆ / 3ìœ„ ğŸ¥‰<br/>
                                                â€¢ ë‚´ ìˆœìœ„ëŠ” íŒŒë€ìƒ‰ìœ¼ë¡œ í‘œì‹œ<br/>
                                                â€¢ ê¸¸ì´ ìˆœìœ¼ë¡œ ìë™ ì •ë ¬
                                            </p>
                                        </div>
                                        
                                        <div style={{background: 'rgba(255,255,255,0.1)', padding: '20px', borderRadius: '12px'}}>
                                            <h3 style={{marginBottom: '10px', fontSize: '1.3rem'}}>ğŸ’¡ íŒ</h3>
                                            <p style={{lineHeight: '1.6', fontSize: '1.05rem'}}>
                                                â€¢ ë§¤ì¼ ì¶œì„ì²´í¬í•˜ë©´ ê¾¸ì¤€íˆ ì„±ì¥!<br/>
                                                â€¢ ì˜¤í”ˆ ë°°í‹€ì€ ì‹ ì¤‘í•˜ê²Œ! ì˜ëª»í•˜ë©´ ê¸¸ì´ ê°ì†Œ<br/>
                                                â€¢ ì±„íŒ… íƒ­ì—ì„œ ë‹¤ë¥¸ ìœ ì € ë°°í‹€ í™•ì¸ ê°€ëŠ¥<br/>
                                                â€¢ ê¸¸ì´ê°€ ì¶©ë¶„í•˜ë©´ í° ê¸ˆì•¡ ë°°í‹€ ì‹ ì²­!<br/>
                                                â€¢ ì„ ì°©ìˆœì´ë‹ˆ ë¹ ë¥´ê²Œ ìˆ˜ë½í•˜ì„¸ìš”!
                                            </p>
                                        </div>
                                    </div>
                                )}
                            </div>
                            
                            {!farmUser ? (
                                <div className="card" style={{maxWidth: '500px', margin: '0 auto'}}>
                                    <h2 style={{textAlign: 'center', marginBottom: '20px'}}>ğŸŒ¶ï¸ ê³ ì¶”ë†ì¥ {isLogin ? 'ë¡œê·¸ì¸' : 'íšŒì›ê°€ì…'}</h2>
                                    <input type="text" placeholder="ë‹‰ë„¤ì„" value={farmNick} onChange={e=>setFarmNick(e.target.value)} />
                                    <input type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ (4ì ì´ìƒ)" value={farmPass} onChange={e=>setFarmPass(e.target.value)} onKeyPress={e=>e.key==='Enter'&&(isLogin?login():register())} />
                                    <button className="btn" onClick={isLogin ? login : register} disabled={!farmNick.trim() || !farmPass.trim()}>
                                        {isLogin ? 'ğŸšª ë¡œê·¸ì¸' : 'ğŸŒ± íšŒì›ê°€ì…'}
                                    </button>
                                    <div style={{textAlign: 'center', marginTop: '15px'}}>
                                        <button onClick={()=>setIsLogin(!isLogin)} style={{background: 'none', border: 'none', color: '#4a90e2', cursor: 'pointer', textDecoration: 'underline'}}>
                                            {isLogin ? 'íšŒì›ê°€ì…í•˜ê¸°' : 'ë¡œê·¸ì¸í•˜ê¸°'}
                                        </button>
                                    </div>
                                </div>
                            ) : (
                                <div>
                                    {pvpResult && (
                                        <div className={`pvp-result ${pvpResult.isWin ? 'win' : 'lose'}`}>
                                            <h2 style={{fontSize: '2.5rem', marginBottom: '15px'}}>
                                                {pvpResult.isWin ? 'ğŸ‰ ìŠ¹ë¦¬!' : 'ğŸ˜¢ íŒ¨ë°°...'}
                                            </h2>
                                            <p style={{fontSize: '1.3rem', fontWeight: 'bold'}}>
                                                {pvpResult.winner} vs {pvpResult.loser}
                                            </p>
                                            <p style={{fontSize: '1.1rem', marginTop: '10px'}}>
                                                {pvpResult.amount}cm ì´ë™!
                                            </p>
                                        </div>
                                    )}
                                    
                                    <div className="card" style={{background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', color: 'white'}}>
                                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px'}}>
                                            <h2>{farmUser.nickname}ë‹˜ì˜ ë†ì¥</h2>
                                            <button onClick={logout} style={{background: 'rgba(255,255,255,0.2)', border: '1px solid white', color: 'white', padding: '8px 20px', borderRadius: '20px', cursor: 'pointer'}}>ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
                                        </div>
                                        <div style={{fontSize: '4rem', textAlign: 'center', margin: '20px 0'}}>ğŸŒ¶ï¸</div>
                                        <div style={{fontSize: '3rem', fontWeight: 'bold', textAlign: 'center', marginBottom: '20px'}}>{farmUser.length}cm</div>
                                        <div style={{background: 'rgba(255,255,255,0.2)', padding: '20px', borderRadius: '12px', textAlign: 'center', marginBottom: '20px'}}>
                                            <div style={{fontSize: '1.5rem', fontWeight: 'bold'}}>â° {timer}</div>
                                        </div>
                                        <button className="btn" onClick={checkIn} disabled={timer !== 'ì¶œì„ ê°€ëŠ¥!'} style={{background: timer === 'ì¶œì„ ê°€ëŠ¥!' ? 'white' : 'rgba(255,255,255,0.3)', color: timer === 'ì¶œì„ ê°€ëŠ¥!' ? '#667eea' : 'rgba(255,255,255,0.7)'}}>
                                            â­ ì¶œì„ì²´í¬ (1~100cm)
                                        </button>
                                    </div>
                                    
                                    {pvpReqs.length > 0 && (
                                        <div className="card">
                                            <h3 style={{marginBottom: '15px'}}>âš”ï¸ ì˜¤í”ˆ ë°°í‹€ ëª©ë¡</h3>
                                            <p style={{color: '#666', fontSize: '0.9rem', marginBottom: '15px'}}>
                                                ëˆ„êµ¬ë‚˜ ìˆ˜ë½í•  ìˆ˜ ìˆëŠ” ë°°í‹€ ëª©ë¡ì…ë‹ˆë‹¤!
                                            </p>
                                            {pvpReqs.map(req => {
                                                const isMyBattle = req.fromId === farmUser.id;
                                                const canAccept = !isMyBattle && farmUser.length >= req.amount;
                                                
                                                return (
                                                    <div key={req.id} style={{
                                                        padding: '15px',
                                                        background: isMyBattle ? '#fff3cd' : '#f8f9fa',
                                                        borderRadius: '8px',
                                                        marginBottom: '10px',
                                                        border: isMyBattle ? '2px solid #ffc107' : 'none'
                                                    }}>
                                                        <div style={{marginBottom: '10px'}}>
                                                            <div style={{fontWeight: 'bold', fontSize: '1.1rem', marginBottom: '5px'}}>
                                                                {isMyBattle ? 'ğŸ”¶ ë‚´ ë°°í‹€' : 'âš”ï¸'} {req.fromName}ë‹˜ì˜ ë°°í‹€
                                                            </div>
                                                            <div style={{color: '#666', fontSize: '0.95rem'}}>
                                                                ë°°íŒ… ê¸ˆì•¡: <strong style={{color: '#f44336', fontSize: '1.1rem'}}>{req.amount}cm</strong>
                                                            </div>
                                                            <div style={{color: '#999', fontSize: '0.85rem', marginTop: '5px'}}>
                                                                {new Date(req.timestamp).toLocaleString('ko-KR')}
                                                            </div>
                                                        </div>
                                                        
                                                        {isMyBattle ? (
                                                            <button
                                                                className="btn"
                                                                onClick={()=>cancelPvp(req.id)}
                                                                style={{
                                                                    background: 'linear-gradient(135deg, #f44336 0%, #ef5350 100%)'
                                                                }}
                                                            >
                                                                âŒ ì·¨ì†Œ
                                                            </button>
                                                        ) : (
                                                            <button
                                                                className="btn"
                                                                onClick={()=>acceptPvp(req)}
                                                                disabled={!canAccept}
                                                                style={{
                                                                    background: canAccept 
                                                                        ? 'linear-gradient(135deg, #4caf50 0%, #66bb6a 100%)' 
                                                                        : '#ccc',
                                                                    cursor: canAccept ? 'pointer' : 'not-allowed'
                                                                }}
                                                            >
                                                                {canAccept ? 'âœ… ìˆ˜ë½' : `ğŸ”’ ìˆ˜ë½ ë¶ˆê°€ (${req.amount}cm í•„ìš”)`}
                                                            </button>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    )}
                                    
                                    <div className="card">
                                        <h3 style={{marginBottom: '15px'}}>âš”ï¸ ì˜¤í”ˆ ë°°í‹€ ì‹ ì²­</h3>
                                        <p style={{color: '#666', fontSize: '0.9rem', marginBottom: '15px'}}>
                                            ë°°í‹€ ê¸ˆì•¡ì„ ì…ë ¥í•˜ë©´ ëˆ„êµ¬ë‚˜ ìˆ˜ë½í•  ìˆ˜ ìˆëŠ” ì˜¤í”ˆ ë°°í‹€ì´ ìƒì„±ë©ë‹ˆë‹¤!<br/>
                                            <strong style={{color: '#4a90e2'}}>í˜„ì¬ ì‚¬ìš© ê°€ëŠ¥: {farmUser.length}cm</strong>
                                        </p>
                                        <input 
                                            type="number" 
                                            placeholder={`ê±¸ cm (ìµœëŒ€ ${farmUser.length}cm)`}
                                            value={pvpAmount} 
                                            onChange={e=>setPvpAmount(e.target.value)} 
                                            min="1"
                                            max={farmUser.length}
                                        />
                                        <button 
                                            className="btn" 
                                            onClick={sendPvp} 
                                            disabled={!pvpAmount}
                                        >
                                            âš”ï¸ ì˜¤í”ˆ ë°°í‹€ ì‹ ì²­
                                        </button>
                                    </div>
                                    
                                    <div className="card">
                                        <h3 style={{marginBottom: '15px'}}>ğŸ† ë­í‚¹</h3>
                                        {allUsers.map((user, idx) => {
                                            const userGrade = getGrade(user.length);
                                            return (
                                                <div key={user.id} style={{padding: '15px', background: user.id === farmUser.id ? '#e3f2fd' : '#f8f9fa', borderRadius: '8px', marginBottom: '10px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', border: user.id === farmUser.id ? '2px solid #2196f3' : 'none'}}>
                                                    <div style={{display: 'flex', alignItems: 'center', gap: '10px'}}>
                                                        <span style={{fontSize: '1.5rem', fontWeight: 'bold', color: idx === 0 ? '#ffd700' : idx === 1 ? '#c0c0c0' : idx === 2 ? '#cd7f32' : '#999'}}>{idx + 1}</span>
                                                        <div>
                                                            <div style={{display: 'flex', alignItems: 'center', gap: '5px'}}>
                                                                <span style={{fontWeight: 'bold', fontSize: '1.05rem'}}>{user.nickname}</span>
                                                                {user.id === farmUser.id && <span style={{background: '#2196f3', color: 'white', padding: '2px 8px', borderRadius: '10px', fontSize: '0.75rem'}}>ë‚˜</span>}
                                                            </div>
                                                            <div style={{fontSize: '0.85rem', color: userGrade.color, fontWeight: '600', marginTop: '2px'}}>
                                                                {userGrade.emoji} {userGrade.name}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div style={{fontSize: '1.3rem', fontWeight: 'bold', color: '#4caf50'}}>ğŸŒ¶ï¸ {user.length}cm</div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            )}
                        </div>
                    )}
                    
                    {/* ê³ ì¶”ëŒ€ì¥ê°„ */}
                    {tab === 'forge' && (
                        <div>
                            {!farmUser ? (
                                <div className="card" style={{textAlign: 'center', padding: '60px 20px'}}>
                                    <h2 style={{fontSize: '3rem', marginBottom: '20px'}}>ğŸ”¨</h2>
                                    <h3 style={{marginBottom: '15px', fontSize: '1.5rem'}}>ê³ ì¶”ë†ì¥ì— ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”!</h3>
                                    <p style={{color: '#666', marginBottom: '20px'}}>
                                        ê°•í™” ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ ë†ì¥ ê³„ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.
                                    </p>
                                    <button className="btn" onClick={()=>setTab('farm')}>
                                        ğŸŒ¶ï¸ ê³ ì¶”ë†ì¥ìœ¼ë¡œ ê°€ê¸°
                                    </button>
                                </div>
                            ) : (
                                <div>
                                    {forgeResult && (
                                        <div className={`pvp-result ${forgeResult.success ? 'win' : 'lose'}`}>
                                            <h2 style={{fontSize: '2.5rem', marginBottom: '15px'}}>
                                                {forgeResult.success ? 'âœ¨ ê°•í™” ì„±ê³µ!' : 'ğŸ’¥ ê°•í™” ì‹¤íŒ¨...'}
                                            </h2>
                                            <p style={{fontSize: '1.3rem', fontWeight: 'bold', marginBottom: '10px'}}>
                                                {forgeResult.oldGrade.emoji} {forgeResult.oldGrade.name} ({forgeResult.oldLength}cm)
                                            </p>
                                            <p style={{fontSize: '2rem', marginBottom: '10px'}}>â†“</p>
                                            <p style={{fontSize: '1.3rem', fontWeight: 'bold'}}>
                                                {forgeResult.newGrade.emoji} {forgeResult.newGrade.name} ({forgeResult.newLength}cm)
                                            </p>
                                            <p style={{fontSize: '1.1rem', marginTop: '15px', opacity: 0.9}}>
                                                {forgeResult.success ? `+${forgeResult.change}cm` : `${forgeResult.change}cm`}
                                            </p>
                                        </div>
                                    )}
                                    
                                    <div className="card" style={{background: 'linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%)', color: 'white'}}>
                                        <h2 style={{marginBottom: '20px', fontSize: '1.8rem'}}>ğŸ”¨ ê³ ì¶”ëŒ€ì¥ê°„</h2>
                                        
                                        <div style={{background: 'rgba(255,255,255,0.2)', padding: '20px', borderRadius: '12px', marginBottom: '20px'}}>
                                            <div style={{fontSize: '4rem', textAlign: 'center', marginBottom: '15px'}}>
                                                {getGrade(farmUser.length).emoji}
                                            </div>
                                            <div style={{textAlign: 'center', marginBottom: '10px'}}>
                                                <div style={{fontSize: '1.8rem', fontWeight: 'bold', marginBottom: '5px'}}>
                                                    {getGrade(farmUser.length).name}
                                                </div>
                                                <div style={{fontSize: '2.5rem', fontWeight: 'bold'}}>
                                                    {farmUser.length}cm
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div style={{background: 'rgba(255,255,255,0.2)', padding: '20px', borderRadius: '12px', marginBottom: '20px'}}>
                                            <h3 style={{marginBottom: '15px', fontSize: '1.3rem'}}>âš’ï¸ ê°•í™” ì •ë³´</h3>
                                            <p style={{lineHeight: '1.8', fontSize: '1.05rem'}}>
                                                â€¢ ê°•í™” ë¹„ìš©: <strong style={{fontSize: '1.3rem', color: '#ffeb3b'}}>{getForgeCost(farmUser.length)}cm</strong><br/>
                                                â€¢ ì„±ê³µ ì‹œ: <strong style={{fontSize: '1.2rem', color: '#4caf50'}}>+{getForgeBonus(farmUser.length).min}~{getForgeBonus(farmUser.length).max}cm íšë“</strong><br/>
                                                â€¢ ì‹¤íŒ¨ ì‹œ: <strong style={{fontSize: '1.1rem', color: '#f44336'}}>-{getForgeLoss(farmUser.length).small}~{getForgeLoss(farmUser.length).big}cm ì†ì‹¤ ë˜ëŠ” íŒŒê´´</strong><br/>
                                                â€¢ <strong style={{fontSize: '1.1rem', color: '#d32f2f'}}>âš ï¸ íŒŒê´´ í™•ë¥ : ì•½ 23% (ì¦‰ì‹œ 20% + ëŒ€íŒŒê´´ 3%)</strong><br/>
                                                â€¢ í˜„ì¬ ì„±ê³µ í™•ë¥ : <strong style={{fontSize: '1.3rem', color: '#ffeb3b'}}>{getSuccessRate(farmUser.length)}%</strong>
                                            </p>
                                        </div>
                                        
                                        <button 
                                            className="btn" 
                                            onClick={tryForge}
                                            disabled={forging || farmUser.length < getForgeCost(farmUser.length)}
                                            style={{
                                                background: forging ? 'rgba(255,255,255,0.3)' : 'white',
                                                color: forging ? 'rgba(255,255,255,0.7)' : '#ff6b6b',
                                                fontSize: '1.2rem',
                                                padding: '18px'
                                            }}
                                        >
                                            {forging ? 'â³ ê°•í™” ì¤‘...' : `ğŸ”¨ ê°•í™” ì‹œë„ (-${getForgeCost(farmUser.length)}cm)`}
                                        </button>
                                        
                                        {farmUser.length < getForgeCost(farmUser.length) && (
                                            <p style={{textAlign: 'center', marginTop: '15px', fontSize: '0.9rem', opacity: 0.9}}>
                                                âš ï¸ ê°•í™” ë¹„ìš©ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! (í•„ìš”: {getForgeCost(farmUser.length)}cm, í˜„ì¬: {farmUser.length}cm)
                                            </p>
                                        )}
                                    </div>
                                    
                                    <div className="card">
                                        <h3 style={{marginBottom: '15px'}}>ğŸ“Š ë“±ê¸‰ ì‹œìŠ¤í…œ (ì´ 20ë‹¨ê³„)</h3>
                                        {[
                                            { min: 0, max: 20, ...getGrade(10), rate: 70, cost: 10 },
                                            { min: 21, max: 40, ...getGrade(30), rate: 65, cost: 10 },
                                            { min: 41, max: 60, ...getGrade(50), rate: 60, cost: 11 },
                                            { min: 61, max: 80, ...getGrade(70), rate: 55, cost: 13 },
                                            { min: 81, max: 100, ...getGrade(90), rate: 50, cost: 15 },
                                            { min: 101, max: 130, ...getGrade(115), rate: 45, cost: 18 },
                                            { min: 131, max: 160, ...getGrade(145), rate: 40, cost: 20 },
                                            { min: 161, max: 200, ...getGrade(180), rate: 35, cost: 22 },
                                            { min: 201, max: 250, ...getGrade(225), rate: 30, cost: 25 },
                                            { min: 251, max: 300, ...getGrade(275), rate: 25, cost: 30 },
                                            { min: 301, max: 400, ...getGrade(350), rate: 20, cost: 35 },
                                            { min: 401, max: 500, ...getGrade(450), rate: 15, cost: 40 },
                                            { min: 501, max: 650, ...getGrade(575), rate: 12, cost: 50 },
                                            { min: 651, max: 800, ...getGrade(725), rate: 9, cost: 60 },
                                            { min: 801, max: 1000, ...getGrade(900), rate: 7, cost: 70 },
                                            { min: 1001, max: 1300, ...getGrade(1150), rate: 5, cost: 80 },
                                            { min: 1301, max: 1600, ...getGrade(1450), rate: 4, cost: 100 },
                                            { min: 1601, max: 2000, ...getGrade(1800), rate: 3, cost: 120 },
                                            { min: 2001, max: 2500, ...getGrade(2250), rate: 2, cost: 150 },
                                            { min: 2501, max: 'âˆ', ...getGrade(3000), rate: 1, cost: 200 }
                                        ].map((grade, idx) => {
                                            const isCurrent = farmUser.length >= grade.min && (grade.max === 'âˆ' || farmUser.length <= grade.max);
                                            return (
                                                <div 
                                                    key={idx}
                                                    style={{
                                                        padding: '12px',
                                                        background: isCurrent ? '#e3f2fd' : '#f8f9fa',
                                                        borderRadius: '8px',
                                                        marginBottom: '8px',
                                                        border: isCurrent ? '2px solid #2196f3' : 'none'
                                                    }}
                                                >
                                                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '10px'}}>
                                                        <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                                            <span style={{fontSize: '1.5rem'}}>{grade.emoji}</span>
                                                            <div>
                                                                <div style={{fontWeight: 'bold', fontSize: '1rem', color: grade.color}}>
                                                                    {grade.name}
                                                                </div>
                                                                <div style={{fontSize: '0.85rem', color: '#666'}}>
                                                                    {grade.min}~{grade.max}cm
                                                                </div>
                                                            </div>
                                                            {isCurrent && (
                                                                <span style={{background: '#2196f3', color: 'white', padding: '2px 8px', borderRadius: '10px', fontSize: '0.75rem', fontWeight: 'bold'}}>
                                                                    í˜„ì¬
                                                                </span>
                                                            )}
                                                        </div>
                                                        <div style={{textAlign: 'right'}}>
                                                            <div style={{fontSize: '1rem', fontWeight: 'bold', color: grade.rate >= 50 ? '#4caf50' : grade.rate >= 30 ? '#ff9800' : '#f44336'}}>
                                                                ì„±ê³µë¥ : {grade.rate}%
                                                            </div>
                                                            <div style={{fontSize: '0.85rem', color: '#666', marginTop: '2px'}}>
                                                                ë¹„ìš©: {grade.cost}cm
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                    
                                    <div className="card" style={{background: '#fff3cd', border: '2px solid #ffc107'}}>
                                        <h3 style={{marginBottom: '15px', color: '#856404'}}>âš ï¸ ì£¼ì˜ì‚¬í•­ - ë§¤ìš° ìœ„í—˜!</h3>
                                        <p style={{lineHeight: '1.8', color: '#856404', fontWeight: 'bold'}}>
                                            â€¢ ê°•í™”ëŠ” <strong style={{color: '#d32f2f'}}>ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!</strong><br/>
                                            â€¢ <strong style={{color: '#d32f2f'}}>ë“±ê¸‰ì´ ë†’ì•„ì§ˆìˆ˜ë¡ ë¹„ìš©, ë³´ìƒ, ì†ì‹¤ì´ ëª¨ë‘ ê¸‰ì¦!</strong><br/>
                                            â€¢ ë¹„ìš©: ì´ˆë°˜ 10cm â†’ ì¤‘ë°˜ 30cm â†’ í›„ë°˜ 80cm â†’ ìµœì¢… 200cm<br/>
                                            â€¢ ì„±ê³µ ë³´ìƒ: ì´ˆë°˜ 10~20cm â†’ ì¤‘ë°˜ 30~60cm â†’ í›„ë°˜ 80~150cm â†’ ìµœì¢… 150~300cm!<br/>
                                            â€¢ ì‹¤íŒ¨ ì†ì‹¤: ì´ˆë°˜ 8~20cm â†’ ì¤‘ë°˜ 22~40cm â†’ í›„ë°˜ 50~90cm â†’ ìµœì¢… 80~150cm!<br/>
                                            â€¢ <strong style={{color: '#d32f2f', fontSize: '1.1rem'}}>âš ï¸ íŒŒê´´ ì‹œìŠ¤í…œ âš ï¸</strong><br/>
                                            â€¢ ì‹¤íŒ¨ ì‹œ <strong style={{color: '#d32f2f'}}>20% í™•ë¥ ë¡œ ì¦‰ì‹œ íŒŒê´´ (0cm)</strong><br/>
                                            â€¢ í° ì†ì‹¤ ì¤‘ <strong style={{color: '#d32f2f'}}>10% í™•ë¥ ë¡œ ëŒ€íŒŒê´´ (0cm)</strong><br/>
                                            â€¢ <strong style={{color: '#d32f2f', fontSize: '1.05rem'}}>â†’ ì´ íŒŒê´´ í™•ë¥ : ì•½ 23%!</strong><br/>
                                            â€¢ ë“±ê¸‰ì´ ë†’ì„ìˆ˜ë¡ ì„±ê³µ í™•ë¥ ì´ <strong style={{color: '#d32f2f'}}>ê¸‰ê²©íˆ ë‚®ì•„ì§‘ë‹ˆë‹¤</strong><br/>
                                            â€¢ <strong style={{color: '#d32f2f', fontSize: '1.1rem'}}>ìµœê³  ë“±ê¸‰: ì„±ê³µë¥  1%, ë¹„ìš© 200cm, ë³´ìƒ 150~300cm!</strong><br/>
                                            â€¢ 200cm ì´ìƒë¶€í„°ëŠ” ì‹¤íŒ¨ í™•ë¥ ì´ <strong>70% ì´ìƒ!</strong><br/>
                                            â€¢ 500cm ì´ìƒ: ì„±ê³µë¥  <strong>15% ì´í•˜, ë¹„ìš© 50cm, ë³´ìƒ 50~100cm!</strong><br/>
                                            â€¢ 1000cm ì´ìƒ: ì„±ê³µë¥  <strong>10% ë¯¸ë§Œ, ë¹„ìš© 80cm, ë³´ìƒ 80~150cmì˜ ê·¹ì•… ë‚œì´ë„!</strong><br/>
                                            â€¢ <strong style={{fontSize: '1.1rem'}}>High Risk, High Return! ë„ë°•ì€ ì‹ ì¤‘í•˜ê²Œ!</strong>
                                        </p>
                                    </div>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
