<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìµëª… ê²Œì‹œíŒ</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #f5f7fa; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .header { text-align: center; padding: 20px; background: white; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .tab { flex: 1; padding: 12px; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; background: #f5f7fa; color: #7f8c8d; transition: all 0.3s; }
        .tab.active { background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%); color: white; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        input, textarea, select { width: 100%; padding: 12px; border: 2px solid #e8e8e8; border-radius: 8px; font-size: 1rem; margin-bottom: 10px; font-family: inherit; }
        textarea { min-height: 100px; resize: vertical; }
        .btn { width: 100%; padding: 14px; background: #4a90e2; color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .btn:hover { background: #357abd; transform: translateY(-2px); }
        .btn:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        .btn-small { width: auto; padding: 8px 15px; font-size: 0.9rem; }
        .post { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .post-header { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.9rem; color: #666; }
        .post-footer { display: flex; gap: 10px; margin-top: 15px; padding-top: 15px; border-top: 1px solid #f0f0f0; }
        .reaction { padding: 8px 12px; background: #f8f9fa; border: 1px solid #e8e8e8; border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; }
        .reaction:hover { background: #e8ecef; transform: scale(1.05); }
        .comments { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 15px; }
        .comment { background: white; padding: 12px; border-radius: 8px; margin-bottom: 10px; }
        .comment-header { font-size: 0.85rem; color: #666; margin-bottom: 5px; }
        .comment-input { display: flex; gap: 10px; margin-top: 10px; }
        .iframe-container { width: 100%; height: 80vh; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .iframe-container iframe { width: 100%; height: 100%; border: none; }
        .dcinside-info { background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #ffc107; }
        
        /* ì›€ì§ì´ëŠ” ê°ì‚¬ ë©”ì‹œì§€ */
        .floating-message {
            position: fixed;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            writing-mode: vertical-rl;
            font-size: 1.2rem;
            font-weight: bold;
            background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%, #ff6b9d 200%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: float 3s ease-in-out infinite, gradient 5s ease infinite;
            z-index: 1000;
            pointer-events: none;
            text-shadow: 0 0 10px rgba(255,107,157,0.3);
            background-size: 200% 200%;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(-50%) translateX(0); }
            50% { transform: translateY(-50%) translateX(10px); }
        }
        
        @keyframes gradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        @media (max-width: 768px) {
            .floating-message { display: none; }
        }
        
        /* ê±°ì§“ë§ íƒì§€ê¸° ìŠ¤íƒ€ì¼ */
        .detector-container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .detector-loading {
            text-align: center;
            padding: 60px 20px;
        }
        
        .heartbeat {
            font-size: 4rem;
            animation: heartbeat 1s ease-in-out infinite;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }
        
        .detector-result {
            text-align: center;
            padding: 40px;
            border-radius: 20px;
            margin-top: 30px;
            animation: resultAppear 0.5s ease-out;
        }
        
        .detector-result.truth {
            background: linear-gradient(135deg, #4caf50 0%, #81c784 100%);
            border: 5px solid #2e7d32;
        }
        
        .detector-result.lie {
            background: linear-gradient(135deg, #f44336 0%, #e57373 100%);
            border: 5px solid #c62828;
        }
        
        .detector-result.error {
            background: linear-gradient(135deg, #9e9e9e 0%, #bdbdbd 100%);
            border: 5px solid #616161;
        }
        
        .verdict {
            font-size: 4rem;
            font-weight: bold;
            color: white;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            animation: verdictShake 0.5s ease-out;
        }
        
        .reason {
            font-size: 1.3rem;
            color: white;
            font-weight: 600;
            line-height: 1.6;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        @keyframes resultAppear {
            0% {
                opacity: 0;
                transform: scale(0.5) rotate(-10deg);
            }
            60% {
                transform: scale(1.1) rotate(2deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotate(0);
            }
        }
        
        @keyframes verdictShake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }
        
        .screen-shake {
            animation: screenShake 0.5s ease-out;
        }
        
        @keyframes screenShake {
            0%, 100% { transform: translate(0, 0); }
            10%, 30%, 50%, 70%, 90% { transform: translate(-5px, -5px); }
            20%, 40%, 60%, 80% { transform: translate(5px, 5px); }
        }
        
        .screen-flash {
            animation: screenFlash 0.5s ease-out;
        }
        
        @keyframes screenFlash {
            0%, 100% { background: #f5f7fa; }
            50% { background: #ffffff; }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const firebaseConfig = {
            apiKey: "AIzaSyDh3FsyWVZqy8wGExv-IlAglJ0DERuW_T8",
            authDomain: "ccccc-74256.firebaseapp.com",
            databaseURL: "https://ccccc-74256-default-rtdb.firebaseio.com",
            projectId: "ccccc-74256"
        };
        
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        function App() {
            const [tab, setTab] = useState('board');
            const [posts, setPosts] = useState([]);
            const [nickname, setNickname] = useState('');
            const [content, setContent] = useState('');
            const [loading, setLoading] = useState(true);
            const [openComments, setOpenComments] = useState({});
            const [commentInputs, setCommentInputs] = useState({});
            const [commentNicknames, setCommentNicknames] = useState({});
            
            // ì±„íŒ… ê´€ë ¨ state
            const [chatMessages, setChatMessages] = useState([]);
            const [chatInput, setChatInput] = useState('');
            const [chatLoading, setChatLoading] = useState(true);
            const chatEndRef = React.useRef(null);
            
            // ê±°ì§“ë§ íƒì§€ê¸° state
            const [detectorQuestion, setDetectorQuestion] = useState('');
            const [detectorResult, setDetectorResult] = useState(null);
            const [detectorLoading, setDetectorLoading] = useState(false);
            const [showImpact, setShowImpact] = useState(false);
            const [detectorLogs, setDetectorLogs] = useState([]);
            const [logsLoading, setLogsLoading] = useState(true);
            
            // íˆ¬í‘œ ê´€ë ¨ state
            const [voteTitle, setVoteTitle] = useState('');
            const [votePolls, setVotePolls] = useState([]);
            const [votesLoading, setVotesLoading] = useState(true);
            
            // ê³ ì¶”ë†ì¥ ê´€ë ¨ state
            const [farmNickname, setFarmNickname] = useState('');
            const [farmPassword, setFarmPassword] = useState('');
            const [farmUser, setFarmUser] = useState(null);
            const [farmUsers, setFarmUsers] = useState([]);
            const [farmLoading, setFarmLoading] = useState(true);
            const [pvpTarget, setPvpTarget] = useState('');
            const [pvpAmount, setPvpAmount] = useState('');
            const [pvpRequests, setPvpRequests] = useState([]);
            const [showPvpResult, setShowPvpResult] = useState(null);
            const [isLoginMode, setIsLoginMode] = useState(true); // true: ë¡œê·¸ì¸, false: íšŒì›ê°€ì…
            const [remainingTime, setRemainingTime] = useState('');
            
            // ë¸Œë¼ìš°ì € Fingerprint ìƒì„±
            const getFingerprint = () => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                ctx.textBaseline = 'top';
                ctx.font = '14px Arial';
                ctx.fillText('fingerprint', 2, 2);
                const canvasData = canvas.toDataURL();
                
                const fingerprint = btoa(
                    navigator.userAgent +
                    screen.width + 'x' + screen.height +
                    screen.colorDepth +
                    navigator.language +
                    new Date().getTimezoneOffset() +
                    canvasData.substring(0, 100)
                );
                
                return fingerprint;
            };
            
            // ëœë¤ ë‹‰ë„¤ì„ ìë™ ë°°ì •
            const getRandomNickname = () => {
                let savedName = localStorage.getItem('chatRandomNickname');
                if (!savedName) {
                    const names = ['ì„ì›…', 'ëª…ì§„', 'ë¯¼ìˆ˜', 'ì¶©ì—°', 'ë¯¼ê¸°', 'ë¯¼í˜¸', 'ì‹ ìš°', 'ëŒ€ì›…'];
                    savedName = names[Math.floor(Math.random() * names.length)];
                    localStorage.setItem('chatRandomNickname', savedName);
                }
                return savedName;
            };
            
            useEffect(() => {
                const ref = db.ref('posts');
                ref.on('value', (snap) => {
                    const data = snap.val();
                    if (data) {
                        const arr = Object.keys(data).map(k => ({id: k, ...data[k]})).sort((a,b) => b.timestamp - a.timestamp);
                        setPosts(arr);
                    }
                    setLoading(false);
                });
                return () => ref.off();
            }, []);
            
            // ì±„íŒ… ë©”ì‹œì§€ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ
            useEffect(() => {
                const chatRef = db.ref('chatMessages').limitToLast(100);
                chatRef.on('value', (snap) => {
                    const data = snap.val();
                    if (data) {
                        const arr = Object.keys(data).map(k => ({id: k, ...data[k]})).sort((a,b) => a.timestamp - b.timestamp);
                        setChatMessages(arr);
                    } else {
                        setChatMessages([]);
                    }
                    setChatLoading(false);
                });
                return () => chatRef.off();
            }, []);
            
            // ì±„íŒ… ìë™ ìŠ¤í¬ë¡¤
            useEffect(() => {
                if (chatEndRef.current && tab === 'chat') {
                    chatEndRef.current.scrollIntoView({ behavior: 'smooth' });
                }
            }, [chatMessages, tab]);
            
            // ê±°ì§“ë§ íƒì§€ ë¡œê·¸ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ
            useEffect(() => {
                const logsRef = db.ref('detectorLogs').limitToLast(50);
                logsRef.on('value', (snap) => {
                    const data = snap.val();
                    if (data) {
                        const arr = Object.keys(data).map(k => ({id: k, ...data[k]})).sort((a,b) => b.timestamp - a.timestamp);
                        setDetectorLogs(arr);
                    } else {
                        setDetectorLogs([]);
                    }
                    setLogsLoading(false);
                });
                return () => logsRef.off();
            }, []);
            
            // íˆ¬í‘œ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ
            useEffect(() => {
                const votesRef = db.ref('votes');
                votesRef.on('value', (snap) => {
                    const data = snap.val();
                    if (data) {
                        const arr = Object.keys(data).map(k => ({id: k, ...data[k]})).sort((a,b) => b.timestamp - a.timestamp);
                        setVotePolls(arr);
                    } else {
                        setVotePolls([]);
                    }
                    setVotesLoading(false);
                });
                return () => votesRef.off();
            }, []);
            
            // ê³ ì¶”ë†ì¥ ì‚¬ìš©ì ë¦¬ìŠ¤ë„ˆ
            useEffect(() => {
                const usersRef = db.ref('farmUsers');
                usersRef.on('value', (snap) => {
                    const data = snap.val();
                    if (data) {
                        const arr = Object.keys(data).map(k => ({id: k, ...data[k]})).sort((a,b) => b.length - a.length);
                        setFarmUsers(arr);
                        
                        // ìë™ ë¡œê·¸ì¸ ì²´í¬
                        const savedToken = localStorage.getItem('farmToken');
                        if (savedToken) {
                            const myData = arr.find(u => u.id === savedToken);
                            if (myData) {
                                setFarmUser(myData);
                            }
                        }
                    } else {
                        setFarmUsers([]);
                    }
                    setFarmLoading(false);
                });
                return () => usersRef.off();
            }, []);
            
            // PVP ìš”ì²­ ë¦¬ìŠ¤ë„ˆ
            useEffect(() => {
                const requestsRef = db.ref('pvpRequests');
                requestsRef.on('value', (snap) => {
                    const data = snap.val();
                    if (data) {
                        const savedToken = localStorage.getItem('farmToken');
                        if (savedToken) {
                            const arr = Object.keys(data).map(k => ({id: k, ...data[k]}))
                                .filter(r => r.status === 'pending' && (r.toId === savedToken || r.fromId === savedToken));
                            setPvpRequests(arr);
                        }
                    } else {
                        setPvpRequests([]);
                    }
                });
                return () => requestsRef.off();
            }, []);
            
            // íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸
            useEffect(() => {
                const updateTimer = () => {
                    if (!farmUser || !farmUser.lastCheckIn) {
                        setRemainingTime('ì¶œì„ ê°€ëŠ¥!');
                        return;
                    }
                    
                    const now = Date.now();
                    const timePassed = now - farmUser.lastCheckIn;
                    const cooldown = 24 * 60 * 60 * 1000; // 24ì‹œê°„
                    
                    if (timePassed >= cooldown) {
                        setRemainingTime('ì¶œì„ ê°€ëŠ¥!');
                    } else {
                        const remaining = cooldown - timePassed;
                        const hours = Math.floor(remaining / (60 * 60 * 1000));
                        const minutes = Math.floor((remaining % (60 * 60 * 1000)) / (60 * 1000));
                        const seconds = Math.floor((remaining % (60 * 1000)) / 1000);
                        setRemainingTime(`${hours}ì‹œê°„ ${minutes}ë¶„ ${seconds}ì´ˆ`);
                    }
                };
                
                updateTimer();
                const interval = setInterval(updateTimer, 1000);
                
                return () => clearInterval(interval);
            }, [farmUser]);
            
            const submit = () => {
                if (!content.trim()) return;
                db.ref('posts').push({ 
                    nickname: nickname.trim() || 'ìµëª…',
                    content: content.trim(), 
                    timestamp: Date.now(), 
                    reactions: {hug:0,cheer:0}, 
                    comments: {} 
                });
                setNickname('');
                setContent('');
            };
            
            const react = (id, type) => {
                const post = posts.find(p => p.id === id);
                db.ref(`posts/${id}/reactions/${type}`).set((post.reactions?.[type] || 0) + 1);
            };
            
            const toggleComments = (id) => {
                setOpenComments({...openComments, [id]: !openComments[id]});
            };
            
            const addComment = (postId) => {
                const text = commentInputs[postId];
                if (!text?.trim()) return;
                
                // localStorageì—ì„œ ì´ ê²Œì‹œê¸€ì— ëŒ€í•œ ë‚´ ìµëª… ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸°
                const myAnonymousIds = JSON.parse(localStorage.getItem('myAnonymousIds') || '{}');
                let myNumber = myAnonymousIds[postId];
                
                // ì´ ê²Œì‹œê¸€ì— ì²˜ìŒ ëŒ“ê¸€ ë‹¤ëŠ” ê²½ìš°
                if (!myNumber) {
                    // í˜„ì¬ ì´ ê²Œì‹œê¸€ì˜ ìµœëŒ€ ìµëª… ë²ˆí˜¸ ì°¾ê¸°
                    let maxNumber = 0;
                    if (posts.find(p => p.id === postId)?.nickname === 'ìµëª…') {
                        maxNumber = 1; // ê²Œì‹œê¸€ ì‘ì„±ìê°€ ìµëª…1
                    }
                    
                    // ê¸°ì¡´ ëŒ“ê¸€ë“¤ì—ì„œ ìµœëŒ€ ë²ˆí˜¸ ì°¾ê¸°
                    const post = posts.find(p => p.id === postId);
                    if (post?.comments) {
                        Object.values(post.comments).forEach(c => {
                            if (c.nickname?.startsWith('ìµëª…')) {
                                const num = parseInt(c.nickname.replace('ìµëª…', ''));
                                if (!isNaN(num) && num > maxNumber) {
                                    maxNumber = num;
                                }
                            }
                        });
                    }
                    
                    myNumber = maxNumber + 1;
                    myAnonymousIds[postId] = myNumber;
                    localStorage.setItem('myAnonymousIds', JSON.stringify(myAnonymousIds));
                }
                
                const nickname = commentNicknames[postId]?.trim() || `ìµëª…${myNumber}`;
                
                db.ref(`posts/${postId}/comments`).push({ 
                    nickname: nickname,
                    content: text.trim(), 
                    timestamp: Date.now() 
                });
                setCommentInputs({...commentInputs, [postId]: ''});
                setCommentNicknames({...commentNicknames, [postId]: ''});
            };
            
            // ì±„íŒ… ë©”ì‹œì§€ ì „ì†¡
            const sendChatMessage = () => {
                if (!chatInput.trim()) return;
                
                const nickname = getRandomNickname();
                
                db.ref('chatMessages').push({
                    nickname: nickname,
                    message: chatInput.trim(),
                    timestamp: Date.now()
                });
                
                setChatInput('');
            };
            
            // ê±°ì§“ë§ íƒì§€ í•¨ìˆ˜
            const detectLie = async () => {
                if (!detectorQuestion.trim()) return;
                
                setDetectorLoading(true);
                setDetectorResult(null);
                setShowImpact(false);
                
                try {
                    // ë¡œë”© ì‹œê°„ ì—°ì¶œ (ê¸´ì¥ê°)
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // ëœë¤ íŒì • (50% í™•ë¥ )
                    const isTrue = Math.random() > 0.5;
                    const verdict = isTrue ? 'ì§„ì‹¤' : 'ê±°ì§“';
                    
                    // ëƒ‰ì •í•˜ê³  ì”í˜¹í•œ ì´ìœ  ìƒì„±
                    const truthReasons = [
                        'í†µê³„ì ìœ¼ë¡œ ê·¸ëŸ´ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.',
                        'ìƒì‹ì ìœ¼ë¡œ íƒ€ë‹¹í•œ ì§„ìˆ ì…ë‹ˆë‹¤.',
                        'ë…¼ë¦¬ì ìœ¼ë¡œ ëª¨ìˆœì´ ì—†ìŠµë‹ˆë‹¤.',
                        'ê³¼í•™ì  ê·¼ê±°ê°€ ì¶©ë¶„í•©ë‹ˆë‹¤.',
                        'ê²½í—˜ì ìœ¼ë¡œ ì…ì¦ ê°€ëŠ¥í•œ ì‚¬ì‹¤ì…ë‹ˆë‹¤.',
                        'ë°ì´í„° ë¶„ì„ ê²°ê³¼ ì‚¬ì‹¤ë¡œ íŒëª…ë˜ì—ˆìŠµë‹ˆë‹¤.',
                        'ê°ê´€ì  ì¦ê±°ê°€ ì´ë¥¼ ë’·ë°›ì¹¨í•©ë‹ˆë‹¤.',
                        'ì—­ì‚¬ì  ê¸°ë¡ì´ ì´ë¥¼ ì¦ëª…í•©ë‹ˆë‹¤.',
                        'ë‹¤ìˆ˜ì˜ ì „ë¬¸ê°€ê°€ ë™ì˜í•˜ëŠ” ë‚´ìš©ì…ë‹ˆë‹¤.',
                        'ì‹¤í—˜ ê²°ê³¼ê°€ ì´ë¥¼ í™•ì¸í•´ì¤ë‹ˆë‹¤.'
                    ];
                    
                    const lieReasons = [
                        'í†µê³„ì ìœ¼ë¡œ ê·¸ëŸ´ ê°€ëŠ¥ì„±ì´ ë‚®ìŠµë‹ˆë‹¤.',
                        'ìƒì‹ì— ì–´ê¸‹ë‚˜ëŠ” ì£¼ì¥ì…ë‹ˆë‹¤.',
                        'ë…¼ë¦¬ì  ëª¨ìˆœì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.',
                        'ê³¼í•™ì  ê·¼ê±°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.',
                        'ê²½í—˜ì ìœ¼ë¡œ ì…ì¦ë˜ì§€ ì•Šì€ ì£¼ì¥ì…ë‹ˆë‹¤.',
                        'ë°ì´í„° ë¶„ì„ ê²°ê³¼ ê±°ì§“ìœ¼ë¡œ íŒëª…ë˜ì—ˆìŠµë‹ˆë‹¤.',
                        'ê°ê´€ì  ì¦ê±°ê°€ ì´ë¥¼ ë°˜ë°•í•©ë‹ˆë‹¤.',
                        'ì—­ì‚¬ì  ì‚¬ì‹¤ê³¼ ë¶ˆì¼ì¹˜í•©ë‹ˆë‹¤.',
                        'ì „ë¬¸ê°€ë“¤ì´ ë¶€ì •í•˜ëŠ” ë‚´ìš©ì…ë‹ˆë‹¤.',
                        'ì‹¤í—˜ ê²°ê³¼ê°€ ì´ë¥¼ ë¶€ì •í•©ë‹ˆë‹¤.',
                        'ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ì§„ìˆ ë¡œ íŒë‹¨ë©ë‹ˆë‹¤.',
                        'ì‹ ë¹™ì„±ì´ ë–¨ì–´ì§€ëŠ” ì£¼ì¥ì…ë‹ˆë‹¤.',
                        'í™•ë¥ ì ìœ¼ë¡œ ê±°ì§“ì¼ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.',
                        'ë¹„í˜„ì‹¤ì ì¸ ì§„ìˆ ì…ë‹ˆë‹¤.',
                        'ê³¼ì¥ëœ í‘œí˜„ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.'
                    ];
                    
                    const reasons = isTrue ? truthReasons : lieReasons;
                    const reason = reasons[Math.floor(Math.random() * reasons.length)];
                    
                    setDetectorResult({ verdict, reason });
                    setShowImpact(true);
                    
                    // Firebaseì— ë¡œê·¸ ì €ì¥
                    db.ref('detectorLogs').push({
                        question: detectorQuestion.trim(),
                        verdict: verdict,
                        reason: reason,
                        timestamp: Date.now()
                    });
                    
                    // ì„íŒ©íŠ¸ íš¨ê³¼ í›„ ì œê±°
                    setTimeout(() => setShowImpact(false), 500);
                    
                } catch (error) {
                    console.error('ê±°ì§“ë§ íƒì§€ ì˜¤ë¥˜:', error);
                    setDetectorResult({ 
                        verdict: 'ì˜¤ë¥˜', 
                        reason: 'íƒì§€ ì‹œìŠ¤í…œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' 
                    });
                }
                
                setDetectorLoading(false);
            };
            
            // íˆ¬í‘œ ì•ˆê±´ ìƒì„±
            const createVote = () => {
                if (!voteTitle.trim()) return;
                
                db.ref('votes').push({
                    title: voteTitle.trim(),
                    agree: 0,
                    disagree: 0,
                    voters: {},
                    timestamp: Date.now()
                });
                
                setVoteTitle('');
            };
            
            // íˆ¬í‘œí•˜ê¸°
            const castVote = (pollId, choice) => {
                const fingerprint = getFingerprint();
                const poll = votePolls.find(p => p.id === pollId);
                
                // ì´ë¯¸ íˆ¬í‘œí–ˆëŠ”ì§€ í™•ì¸
                if (poll.voters && poll.voters[fingerprint]) {
                    alert('ì´ë¯¸ íˆ¬í‘œí•˜ì…¨ìŠµë‹ˆë‹¤! 1ì¸ 1í‘œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    return;
                }
                
                // íˆ¬í‘œ ìˆ˜ ì¦ê°€
                const updates = {};
                updates[`votes/${pollId}/${choice}`] = (poll[choice] || 0) + 1;
                updates[`votes/${pollId}/voters/${fingerprint}`] = {
                    choice: choice,
                    timestamp: Date.now()
                };
                
                db.ref().update(updates);
            };
            
            // ê³ ì¶”ë†ì¥ íšŒì›ê°€ì…
            const registerFarm = () => {
                if (!farmNickname.trim() || !farmPassword.trim()) {
                    alert('ë‹‰ë„¤ì„ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”!');
                    return;
                }
                
                if (farmPassword.length < 4) {
                    alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤!');
                    return;
                }
                
                const existingUser = farmUsers.find(u => u.nickname === farmNickname.trim());
                
                if (existingUser) {
                    alert('ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤!');
                    return;
                }
                
                // ê³ ìœ  ID ìƒì„± (ë‹‰ë„¤ì„ ê¸°ë°˜)
                const userId = btoa(farmNickname.trim() + Date.now());
                
                db.ref(`farmUsers/${userId}`).set({
                    nickname: farmNickname.trim(),
                    password: btoa(farmPassword), // ê°„ë‹¨í•œ ì¸ì½”ë”©
                    length: 10000, // ì‹œì‘ ê¸¸ì´ 10000cm
                    lastCheckIn: 0,
                    checkInGrowth: 0,
                    createdAt: Date.now()
                });
                
                // ì±„íŒ…ì— ê°€ì… ì•Œë¦¼
                db.ref('chatMessages').push({
                    nickname: 'ğŸ‰ ì‹œìŠ¤í…œ',
                    message: `${farmNickname.trim()}ë‹˜ì´ ê³ ì¶”ë†ì¥ì— ì…ì¥í–ˆìŠµë‹ˆë‹¤! (ì‹œì‘: 10000cm)`,
                    timestamp: Date.now()
                });
                
                // ë¡œê·¸ì¸ ìƒíƒœ ì €ì¥
                localStorage.setItem('farmToken', userId);
                
                setFarmNickname('');
                setFarmPassword('');
                alert('íšŒì›ê°€ì… ì™„ë£Œ! ğŸ‰\nê¸°ë³¸ 10000cmê°€ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤!');
            };
            
            // ê³ ì¶”ë†ì¥ ë¡œê·¸ì¸
            const loginFarm = () => {
                if (!farmNickname.trim() || !farmPassword.trim()) {
                    alert('ë‹‰ë„¤ì„ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”!');
                    return;
                }
                
                const user = farmUsers.find(u => u.nickname === farmNickname.trim());
                
                if (!user) {
                    alert('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê³„ì •ì…ë‹ˆë‹¤!');
                    return;
                }
                
                // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
                if (user.password !== btoa(farmPassword)) {
                    alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤!');
                    return;
                }
                
                // ë¡œê·¸ì¸ ì„±ê³µ
                localStorage.setItem('farmToken', user.id);
                setFarmUser(user);
                setFarmNickname('');
                setFarmPassword('');
                alert('ë¡œê·¸ì¸ ì„±ê³µ! ğŸŒ¶ï¸');
            };
            
            // ë¡œê·¸ì•„ì›ƒ
            const logoutFarm = () => {
                localStorage.removeItem('farmToken');
                setFarmUser(null);
                alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤!');
            };
            
            // ì¶œì„ì²´í¬
            const checkIn = () => {
                const now = Date.now();
                
                if (!farmUser) {
                    alert('ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”!');
                    return;
                }
                
                // 24ì‹œê°„ ì²´í¬
                if (farmUser.lastCheckIn && (now - farmUser.lastCheckIn) < 24 * 60 * 60 * 1000) {
                    const remainingTime = 24 * 60 * 60 * 1000 - (now - farmUser.lastCheckIn);
                    const hours = Math.floor(remainingTime / (60 * 60 * 1000));
                    const minutes = Math.floor((remainingTime % (60 * 60 * 1000)) / (60 * 1000));
                    alert(`ì•„ì§ ì¶œì„í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤! ${hours}ì‹œê°„ ${minutes}ë¶„ í›„ì— ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.`);
                    return;
                }
                
                // ëœë¤ ì„±ì¥ (1~100cm)
                const growth = Math.floor(Math.random() * 100) + 1;
                const newLength = (farmUser.length || 10) + growth;
                
                db.ref(`farmUsers/${farmUser.id}`).update({
                    length: newLength,
                    lastCheckIn: now
                });
                
                // ì±„íŒ…ì— ìë™ ë°œí‘œ
                db.ref('chatMessages').push({
                    nickname: 'ğŸŒ¶ï¸ ë†ì¥ ì‹œìŠ¤í…œ',
                    message: `${farmUser.nickname}ë‹˜ì´ ì¶œì„ì²´í¬ë¡œ ${growth}cm ì„±ì¥í–ˆìŠµë‹ˆë‹¤! (í˜„ì¬: ${newLength}cm)`,
                    timestamp: Date.now()
                });
                
                alert(`ğŸŒ¶ï¸ ê³ ì¶”ê°€ ${growth}cm ìëìŠµë‹ˆë‹¤! (í˜„ì¬: ${newLength}cm)`);
            };
            
            // PVP ì‹ ì²­
            const sendPvpRequest = () => {
                if (!pvpTarget.trim() || !pvpAmount) return;
                
                if (!farmUser) {
                    alert('ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”!');
                    return;
                }
                
                const targetUser = farmUsers.find(u => u.nickname === pvpTarget.trim());
                if (!targetUser) {
                    alert('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‚¬ìš©ìì…ë‹ˆë‹¤!');
                    return;
                }
                
                if (targetUser.id === farmUser.id) {
                    alert('ìê¸° ìì‹ ì—ê²ŒëŠ” ë„ì „í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                    return;
                }
                
                const amount = parseInt(pvpAmount);
                if (isNaN(amount) || amount <= 0) {
                    alert('ì˜¬ë°”ë¥¸ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
                    return;
                }
                
                if (farmUser.length < amount) {
                    alert('ë³´ìœ í•œ ê¸¸ì´ë³´ë‹¤ ë§ì€ ì–‘ì„ ê±¸ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                    return;
                }
                
                if (targetUser.length < amount) {
                    alert('ìƒëŒ€ë°©ì˜ ê¸¸ì´ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!');
                    return;
                }
                
                db.ref('pvpRequests').push({
                    fromId: farmUser.id,
                    fromName: farmUser.nickname,
                    toId: targetUser.id,
                    toName: targetUser.nickname,
                    amount: amount,
                    status: 'pending',
                    timestamp: Date.now()
                });
                
                setPvpTarget('');
                setPvpAmount('');
                alert('PVP ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
            };
            
            // PVP ìˆ˜ë½
            const acceptPvp = (requestId, request) => {
                if (!farmUser) return;
                
                // ëœë¤ ìŠ¹ë¶€ (50%)
                const iWin = Math.random() > 0.5;
                
                const winner = iWin ? farmUser.id : request.fromId;
                const loser = iWin ? request.fromId : farmUser.id;
                
                const winnerUser = farmUsers.find(u => u.id === winner);
                const loserUser = farmUsers.find(u => u.id === loser);
                
                if (!winnerUser || !loserUser) return;
                
                // ê¸¸ì´ ì´ì „
                const updates = {};
                updates[`farmUsers/${winner}/length`] = winnerUser.length + request.amount;
                updates[`farmUsers/${loser}/length`] = Math.max(0, loserUser.length - request.amount);
                updates[`pvpRequests/${requestId}/status`] = 'completed';
                updates[`pvpRequests/${requestId}/winner`] = winner;
                
                db.ref().update(updates);
                
                // ì±„íŒ…ì— ìë™ ë°œí‘œ
                db.ref('chatMessages').push({
                    nickname: 'âš”ï¸ PVP ì‹œìŠ¤í…œ',
                    message: `${winnerUser.nickname}ë‹˜ì´ ${loserUser.nickname}ë‹˜ì„ ì´ê²¼ìŠµë‹ˆë‹¤! ${request.amount}cm íšë“! (ìŠ¹ì: ${winnerUser.length + request.amount}cm, íŒ¨ì: ${Math.max(0, loserUser.length - request.amount)}cm)`,
                    timestamp: Date.now()
                });
                
                // ê²°ê³¼ í‘œì‹œ
                setShowPvpResult({
                    winner: winnerUser.nickname,
                    loser: loserUser.nickname,
                    amount: request.amount,
                    isMyWin: winner === farmUser.id
                });
                
                setTimeout(() => setShowPvpResult(null), 5000);
            };
            
            // PVP ê±°ì ˆ
            const rejectPvp = (requestId) => {
                db.ref(`pvpRequests/${requestId}`).update({ status: 'rejected' });
            };
            
            return (
                <div className="container">
                    <div className="header">
                        <h1>ğŸ“‹ ìµëª… ê²Œì‹œíŒ</h1>
                    </div>
                    
                    <div className="tabs">
                        <button className={`tab ${tab==='board'?'active':''}`} onClick={()=>setTab('board')}>ğŸ“ ê²Œì‹œíŒ</button>
                        <button className={`tab ${tab==='chat'?'active':''}`} onClick={()=>setTab('chat')}>ğŸ’¬ ì±„íŒ…</button>
                        <button className={`tab ${tab==='detector'?'active':''}`} onClick={()=>setTab('detector')}>ğŸ” ê±°ì§“ë§íƒì§€ê¸°</button>
                        <button className={`tab ${tab==='vote'?'active':''}`} onClick={()=>setTab('vote')}>ğŸ—³ï¸ íˆ¬í‘œ</button>
                        <button className={`tab ${tab==='farm'?'active':''}`} onClick={()=>setTab('farm')}>ğŸŒ¶ï¸ ê³ ì¶”ë†ì¥</button>
                    </div>
                    
                    {tab === 'board' ? (
                        <>
                            <div className="card">
                                <h3>âœï¸ ê¸€ ì‘ì„±</h3>
                                <input 
                                    type="text"
                                    value={nickname} 
                                    onChange={e=>setNickname(e.target.value)} 
                                    placeholder="ë‹‰ë„¤ì„ (ì„ íƒ, ë¹„ìš°ë©´ 'ìµëª…')" 
                                    maxLength={20}
                                    style={{marginBottom:'10px'}}
                                />
                                <textarea value={content} onChange={e=>setContent(e.target.value)} placeholder="ë‚´ìš© ì…ë ¥..." maxLength={500} />
                                <div style={{textAlign:'right',fontSize:'0.9rem',color:'#666',marginBottom:'10px'}}>{content.length}/500</div>
                                <button className="btn" onClick={submit} disabled={!content.trim()}>ê²Œì‹œí•˜ê¸°</button>
                            </div>
                            <h3 style={{marginBottom:'15px'}}>ğŸ“ ê²Œì‹œê¸€ ({posts.length})</h3>
                            {loading ? <div className="card">ë¡œë”©ì¤‘...</div> : posts.length === 0 ? <div className="card">ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div> : posts.map(p => {
                                const getAnonymousNumber = () => {
                                    if (p.nickname === 'ìµëª…') return 'ìµëª…1';
                                    return p.nickname || 'ìµëª…1';
                                };
                                
                                return (
                                <div key={p.id} className="post">
                                    <div className="post-header">
                                        <strong>{getAnonymousNumber()}</strong>
                                        <span>{new Date(p.timestamp).toLocaleString('ko-KR')}</span>
                                    </div>
                                    <div style={{lineHeight:'1.6'}}>{p.content}</div>
                                    <div className="post-footer">
                                        <span className="reaction" onClick={()=>react(p.id,'hug')}>ğŸ¤— {p.reactions?.hug || 0}</span>
                                        <span className="reaction" onClick={()=>react(p.id,'cheer')}>ğŸ’ª {p.reactions?.cheer || 0}</span>
                                        <span className="reaction" onClick={()=>toggleComments(p.id)}>ğŸ’¬ ëŒ“ê¸€ {p.comments ? Object.keys(p.comments).length : 0}</span>
                                    </div>
                                    {openComments[p.id] && (
                                        <div className="comments">
                                            {p.comments && (() => {
                                                const anonymousCounter = { count: p.nickname === 'ìµëª…' ? 2 : 1 };
                                                
                                                return Object.keys(p.comments).map(cid => {
                                                    const c = p.comments[cid];
                                                    const isAuthor = c.nickname === p.nickname && c.nickname !== 'ìµëª…';
                                                    
                                                    let displayName = c.nickname || 'ìµëª…';
                                                    let showAuthorBadge = false;
                                                    
                                                    if (displayName === 'ìµëª…') {
                                                        if (p.nickname === 'ìµëª…') {
                                                            displayName = `ìµëª…${anonymousCounter.count}`;
                                                            anonymousCounter.count++;
                                                        } else {
                                                            displayName = `ìµëª…${anonymousCounter.count}`;
                                                            anonymousCounter.count++;
                                                        }
                                                    } else {
                                                        showAuthorBadge = isAuthor;
                                                    }
                                                    
                                                    return (
                                                        <div key={cid} className="comment">
                                                            <div className="comment-header">
                                                                <strong>{displayName}</strong>
                                                                {showAuthorBadge && (
                                                                    <span style={{
                                                                        marginLeft: '6px',
                                                                        padding: '2px 8px',
                                                                        background: 'linear-gradient(135deg, #4a90e2 0%, #357abd 100%)',
                                                                        color: 'white',
                                                                        borderRadius: '4px',
                                                                        fontSize: '0.75rem',
                                                                        fontWeight: 'bold'
                                                                    }}>
                                                                        ê¸€ì“´ì´
                                                                    </span>
                                                                )}
                                                                {' Â· '}{new Date(c.timestamp).toLocaleString('ko-KR')}
                                                            </div>
                                                            <div>{c.content}</div>
                                                        </div>
                                                    );
                                                });
                                            })()}
                                            <div style={{marginTop:'10px'}}>
                                                <input 
                                                    value={commentNicknames[p.id] || (() => {
                                                        const myIds = JSON.parse(localStorage.getItem('myAnonymousIds') || '{}');
                                                        return myIds[p.id] ? `ìµëª…${myIds[p.id]}` : '';
                                                    })()}
                                                    readOnly
                                                    placeholder={(() => {
                                                        const myIds = JSON.parse(localStorage.getItem('myAnonymousIds') || '{}');
                                                        return myIds[p.id] ? `ìµëª…${myIds[p.id]} (ìë™ë°°ì •)` : 'ìµëª… ë²ˆí˜¸ ìë™ë°°ì •';
                                                    })()}
                                                    maxLength={20}
                                                    style={{
                                                        marginBottom:'8px',
                                                        background: '#f8f9fa',
                                                        cursor: 'not-allowed',
                                                        color: '#495057'
                                                    }}
                                                />
                                                <div className="comment-input">
                                                    <input 
                                                        value={commentInputs[p.id] || ''} 
                                                        onChange={e=>setCommentInputs({...commentInputs, [p.id]: e.target.value})}
                                                        onKeyPress={e=>e.key==='Enter'&&addComment(p.id)}
                                                        placeholder="ëŒ“ê¸€ ì…ë ¥..."
                                                        style={{flex:1}}
                                                    />
                                                    <button className="btn btn-small" onClick={()=>addComment(p.id)}>ì‘ì„±</button>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                                );
                            })}
                        </>
                    ) : tab === 'chat' ? (
                        <div>
                            <div className="card" style={{
                                marginBottom:'20px',
                                textAlign:'center',
                                background:'linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%)',
                                border:'2px solid #64b5f6'
                            }}>
                                <h3 style={{marginBottom:'10px'}}>ğŸ’¬ ì‹¤ì‹œê°„ ì±„íŒ…</h3>
                                <p style={{fontSize:'1.1rem',fontWeight:'bold',color:'#1976d2'}}>
                                    ë‹¹ì‹ ì˜ ë‹‰ë„¤ì„: {getRandomNickname()} ğŸ²
                                </p>
                                <p style={{fontSize:'0.85rem',color:'#666',marginTop:'5px'}}>
                                    (ìë™ ë°°ì •, ë³€ê²½ ë¶ˆê°€)
                                </p>
                            </div>
                            
                            <div className="card" style={{
                                height:'500px',
                                display:'flex',
                                flexDirection:'column',
                                padding:'0',
                                overflow:'hidden'
                            }}>
                                <div style={{
                                    flex:1,
                                    overflowY:'auto',
                                    padding:'20px',
                                    background:'#f8f9fa'
                                }}>
                                    {chatLoading ? (
                                        <div style={{textAlign:'center',padding:'20px'}}>ë¡œë”©ì¤‘...</div>
                                    ) : chatMessages.length === 0 ? (
                                        <div style={{textAlign:'center',padding:'20px',color:'#999'}}>
                                            ì²« ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë³´ì„¸ìš”! ğŸ‘‹
                                        </div>
                                    ) : (
                                        <>
                                            {chatMessages.map(msg => (
                                                <div key={msg.id} style={{
                                                    marginBottom:'15px',
                                                    display:'flex',
                                                    flexDirection:'column',
                                                    alignItems:'flex-start'
                                                }}>
                                                    <div style={{
                                                        fontSize:'0.85rem',
                                                        color:'#666',
                                                        marginBottom:'4px'
                                                    }}>
                                                        <strong>{msg.nickname || 'ìµëª…'}</strong>
                                                        {' Â· '}
                                                        {new Date(msg.timestamp).toLocaleTimeString('ko-KR', {hour:'2-digit', minute:'2-digit'})}
                                                    </div>
                                                    <div style={{
                                                        background:'white',
                                                        padding:'10px 15px',
                                                        borderRadius:'12px',
                                                        maxWidth:'80%',
                                                        wordBreak:'break-word',
                                                        boxShadow:'0 1px 3px rgba(0,0,0,0.1)'
                                                    }}>
                                                        {msg.message}
                                                    </div>
                                                </div>
                                            ))}
                                            <div ref={chatEndRef} />
                                        </>
                                    )}
                                </div>
                                
                                <div style={{
                                    padding:'15px',
                                    background:'white',
                                    borderTop:'2px solid #e8e8e8',
                                    display:'flex',
                                    gap:'10px'
                                }}>
                                    <input 
                                        value={chatInput} 
                                        onChange={e=>setChatInput(e.target.value)}
                                        onKeyPress={e=>e.key==='Enter'&&sendChatMessage()}
                                        placeholder="ë©”ì‹œì§€ ì…ë ¥..."
                                        style={{
                                            flex:1,
                                            marginBottom:0,
                                            border:'2px solid #e8e8e8'
                                        }}
                                    />
                                    <button className="btn btn-small" onClick={sendChatMessage}>
                                        ì „ì†¡
                                    </button>
                                </div>
                            </div>
                        </div>
                    ) : tab === 'detector' ? (
                        <div className={`detector-container ${showImpact ? 'screen-shake' : ''}`}>
                            <div className="card" style={{
                                background: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)',
                                border: '3px solid #0f3460',
                                padding: '30px'
                            }}>
                                <h2 style={{
                                    textAlign: 'center',
                                    color: '#e94560',
                                    fontSize: '2rem',
                                    marginBottom: '10px',
                                    textShadow: '0 0 10px rgba(233, 69, 96, 0.5)'
                                }}>
                                    ğŸ” ê±°ì§“ë§ íƒì§€ê¸°
                                </h2>
                                <p style={{
                                    textAlign: 'center',
                                    color: '#aaa',
                                    marginBottom: '30px',
                                    fontSize: '0.9rem'
                                }}>
                                    AIê°€ ëƒ‰ì •í•˜ê³  ì”í˜¹í•˜ê²Œ ì§„ì‹¤ì„ íŒë‹¨í•©ë‹ˆë‹¤
                                </p>
                                
                                <textarea 
                                    value={detectorQuestion}
                                    onChange={e => setDetectorQuestion(e.target.value)}
                                    placeholder="ì§ˆë¬¸ì´ë‚˜ ì§„ìˆ ì„ ì…ë ¥í•˜ì„¸ìš”..."
                                    style={{
                                        minHeight: '120px',
                                        background: '#0f3460',
                                        border: '2px solid #533483',
                                        color: 'white',
                                        fontSize: '1.1rem'
                                    }}
                                    disabled={detectorLoading}
                                    maxLength={500}
                                />
                                
                                <div style={{
                                    textAlign: 'right',
                                    fontSize: '0.85rem',
                                    color: '#888',
                                    marginBottom: '15px'
                                }}>
                                    {detectorQuestion.length}/500
                                </div>
                                
                                <button 
                                    className="btn"
                                    onClick={detectLie}
                                    disabled={!detectorQuestion.trim() || detectorLoading}
                                    style={{
                                        background: detectorLoading 
                                            ? '#555' 
                                            : 'linear-gradient(135deg, #e94560 0%, #c62828 100%)',
                                        fontSize: '1.2rem',
                                        padding: '15px'
                                    }}
                                >
                                    {detectorLoading ? 'ë¶„ì„ ì¤‘...' : 'ğŸ” ì§„ì‹¤ íŒë³„'}
                                </button>
                            </div>
                            
                            {detectorLoading && (
                                <div className="detector-loading">
                                    <div className="heartbeat">ğŸ’“</div>
                                    <p style={{
                                        fontSize: '1.2rem',
                                        color: '#e94560',
                                        fontWeight: 'bold',
                                        marginTop: '20px'
                                    }}>
                                        ë¶„ì„ ì¤‘...
                                    </p>
                                </div>
                            )}
                            
                            {detectorResult && (
                                <div className={`detector-result ${
                                    detectorResult.verdict === 'ì§„ì‹¤' ? 'truth' : 
                                    detectorResult.verdict === 'ê±°ì§“' ? 'lie' : 'error'
                                }`}>
                                    <div className="verdict">
                                        {detectorResult.verdict === 'ì§„ì‹¤' && 'âœ… ì§„ì‹¤'}
                                        {detectorResult.verdict === 'ê±°ì§“' && 'âŒ ê±°ì§“'}
                                        {detectorResult.verdict === 'ì˜¤ë¥˜' && 'âš ï¸ ì˜¤ë¥˜'}
                                        {!['ì§„ì‹¤', 'ê±°ì§“', 'ì˜¤ë¥˜'].includes(detectorResult.verdict) && 'â“ íŒì • ë¶ˆê°€'}
                                    </div>
                                    <div className="reason">
                                        {detectorResult.reason}
                                    </div>
                                </div>
                            )}
                            
                            <div className="card" style={{marginTop:'30px'}}>
                                <h3 style={{
                                    marginBottom:'20px',
                                    color:'#e94560',
                                    borderBottom:'2px solid #e94560',
                                    paddingBottom:'10px'
                                }}>
                                    ğŸ“‹ íƒì§€ ê¸°ë¡
                                </h3>
                                
                                {logsLoading ? (
                                    <div style={{textAlign:'center',padding:'20px',color:'#999'}}>
                                        ë¡œë”©ì¤‘...
                                    </div>
                                ) : detectorLogs.length === 0 ? (
                                    <div style={{textAlign:'center',padding:'40px',color:'#999'}}>
                                        ì•„ì§ íƒì§€ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤
                                    </div>
                                ) : (
                                    <div style={{maxHeight:'600px',overflowY:'auto'}}>
                                        {detectorLogs.map(log => (
                                            <div key={log.id} style={{
                                                background: log.verdict === 'ì§„ì‹¤' ? '#e8f5e9' : 
                                                           log.verdict === 'ê±°ì§“' ? '#ffebee' : '#f5f5f5',
                                                padding:'15px',
                                                borderRadius:'12px',
                                                marginBottom:'15px',
                                                border: log.verdict === 'ì§„ì‹¤' ? '2px solid #4caf50' : 
                                                       log.verdict === 'ê±°ì§“' ? '2px solid #f44336' : '2px solid #9e9e9e'
                                            }}>
                                                <div style={{
                                                    display:'flex',
                                                    justifyContent:'space-between',
                                                    alignItems:'center',
                                                    marginBottom:'10px'
                                                }}>
                                                    <span style={{
                                                        fontWeight:'bold',
                                                        fontSize:'1.1rem',
                                                        color: log.verdict === 'ì§„ì‹¤' ? '#2e7d32' : 
                                                              log.verdict === 'ê±°ì§“' ? '#c62828' : '#616161'
                                                    }}>
                                                        {log.verdict === 'ì§„ì‹¤' && 'âœ… ì§„ì‹¤'}
                                                        {log.verdict === 'ê±°ì§“' && 'âŒ ê±°ì§“'}
                                                        {!['ì§„ì‹¤','ê±°ì§“'].includes(log.verdict) && 'â“ íŒì • ë¶ˆê°€'}
                                                    </span>
                                                    <span style={{fontSize:'0.85rem',color:'#666'}}>
                                                        {new Date(log.timestamp).toLocaleString('ko-KR', {
                                                            month:'short',
                                                            day:'numeric',
                                                            hour:'2-digit',
                                                            minute:'2-digit'
                                                        })}
                                                    </span>
                                                </div>
                                                <div style={{
                                                    fontSize:'1rem',
                                                    fontWeight:'600',
                                                    marginBottom:'8px',
                                                    color:'#333'
                                                }}>
                                                    Q: {log.question}
                                                </div>
                                                <div style={{
                                                    fontSize:'0.95rem',
                                                    color:'#555',
                                                    lineHeight:'1.5'
                                                }}>
                                                    ğŸ’¬ {log.reason}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    ) : tab === 'vote' ? (
                        <div>
                            <div className="card" style={{marginBottom:'20px'}}>
                                <h3 style={{marginBottom:'15px'}}>ğŸ—³ï¸ íˆ¬í‘œ ì•ˆê±´ ë§Œë“¤ê¸°</h3>
                                <input 
                                    type="text"
                                    value={voteTitle} 
                                    onChange={e=>setVoteTitle(e.target.value)} 
                                    placeholder="íˆ¬í‘œ ì•ˆê±´ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì˜¤ëŠ˜ ì €ë… ì¹˜í‚¨ ë¨¹ì„ê¹Œìš”?)" 
                                    maxLength={200}
                                    style={{marginBottom:'10px'}}
                                    onKeyPress={e=>e.key==='Enter'&&createVote()}
                                />
                                <div style={{textAlign:'right',fontSize:'0.85rem',color:'#666',marginBottom:'10px'}}>
                                    {voteTitle.length}/200
                                </div>
                                <button className="btn" onClick={createVote} disabled={!voteTitle.trim()}>
                                    ğŸ—³ï¸ íˆ¬í‘œ ì‹œì‘í•˜ê¸°
                                </button>
                            </div>
                            
                            <h3 style={{marginBottom:'15px'}}>ğŸ“Š ì§„í–‰ ì¤‘ì¸ íˆ¬í‘œ</h3>
                            
                            {votesLoading ? (
                                <div className="card">ë¡œë”©ì¤‘...</div>
                            ) : votePolls.length === 0 ? (
                                <div className="card" style={{textAlign:'center',padding:'40px',color:'#999'}}>
                                    ì•„ì§ ì§„í–‰ ì¤‘ì¸ íˆ¬í‘œê°€ ì—†ìŠµë‹ˆë‹¤
                                </div>
                            ) : (
                                votePolls.map(poll => {
                                    const fingerprint = getFingerprint();
                                    const hasVoted = poll.voters && poll.voters[fingerprint];
                                    const totalVotes = (poll.agree || 0) + (poll.disagree || 0);
                                    const agreePercent = totalVotes > 0 ? Math.round((poll.agree || 0) / totalVotes * 100) : 0;
                                    const disagreePercent = totalVotes > 0 ? Math.round((poll.disagree || 0) / totalVotes * 100) : 0;
                                    
                                    return (
                                        <div key={poll.id} className="card" style={{marginBottom:'20px'}}>
                                            <div style={{
                                                fontSize:'1.2rem',
                                                fontWeight:'bold',
                                                marginBottom:'15px',
                                                color:'#333'
                                            }}>
                                                {poll.title}
                                            </div>
                                            
                                            <div style={{
                                                fontSize:'0.85rem',
                                                color:'#666',
                                                marginBottom:'20px'
                                            }}>
                                                {new Date(poll.timestamp).toLocaleString('ko-KR')} Â· ì´ {totalVotes}í‘œ
                                            </div>
                                            
                                            {!hasVoted ? (
                                                <div style={{display:'flex',gap:'10px'}}>
                                                    <button 
                                                        className="btn"
                                                        onClick={()=>castVote(poll.id, 'agree')}
                                                        style={{
                                                            flex:1,
                                                            background:'linear-gradient(135deg, #4caf50 0%, #66bb6a 100%)'
                                                        }}
                                                    >
                                                        ğŸ‘ ì°¬ì„±
                                                    </button>
                                                    <button 
                                                        className="btn"
                                                        onClick={()=>castVote(poll.id, 'disagree')}
                                                        style={{
                                                            flex:1,
                                                            background:'linear-gradient(135deg, #f44336 0%, #ef5350 100%)'
                                                        }}
                                                    >
                                                        ğŸ‘ ë°˜ëŒ€
                                                    </button>
                                                </div>
                                            ) : (
                                                <div>
                                                    <div style={{
                                                        padding:'15px',
                                                        background:'#fff3cd',
                                                        borderRadius:'8px',
                                                        marginBottom:'15px',
                                                        textAlign:'center',
                                                        fontWeight:'bold',
                                                        color:'#856404'
                                                    }}>
                                                        âœ… íˆ¬í‘œ ì™„ë£Œ: {hasVoted.choice === 'agree' ? 'ì°¬ì„±' : 'ë°˜ëŒ€'}
                                                    </div>
                                                </div>
                                            )}
                                            
                                            <div style={{marginTop:'20px'}}>
                                                <div style={{marginBottom:'10px'}}>
                                                    <div style={{
                                                        display:'flex',
                                                        justifyContent:'space-between',
                                                        marginBottom:'5px'
                                                    }}>
                                                        <span>ğŸ‘ ì°¬ì„±</span>
                                                        <span style={{fontWeight:'bold'}}>
                                                            {poll.agree || 0}í‘œ ({agreePercent}%)
                                                        </span>
                                                    </div>
                                                    <div style={{
                                                        height:'30px',
                                                        background:'#e0e0e0',
                                                        borderRadius:'15px',
                                                        overflow:'hidden'
                                                    }}>
                                                        <div style={{
                                                            width:`${agreePercent}%`,
                                                            height:'100%',
                                                            background:'linear-gradient(135deg, #4caf50 0%, #66bb6a 100%)',
                                                            transition:'width 0.5s ease'
                                                        }} />
                                                    </div>
                                                </div>
                                                
                                                <div>
                                                    <div style={{
                                                        display:'flex',
                                                        justifyContent:'space-between',
                                                        marginBottom:'5px'
                                                    }}>
                                                        <span>ğŸ‘ ë°˜ëŒ€</span>
                                                        <span style={{fontWeight:'bold'}}>
                                                            {poll.disagree || 0}í‘œ ({disagreePercent}%)
                                                        </span>
                                                    </div>
                                                    <div style={{
                                                        height:'30px',
                                                        background:'#e0e0e0',
                                                        borderRadius:'15px',
                                                        overflow:'hidden'
                                                    }}>
                                                        <div style={{
                                                            width:`${disagreePercent}%`,
                                                            height:'100%',
                                                            background:'linear-gradient(135deg, #f44336 0%, #ef5350 100%)',
                                                            transition:'width 0.5s ease'
                                                        }} />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })
                            )}
                        </div>
                    ) : tab === 'farm' ? (
                        <div>
                            {!farmUser ? (
                                <div className="card" style={{maxWidth:'500px',margin:'0 auto'}}>
                                    <h3 style={{marginBottom:'20px',textAlign:'center'}}>
                                        ğŸŒ¶ï¸ ê³ ì¶”ë†ì¥ {isLoginMode ? 'ë¡œê·¸ì¸' : 'íšŒì›ê°€ì…'}
                                    </h3>
                                    
                                    <input 
                                        type="text"
                                        value={farmNickname}
                                        onChange={e => setFarmNickname(e.target.value)}
                                        placeholder="ë‹‰ë„¤ì„"
                                        maxLength={20}
                                        style={{marginBottom:'10px'}}
                                        onKeyPress={e => e.key === 'Enter' && (isLoginMode ? loginFarm() : registerFarm())}
                                    />
                                    
                                    <input 
                                        type="password"
                                        value={farmPassword}
                                        onChange={e => setFarmPassword(e.target.value)}
                                        placeholder="ë¹„ë°€ë²ˆí˜¸ (4ì ì´ìƒ)"
                                        style={{marginBottom:'15px'}}
                                        onKeyPress={e => e.key === 'Enter' && (isLoginMode ? loginFarm() : registerFarm())}
                                    />
                                    
                                    <button 
                                        className="btn" 
                                        onClick={isLoginMode ? loginFarm : registerFarm}
                                        disabled={!farmNickname.trim() || !farmPassword.trim()}
                                    >
                                        {isLoginMode ? 'ğŸšª ë¡œê·¸ì¸' : 'ğŸŒ± íšŒì›ê°€ì…'}
                                    </button>
                                    
                                    <div style={{
                                        textAlign:'center',
                                        marginTop:'15px',
                                        fontSize:'0.9rem'
                                    }}>
                                        <button
                                            onClick={() => {
                                                setIsLoginMode(!isLoginMode);
                                                setFarmNickname('');
                                                setFarmPassword('');
                                            }}
                                            style={{
                                                background:'none',
                                                border:'none',
                                                color:'#667eea',
                                                cursor:'pointer',
                                                textDecoration:'underline',
                                                fontSize:'0.9rem'
                                            }}
                                        >
                                            {isLoginMode ? 'íšŒì›ê°€ì…í•˜ê¸°' : 'ë¡œê·¸ì¸í•˜ê¸°'}
                                        </button>
                                    </div>
                                    
                                    <p style={{
                                        textAlign:'center',
                                        color:'#666',
                                        marginTop:'20px',
                                        fontSize:'0.85rem'
                                    }}>
                                        * ë‹‰ë„¤ì„ ì¤‘ë³µ ë¶ˆê°€<br/>
                                        * ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒ
                                    </p>
                                </div>
                            ) : (
                                <div style={{display:'flex',gap:'20px',alignItems:'flex-start'}}>
                                    {/* ì™¼ìª½: ë©”ì¸ ì½˜í…ì¸  */}
                                    <div style={{flex:'1',minWidth:'0'}}>
                                        {pvpRequests.length > 0 && (
                                            <div className="card" style={{marginBottom:'20px'}}>
                                                <h3 style={{marginBottom:'15px'}}>âš”ï¸ PVP ìš”ì²­</h3>
                                                {pvpRequests.map(req => {
                                                    const isReceived = req.toId === farmUser.id;
                                                    return (
                                                        <div key={req.id} style={{
                                                            padding:'15px',
                                                            background:'#f8f9fa',
                                                            borderRadius:'8px',
                                                            marginBottom:'10px'
                                                        }}>
                                                            {isReceived ? (
                                                                <>
                                                                    <div style={{marginBottom:'10px',fontWeight:'bold'}}>
                                                                        {req.fromName}ë‹˜ì´ {req.amount}cmë¥¼ ê±¸ê³  ë„ì „í–ˆìŠµë‹ˆë‹¤!
                                                                    </div>
                                                                    <div style={{display:'flex',gap:'10px'}}>
                                                                        <button 
                                                                            className="btn"
                                                                            onClick={() => acceptPvp(req.id, req)}
                                                                            style={{flex:1,background:'linear-gradient(135deg, #4caf50 0%, #66bb6a 100%)'}}
                                                                        >
                                                                            âœ… ìˆ˜ë½
                                                                        </button>
                                                                        <button 
                                                                            className="btn"
                                                                            onClick={() => rejectPvp(req.id)}
                                                                            style={{flex:1,background:'linear-gradient(135deg, #f44336 0%, #ef5350 100%)'}}
                                                                        >
                                                                            âŒ ê±°ì ˆ
                                                                        </button>
                                                                    </div>
                                                                </>
                                                            ) : (
                                                                <div style={{color:'#666'}}>
                                                                    {req.toName}ë‹˜ì—ê²Œ {req.amount}cm ë„ì „ ëŒ€ê¸° ì¤‘...
                                                                </div>
                                                            )}
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        )}
                                        
                                        <div className="card" style={{marginBottom:'20px'}}>
                                            <h3 style={{marginBottom:'15px'}}>âš”ï¸ PVP ë„ì „í•˜ê¸°</h3>
                                            <p style={{fontSize:'0.9rem',color:'#666',marginBottom:'15px'}}>
                                                ìƒëŒ€ë°©ì„ ì§€ì •í•˜ê³  cmë¥¼ ê±¸ì–´ ë°°í‹€!
                                            </p>
                                            <input 
                                                type="text"
                                                value={pvpTarget}
                                                onChange={e => setPvpTarget(e.target.value)}
                                                placeholder="ìƒëŒ€ë°© ë‹‰ë„¤ì„"
                                                style={{marginBottom:'10px'}}
                                            />
                                            <input 
                                                type="number"
                                                value={pvpAmount}
                                                onChange={e => setPvpAmount(e.target.value)}
                                                placeholder="ê±¸ cm (ìˆ«ì)"
                                                min="1"
                                                style={{marginBottom:'10px'}}
                                            />
                                            <button 
                                                className="btn"
                                                onClick={sendPvpRequest}
                                                disabled={!pvpTarget.trim() || !pvpAmount}
                                            >
                                                âš”ï¸ PVP ì‹ ì²­
                                            </button>
                                        </div>
                                    </div>
                                    
                                    {/* ì˜¤ë¥¸ìª½: ë­í‚¹ & ë¡œê·¸ */}
                                    <div style={{width:'350px',flexShrink:0}}>
                                        <div className="card" style={{marginBottom:'20px',maxHeight:'400px',overflow:'auto'}}>
                                            <h3 style={{marginBottom:'15px',position:'sticky',top:0,background:'white',padding:'10px 0'}}>ğŸ† ì‹¤ì‹œê°„ ë­í‚¹</h3>
                                            {farmLoading ? (
                                                <div style={{textAlign:'center',padding:'20px',color:'#999'}}>ë¡œë”©ì¤‘...</div>
                                            ) : farmUsers.length === 0 ? (
                                                <div style={{textAlign:'center',padding:'20px',color:'#999'}}>ì•„ì§ ì°¸ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤</div>
                                            ) : (
                                                <div>
                                                    {farmUsers.map((user, index) => (
                                                        <div key={user.id} style={{
                                                            padding:'12px',
                                                            background: user.id === farmUser.id ? '#e3f2fd' : '#f8f9fa',
                                                            borderRadius:'8px',
                                                            marginBottom:'8px',
                                                            display:'flex',
                                                            justifyContent:'space-between',
                                                            alignItems:'center',
                                                            border: user.id === farmUser.id ? '2px solid #2196f3' : 'none'
                                                        }}>
                                                            <div style={{display:'flex',alignItems:'center',gap:'8px',flex:1,minWidth:0}}>
                                                                <span style={{
                                                                    fontSize:'1.2rem',
                                                                    fontWeight:'bold',
                                                                    color: index === 0 ? '#ffd700' : index === 1 ? '#c0c0c0' : index === 2 ? '#cd7f32' : '#999',
                                                                    flexShrink:0
                                                                }}>
                                                                    {index + 1}
                                                                </span>
                                                                <span style={{fontWeight:'bold',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}}>{user.nickname}</span>
                                                                {user.id === farmUser.id && (
                                                                    <span style={{
                                                                        background:'#2196f3',
                                                                        color:'white',
                                                                        padding:'2px 6px',
                                                                        borderRadius:'4px',
                                                                        fontSize:'0.75rem',
                                                                        flexShrink:0
                                                                    }}>ë‚˜</span>
                                                                )}
                                                            </div>
                                                            <div style={{
                                                                fontSize:'1rem',
                                                                fontWeight:'bold',
                                                                color:'#4caf50',
                                                                flexShrink:0
                                                            }}>
                                                                {user.length}cm
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                        
                                        <div className="card" style={{maxHeight:'400px',overflow:'auto'}}>
                                            <h3 style={{marginBottom:'15px',position:'sticky',top:0,background:'white',padding:'10px 0'}}>ğŸ“œ í™œë™ ë¡œê·¸</h3>
                                            {chatLoading ? (
                                                <div style={{textAlign:'center',padding:'20px',color:'#999'}}>ë¡œë”©ì¤‘...</div>
                                            ) : chatMessages.filter(m => m.nickname === 'ğŸŒ¶ï¸ ë†ì¥ ì‹œìŠ¤í…œ' || m.nickname === 'âš”ï¸ PVP ì‹œìŠ¤í…œ' || m.nickname === 'ğŸ‰ ì‹œìŠ¤í…œ').length === 0 ? (
                                                <div style={{textAlign:'center',padding:'20px',color:'#999'}}>ì•„ì§ í™œë™ì´ ì—†ìŠµë‹ˆë‹¤</div>
                                            ) : (
                                                <div>
                                                    {chatMessages.filter(m => m.nickname === 'ğŸŒ¶ï¸ ë†ì¥ ì‹œìŠ¤í…œ' || m.nickname === 'âš”ï¸ PVP ì‹œìŠ¤í…œ' || m.nickname === 'ğŸ‰ ì‹œìŠ¤í…œ').slice(-20).reverse().map(msg => (
                                                        <div key={msg.id} style={{
                                                            padding:'10px',
                                                            background:'#f8f9fa',
                                                            borderRadius:'8px',
                                                            marginBottom:'8px',
                                                            fontSize:'0.85rem'
                                                        }}>
                                                            <div style={{
                                                                fontWeight:'bold',
                                                                color: msg.nickname === 'ğŸ‰ ì‹œìŠ¤í…œ' ? '#ff6b9d' : msg.nickname === 'âš”ï¸ PVP ì‹œìŠ¤í…œ' ? '#f44336' : '#4caf50',
                                                                marginBottom:'4px'
                                                            }}>
                                                                {msg.nickname}
                                                            </div>
                                                            <div style={{color:'#333',lineHeight:'1.4'}}>
                                                                {msg.message}
                                                            </div>
                                                            <div style={{fontSize:'0.75rem',color:'#999',marginTop:'4px'}}>
                                                                {new Date(msg.timestamp).toLocaleString('ko-KR', {
                                                                    month:'short',
                                                                    day:'numeric',
                                                                    hour:'2-digit',
                                                                    minute:'2-digit'
                                                                })}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                                    {showPvpResult && (
                                        <div className="card" style={{
                                            background: showPvpResult.isMyWin ? 
                                                'linear-gradient(135deg, #4caf50 0%, #66bb6a 100%)' : 
                                                'linear-gradient(135deg, #f44336 0%, #ef5350 100%)',
                                            color: 'white',
                                            textAlign: 'center',
                                            padding: '30px',
                                            marginBottom: '20px',
                                            animation: 'resultAppear 0.5s ease-out'
                                        }}>
                                            <h2 style={{fontSize:'2.5rem',marginBottom:'15px'}}>
                                                {showPvpResult.isMyWin ? 'ğŸ‰ ìŠ¹ë¦¬!' : 'ğŸ˜¢ íŒ¨ë°°...'}
                                            </h2>
                                            <p style={{fontSize:'1.3rem',fontWeight:'bold'}}>
                                                {showPvpResult.winner} vs {showPvpResult.loser}
                                            </p>
                                            <p style={{fontSize:'1.1rem',marginTop:'10px'}}>
                                                {showPvpResult.amount}cm ì´ë™!
                                            </p>
                                        </div>
                                    )}
                                    
                                    <div className="card" style={{
                                        background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                                        color: 'white',
                                        padding: '30px',
                                        textAlign: 'center',
                                        marginBottom: '20px'
                                    }}>
                                        <div style={{
                                            display:'flex',
                                            justifyContent:'space-between',
                                            alignItems:'center',
                                            marginBottom:'10px'
                                        }}>
                                            <h2 style={{fontSize:'1.5rem',margin:0}}>{farmUser.nickname}ë‹˜ì˜ ë†ì¥</h2>
                                            <button
                                                onClick={logoutFarm}
                                                style={{
                                                    background:'rgba(255,255,255,0.2)',
                                                    border:'1px solid white',
                                                    color:'white',
                                                    padding:'5px 15px',
                                                    borderRadius:'20px',
                                                    cursor:'pointer',
                                                    fontSize:'0.9rem'
                                                }}
                                            >
                                                ğŸšª ë¡œê·¸ì•„ì›ƒ
                                            </button>
                                        </div>
                                        <div style={{fontSize:'3rem',margin:'20px 0'}}>ğŸŒ¶ï¸</div>
                                        <div style={{fontSize:'2.5rem',fontWeight:'bold',marginBottom:'10px'}}>
                                            {farmUser.length}cm
                                        </div>
                                        
                                        <div style={{
                                            background:'rgba(255,255,255,0.2)',
                                            padding:'15px',
                                            borderRadius:'12px',
                                            marginBottom:'20px'
                                        }}>
                                            <div style={{fontSize:'1.2rem',fontWeight:'bold'}}>
                                                â° {remainingTime}
                                            </div>
                                        </div>
                                        
                                        <button 
                                            className="btn"
                                            onClick={checkIn}
                                            disabled={remainingTime !== 'ì¶œì„ ê°€ëŠ¥!'}
                                            style={{
                                                background: remainingTime === 'ì¶œì„ ê°€ëŠ¥!' ? 'white' : 'rgba(255,255,255,0.3)',
                                                color: remainingTime === 'ì¶œì„ ê°€ëŠ¥!' ? '#667eea' : 'rgba(255,255,255,0.7)',
                                                fontWeight: 'bold',
                                                fontSize: '1.1rem',
                                                cursor: remainingTime === 'ì¶œì„ ê°€ëŠ¥!' ? 'pointer' : 'not-allowed'
                                            }}
                                        >
                                            â­ ì¶œì„ì²´í¬ (1~100cm)
                                        </button>
                                    </div>
                                    
                                    {pvpRequests.length > 0 && (
                                        <div className="card" style={{marginBottom:'20px'}}>
                                            <h3 style={{marginBottom:'15px'}}>âš”ï¸ PVP ìš”ì²­</h3>
                                            {pvpRequests.map(req => {
                                                const isReceived = req.toId === farmUser.id;
                                                return (
                                                    <div key={req.id} style={{
                                                        padding:'15px',
                                                        background:'#f8f9fa',
                                                        borderRadius:'8px',
                                                        marginBottom:'10px'
                                                    }}>
                                                        {isReceived ? (
                                                            <>
                                                                <div style={{marginBottom:'10px',fontWeight:'bold'}}>
                                                                    {req.fromName}ë‹˜ì´ {req.amount}cmë¥¼ ê±¸ê³  ë„ì „í–ˆìŠµë‹ˆë‹¤!
                                                                </div>
                                                                <div style={{display:'flex',gap:'10px'}}>
                                                                    <button 
                                                                        className="btn"
                                                                        onClick={() => acceptPvp(req.id, req)}
                                                                        style={{flex:1,background:'linear-gradient(135deg, #4caf50 0%, #66bb6a 100%)'}}
                                                                    >
                                                                        âœ… ìˆ˜ë½
                                                                    </button>
                                                                    <button 
                                                                        className="btn"
                                                                        onClick={() => rejectPvp(req.id)}
                                                                        style={{flex:1,background:'linear-gradient(135deg, #f44336 0%, #ef5350 100%)'}}
                                                                    >
                                                                        âŒ ê±°ì ˆ
                                                                    </button>
                                                                </div>
                                                            </>
                                                        ) : (
                                                            <div style={{color:'#666'}}>
                                                                {req.toName}ë‹˜ì—ê²Œ {req.amount}cm ë„ì „ ëŒ€ê¸° ì¤‘...
                                                            </div>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    )}
                                    
                                    <div className="card" style={{marginBottom:'20px'}}>
                                        <h3 style={{marginBottom:'15px'}}>âš”ï¸ PVP ë„ì „í•˜ê¸°</h3>
                                        <p style={{fontSize:'0.9rem',color:'#666',marginBottom:'15px'}}>
                                            /pvp ìƒëŒ€ë‹‰ë„¤ì„ cmìˆ«ì í˜•ì‹ìœ¼ë¡œ ë„ì „!
                                        </p>
                                        <input 
                                            type="text"
                                            value={pvpTarget}
                                            onChange={e => setPvpTarget(e.target.value)}
                                            placeholder="ìƒëŒ€ë°© ë‹‰ë„¤ì„"
                                            style={{marginBottom:'10px'}}
                                        />
                                        <input 
                                            type="number"
                                            value={pvpAmount}
                                            onChange={e => setPvpAmount(e.target.value)}
                                            placeholder="ê±¸ cm (ìˆ«ì)"
                                            min="1"
                                            style={{marginBottom:'10px'}}
                                        />
                                        <button 
                                            className="btn"
                                            onClick={sendPvpRequest}
                                            disabled={!pvpTarget.trim() || !pvpAmount}
                                        >
                                            âš”ï¸ PVP ì‹ ì²­
                                        </button>
                                    </div>
                                </div>
                                    
                                    {/* ì˜¤ë¥¸ìª½: ë­í‚¹ & ë¡œê·¸ */}
                            )}
                        </div>
                    ) : null}
                </div>
            );
        }
        
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
